<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>爵士犀首</title>
  <subtitle>Talk is cheap, show me the code!</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://austinxishou.github.io/"/>
  <updated>2018-03-09T03:07:04.086Z</updated>
  <id>https://austinxishou.github.io/</id>
  
  <author>
    <name>AustinXishou</name>
    <email>austinxishou@yahoo.com</email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>python 解析xml相关问题</title>
    <link href="https://austinxishou.github.io/2018/03/09/python/python-parse-xml-usage/"/>
    <id>https://austinxishou.github.io/2018/03/09/python/python-parse-xml-usage/</id>
    <published>2018-03-09T02:54:01.946Z</published>
    <updated>2018-03-09T03:07:04.086Z</updated>
    
    <content type="html"><![CDATA[<h2 id="python常用的解析xml库"><a href="#python常用的解析xml库" class="headerlink" title="python常用的解析xml库"></a>python常用的解析xml库</h2><pre><code>在python脚本或者其他应用场景,对xml文件进行读写和修改再正常不过;
常用的xml解析库有:
[ElementTree](https://docs.python.org/2.7/library/xml.etree.elementtree.html?highlight=elementtree#module-xml.etree.ElementTree)
[Beautiful Soup](http://beautifulsoup.readthedocs.io/zh_CN/v4.4.0/#id57)

优缺点分析:
</code></pre><h2 id="ElementTree-基本使用"><a href="#ElementTree-基本使用" class="headerlink" title="ElementTree 基本使用"></a>ElementTree 基本使用</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">import xml.etree.ElementTree as ET</div><div class="line">tree = ET.parse(&apos;country_data.xml&apos;)</div><div class="line">root = tree.getroot()</div></pre></td></tr></table></figure>
<h2 id="问题集锦"><a href="#问题集锦" class="headerlink" title="问题集锦"></a>问题集锦</h2><h3 id="namespace-xml的命名空间问题"><a href="#namespace-xml的命名空间问题" class="headerlink" title="namespace xml的命名空间问题"></a>namespace xml的命名空间问题</h3><pre><code>ElementTree 解析xml命名空间时

如以下的:
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;resources xmlns:tools=&quot;http://schemas.android.com/tools&quot; tools:ignore=&quot;MissingTranslation&quot; xmlns:xliff=&quot;urn:oasis:names:tc:xliff:document:1.2&quot;&gt;</div></pre></td></tr></table></figure>

解析出来的属性值为:
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;&apos;&#123;http://schemas.android.com/tools&#125;ignore&apos;: &apos;MissingTranslation&apos;&#125;</div></pre></td></tr></table></figure>
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;resources xmlns:tools=&quot;http://schemas.android.com/tools&quot; tools:ignore=&quot;MissingTranslation&quot; xmlns:xliff=&quot;urn:oasis:names:tc:xliff:document:1.2&quot;&gt;</div><div class="line">    &lt;!-- 应用黑白名单 --&gt;</div><div class="line">    &lt;string name=&quot;back_app_fork_stop&quot;&gt;The application has been blacklisted and unable to start,It is recommended to&lt;/string&gt;</div><div class="line">    &lt;string name=&quot;back_app_uninstall&quot;&gt;uninstall&lt;/string&gt;</div><div class="line">    &lt;string name=&quot;timer_format&quot; translatable=&quot;false&quot;&gt;&lt;/string&gt;</div><div class="line">    &lt;string name=&quot;audio_db_title_format&quot;&gt;&lt;xliff:g id=&quot;format&quot;&gt;yyyy-MM-dd HH:mm:ss&lt;/xliff:g&gt;&lt;/string&gt;</div><div class="line">&lt;/resources&gt;</div></pre></td></tr></table></figure>
<p>解析后的<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&apos;1.0&apos; encoding=&apos;utf-8&apos;?&gt;</div><div class="line">&lt;resources xmlns:ns0=&quot;http://schemas.android.com/tools&quot; xmlns:ns1=&quot;urn:oasis:names:tc:xliff:document:1.2&quot; ns0:ignore=&quot;MissingTranslation&quot;&gt;</div><div class="line">    </div><div class="line">    &lt;string name=&quot;back_app_fork_stop&quot;&gt;dsadfqwef&lt;/string&gt;</div><div class="line">    &lt;string name=&quot;back_app_uninstall&quot;&gt;dsadfqwef&lt;/string&gt;</div><div class="line">    &lt;string name=&quot;timer_format&quot; translatable=&quot;false&quot;&gt;dsadfqwef&lt;/string&gt;</div><div class="line">    &lt;string name=&quot;audio_db_title_format&quot;&gt;dsadfqwef&lt;ns1:g id=&quot;format&quot;&gt;yyyy-MM-dd HH:mm:ss&lt;/ns1:g&gt;&lt;/string&gt;</div><div class="line">&lt;/resources&gt;</div></pre></td></tr></table></figure></p>
<pre><code>虽然也是正确,但是把命名空间对应为了ns1


[ElementTree: Working with Namespaces and Qualified Names](http://effbot.org/zone/element-namespaces.htm)
这边英文文章解释的很细致,唯一的缺点就是太长了;

所以关键点就是,注册命名空间

<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ET.register_namespace(&quot;xliff&quot;,&quot;urn:oasis:names:tc:xliff:document:1.2&quot;)</div><div class="line">ET.register_namespace(&quot;tools&quot;,&quot;http://schemas.android.com/tools&quot;)</div></pre></td></tr></table></figure>


这就可以正确输出
</code></pre><p>### </p>
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';       
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);

    var sozzsrc = (document.location.protocol == "http:") ? "http://js.passport.qihucdn.com/11.0.1.js?6934e60f0fcbf5f113646cf0c3c61c6a":"https://jspassport.ssl.qhimg.com/11.0.1.js?6934e60f0fcbf5f113646cf0c3c61c6a";
    document.write('<script src="' + sozzsrc + '" id="sozz"><\/script>');
})();
</script>
]]></content>
    
    <summary type="html">
    
      python 解析xml相关问题
    
    </summary>
    
      <category term="python" scheme="https://austinxishou.github.io/categories/python/"/>
    
    
      <category term="python" scheme="https://austinxishou.github.io/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>mysql使用</title>
    <link href="https://austinxishou.github.io/2018/03/05/server/php-mysql-usage-1/"/>
    <id>https://austinxishou.github.io/2018/03/05/server/php-mysql-usage-1/</id>
    <published>2018-03-05T01:13:26.790Z</published>
    <updated>2018-03-04T16:13:05.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="mysql-中多表联合删除"><a href="#mysql-中多表联合删除" class="headerlink" title="mysql 中多表联合删除"></a>mysql 中多表联合删除</h2><p><a href="https://www.cnblogs.com/sunss/archive/2011/01/20/1940306.html" target="_blank" rel="external">https://www.cnblogs.com/sunss/archive/2011/01/20/1940306.html</a></p>
<p>使用场景<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">//删除 项目与图片的中间表</div><div class="line">//别名只能在关联中给出</div><div class="line">//正确: delete t1,t2 from table_name as t1 left join table2_name as t2 on t1.id=t2.id where table_name.id=25</div><div class="line">//错误: delete table_name,table2_name from table_name as t1 left join table2_name as t2 on t1.id=t2.id where table_name.id=25</div><div class="line">$delete = &quot;delete t1,t2 from &quot;;</div><div class="line">$fromStr = $Base-&gt;table(&apos;imgs_works&apos;).&quot; as t1 left join &quot;.$Base-&gt;table(&apos;imgsmain&apos;).&quot; as t2 &quot;;</div><div class="line">$whereStr = &quot;on t1.pk_img_main=t2.pk_img_main where t1.pk_works_main=&quot;.$pid;</div><div class="line">$execSqlStr = $delete.$fromStr.$whereStr;</div><div class="line">$delete = $Db -&gt;execSql($execSqlStr);</div></pre></td></tr></table></figure><script><br>(function(){<br>    var bp = document.createElement(‘script’);<br>    var curProtocol = window.location.protocol.split(‘:’)[0];<br>    if (curProtocol === ‘https’) {<br>        bp.src = ‘<a href="https://zz.bdstatic.com/linksubmit/push.js">https://zz.bdstatic.com/linksubmit/push.js</a>‘;<br>    }<br>    else {<br>        bp.src = ‘<a href="http://push.zhanzhang.baidu.com/push.js">http://push.zhanzhang.baidu.com/push.js</a>‘;<br>    }<br>    var s = document.getElementsByTagName(“script”)[0];<br>    s.parentNode.insertBefore(bp, s);</p>
<pre><code>var sozzsrc = (document.location.protocol == &quot;http:&quot;) ? &quot;http://js.passport.qihucdn.com/11.0.1.js?6934e60f0fcbf5f113646cf0c3c61c6a&quot;:&quot;https://jspassport.ssl.qhimg.com/11.0.1.js?6934e60f0fcbf5f113646cf0c3c61c6a&quot;;
document.write(&apos;&lt;script src=&quot;&apos; + sozzsrc + &apos;&quot; id=&quot;sozz&quot;&gt;&lt;\/script&gt;&apos;);
</code></pre><p>})();<br></script></p>
]]></content>
    
    <summary type="html">
    
      mysql使用
    
    </summary>
    
      <category term="server" scheme="https://austinxishou.github.io/categories/server/"/>
    
    
      <category term="server" scheme="https://austinxishou.github.io/tags/server/"/>
    
  </entry>
  
  <entry>
    <title>Android-OTA(五) Block-base 模式适配</title>
    <link href="https://austinxishou.github.io/2018/02/28/android/android-ota-5-block-base/"/>
    <id>https://austinxishou.github.io/2018/02/28/android/android-ota-5-block-base/</id>
    <published>2018-02-28T02:00:29.297Z</published>
    <updated>2018-03-02T08:38:24.870Z</updated>
    
    <content type="html"><![CDATA[<h2 id="About-安卓关于OTA更新"><a href="#About-安卓关于OTA更新" class="headerlink" title="About 安卓关于OTA更新"></a>About 安卓关于OTA更新</h2><p><a href="https://source.android.google.cn/devices/tech/ota/" target="_blank" rel="external">Android-doc</a></p>
<ol>
<li>优点<br> 因为块 OTA 可确保每个设备使用相同的分区，所以它能够使用 dm-verity 以加密的方式为系统分区签名</li>
</ol>
<h2 id="验证启动-device-mapper-verity-dm-verity"><a href="#验证启动-device-mapper-verity-dm-verity" class="headerlink" title="验证启动 device-mapper-verity (dm-verity)"></a>验证启动 device-mapper-verity (dm-verity)</h2><pre><code>&lt;script&gt;
</code></pre><p>(function(){<br>    var bp = document.createElement(‘script’);<br>    var curProtocol = window.location.protocol.split(‘:’)[0];<br>    if (curProtocol === ‘https’) {<br>        bp.src = ‘<a href="https://zz.bdstatic.com/linksubmit/push.js" target="_blank" rel="external">https://zz.bdstatic.com/linksubmit/push.js</a>‘;<br>    }<br>    else {<br>        bp.src = ‘<a href="http://push.zhanzhang.baidu.com/push.js" target="_blank" rel="external">http://push.zhanzhang.baidu.com/push.js</a>‘;<br>    }<br>    var s = document.getElementsByTagName(“script”)[0];<br>    s.parentNode.insertBefore(bp, s);</p>
<pre><code>var sozzsrc = (document.location.protocol == &quot;http:&quot;) ? &quot;http://js.passport.qihucdn.com/11.0.1.js?6934e60f0fcbf5f113646cf0c3c61c6a&quot;:&quot;https://jspassport.ssl.qhimg.com/11.0.1.js?6934e60f0fcbf5f113646cf0c3c61c6a&quot;;
document.write(&apos;&lt;script src=&quot;&apos; + sozzsrc + &apos;&quot; id=&quot;sozz&quot;&gt;&lt;\/script&gt;&apos;);
</code></pre><p>})();<br></p>
]]></content>
    
    <summary type="html">
    
      Android Block-base 模式适配
    
    </summary>
    
      <category term="android" scheme="https://austinxishou.github.io/categories/android/"/>
    
    
      <category term="android" scheme="https://austinxishou.github.io/tags/android/"/>
    
      <category term="OTA" scheme="https://austinxishou.github.io/tags/OTA/"/>
    
      <category term="recovery" scheme="https://austinxishou.github.io/tags/recovery/"/>
    
  </entry>
  
  <entry>
    <title>JavaScript的异步回调函数内部this的指向问题</title>
    <link href="https://austinxishou.github.io/2018/02/27/webdesign/ecs6-series-0/"/>
    <id>https://austinxishou.github.io/2018/02/27/webdesign/ecs6-series-0/</id>
    <published>2018-02-27T02:27:33.699Z</published>
    <updated>2018-02-27T03:22:21.223Z</updated>
    
    <content type="html"><![CDATA[<h2 id="问题说明"><a href="#问题说明" class="headerlink" title="问题说明"></a>问题说明</h2><p>常见回调函数内部的this指向问题<br>先看下面这段代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">class _Menu&#123;</div><div class="line">    constructor()&#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    _setFollowButtonFollowed = ()=&gt;&#123;</div><div class="line">        console.log(&quot;austin test _setFollowButtonFollowed&quot;);</div><div class="line">        this._frame.find(&apos;.follow-btn&apos;).addClass(&apos;followed&apos;).find(&apos;span&apos;).text(&apos;已关注&apos;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    render = ()=&gt;&#123;</div><div class="line">        this._frame = $(`</div><div class="line">            &lt;div class=&quot;menu&quot;&gt;</div><div class="line">                &lt;a class=&quot;follow-btn btn&quot; href=&quot;javascript:;&quot;&gt;</div><div class="line">                    &lt;i class=&quot;icon&quot;&gt;&lt;/i&gt;</div><div class="line">                    &lt;span&gt;关注店铺&lt;/span&gt;</div><div class="line">                &lt;/a&gt;</div><div class="line">                </div><div class="line">            &lt;/div&gt;</div><div class="line">        `);</div><div class="line">        this._frame</div><div class="line">            // .on(touchEvent.click, (&apos;.plan-select&apos;), this._reportPlanSelectClick)</div><div class="line">            .on(touchEvent.click, (&apos;.follow-btn:not(.followed)&apos;), ()=&gt;&#123;</div><div class="line">                console.log(&apos;点击关注&apos;);</div><div class="line">                if (Tida.appinfo.isTaobao) &#123;</div><div class="line">                    Tida.social(&#123;</div><div class="line">                        sellerId: _storeApi.sellerId,</div><div class="line">                        action: &apos;follow&apos;</div><div class="line">                    &#125;, function (e) &#123;//匿名回调函数</div><div class="line">                        const ret = typeof e.ret === &apos;object&apos; ? e.ret[0] : e.ret;</div><div class="line">                        if (ret === &apos;HY_SUCCESS&apos;) &#123;</div><div class="line">                            this._setFollowButtonFollowed();</div><div class="line">                        &#125;</div><div class="line">                    &#125;)</div><div class="line">                &#125;</div><div class="line">            &#125;)</div></pre></td></tr></table></figure>
<pre><code>在匿名回调函数中,调用了 `this._setFollowButtonFollowed()` 函数,提示的结果是

<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">this._setFollowButtonFollowed is not a function</div></pre></td></tr></table></figure>


这是因为this作用域指向问题 ，success函数实际是一个闭包 ， 无法直接通过 `this` 来 `_setFollowButtonFollowed`

那么需要怎么修改呢？

我们通过将当前对象赋给一个新的对象

var _this = this;

然后使用 _this 来 _setFollowButtonFollowed 就行了


完整代码如下:

<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">class _Menu&#123;</div><div class="line">constructor()&#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line">_setFollowButtonFollowed = ()=&gt;&#123;</div><div class="line">    console.log(&quot;austin test _setFollowButtonFollowed&quot;);</div><div class="line">    this._frame.find(&apos;.follow-btn&apos;).addClass(&apos;followed&apos;).find(&apos;span&apos;).text(&apos;已关注&apos;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">var _this = this;  //修改1 重点</div><div class="line">render = ()=&gt;&#123;</div><div class="line">    this._frame = $(`</div><div class="line">        &lt;div class=&quot;menu&quot;&gt;</div><div class="line">            &lt;a class=&quot;follow-btn btn&quot; href=&quot;javascript:;&quot;&gt;</div><div class="line">                &lt;i class=&quot;icon&quot;&gt;&lt;/i&gt;</div><div class="line">                &lt;span&gt;关注店铺&lt;/span&gt;</div><div class="line">            &lt;/a&gt;</div><div class="line">            </div><div class="line">        &lt;/div&gt;</div><div class="line">    `);</div><div class="line">    this._frame</div><div class="line">        // .on(touchEvent.click, (&apos;.plan-select&apos;), this._reportPlanSelectClick)</div><div class="line">        .on(touchEvent.click, (&apos;.follow-btn:not(.followed)&apos;), ()=&gt;&#123;</div><div class="line">            console.log(&apos;点击关注&apos;);</div><div class="line">            if (Tida.appinfo.isTaobao) &#123;</div><div class="line">                Tida.social(&#123;</div><div class="line">                    sellerId: _storeApi.sellerId,</div><div class="line">                    action: &apos;follow&apos;</div><div class="line">                &#125;, function (e) &#123;//匿名回调函数</div><div class="line">                    const ret = typeof e.ret === &apos;object&apos; ? e.ret[0] : e.ret;</div><div class="line">                    if (ret === &apos;HY_SUCCESS&apos;) &#123;</div><div class="line">                        _this._setFollowButtonFollowed();//修改2 重点</div><div class="line">                    &#125;</div><div class="line">                &#125;)</div><div class="line">            &#125;</div><div class="line">        &#125;)</div></pre></td></tr></table></figure>
</code></pre><script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';       
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);

    var sozzsrc = (document.location.protocol == "http:") ? "http://js.passport.qihucdn.com/11.0.1.js?6934e60f0fcbf5f113646cf0c3c61c6a":"https://jspassport.ssl.qhimg.com/11.0.1.js?6934e60f0fcbf5f113646cf0c3c61c6a";
    document.write('<script src="' + sozzsrc + '" id="sozz"><\/script>');
})();
</script>
]]></content>
    
    <summary type="html">
    
      JavaScript的异步回调函数内部this的指向问题
    
    </summary>
    
      <category term="webdesign" scheme="https://austinxishou.github.io/categories/webdesign/"/>
    
    
      <category term="JavaScript" scheme="https://austinxishou.github.io/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>server admin usage and note</title>
    <link href="https://austinxishou.github.io/2018/01/20/server/open-taobao-note-usage/"/>
    <id>https://austinxishou.github.io/2018/01/20/server/open-taobao-note-usage/</id>
    <published>2018-01-20T01:15:36.234Z</published>
    <updated>2018-02-07T06:26:10.321Z</updated>
    
    <content type="html"><![CDATA[<p>�̼���Ȩ�ص���ַ</p>
<blockquote>
<p>�ص���ַ����Ҫ��������ʹ�ÿ���ƽ̨oAuth2.0��ȡ��ȡSessionKey(��AccessToken)ʱ���������Ὣ��½��Ȩ�ɹ�������Ϣ���ظ��ص���ַ</p>
</blockquote>
<h3 id="API���÷�������"><a href="#API���÷�������" class="headerlink" title="API���÷�������"></a>API���÷�������</h3><p><a href="http://open.taobao.com/doc2/detail?spm=a219a.7386653.0.0.ZBzp5E&amp;articleId=101617&amp;docType=1#s3" target="_blank" rel="external">�ٷ��ĵ�</a></p>
<h3 id="�ٷ�SDKʹ��˵��"><a href="#�ٷ�SDKʹ��˵��" class="headerlink" title="�ٷ�SDKʹ��˵��"></a>�ٷ�SDKʹ��˵��</h3><p><a href="http://open.taobao.com/doc2/detail?spm=a219a.7386653.0.0.ZBzp5E&amp;articleId=101618&amp;docType=1" target="_blank" rel="external">�ٷ��ĵ�</a></p>
<h3 id="�u���E"><a href="#�u���E" class="headerlink" title="�û���Ȩ"></a>�û���Ȩ</h3><h4 id="y����Eurl"><a href="#y����Eurl" class="headerlink" title="ƴ����Ȩurl"></a>ƴ����Ȩurl</h4><p><a href="https://oauth.taobao.com/authorize?response_type=code&amp;client_id=" target="_blank" rel="external">https://oauth.taobao.com/authorize?response_type=code&amp;client_id=</a><br>24747068&amp;redirect_uri=<a href="http://wiki.kulchao.com/api/taobao/addcode&amp;state=1212&amp;view=wap" target="_blank" rel="external">http://wiki.kulchao.com/api/taobao/addcode&amp;state=1212&amp;view=wap</a></p>
<h3 id="���㹲��-token"><a href="#���㹲��-token" class="headerlink" title="���㹲�� token"></a>���㹲�� token</h3><p>ȫ�ִ洢,��ʱˢ��</p>
<ol>
<li>Access_Tokenȫ�ִ洢<blockquote>
<ol>
<li>�����˱���token���ļ�</li>
<li>���� sellerId ��ȡ��ͬ����Ȩ</li>
</ol>
</blockquote>
</li>
</ol>
<p>sellerid<br>    token<br>    refresh_token</p>
<p>��ʱ����:</p>
<h2 id="�Զ��徵������"><a href="#�Զ��徵������" class="headerlink" title="�Զ��徵������"></a>�Զ��徵������</h2><ol>
<li>�޸�listen�˿�-service nginx restart</li>
<li><p>�޸�ʱ��</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cp /usr/share/zoneinfo/Asia/Shanghai  /etc/localtime</div></pre></td></tr></table></figure>
</li>
<li><p>��װcron�����ö�ʱ����</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">apt-get install cron</div><div class="line"></div><div class="line">crontab -u www-data -e</div><div class="line"></div><div class="line">service cron restart</div></pre></td></tr></table></figure>
</li>
<li><p>�ӿڲ���</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">https://kuchaoyun.ews.m.jaeapp.com/api/taobao/favor/?sellerId=2636801283&amp;storeId=111&amp;saleId=123</div></pre></td></tr></table></figure>
</li>
<li><p>��������</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">add_header Access-Control-Allow-Origin *;</div><div class="line">add_header Access-Control-Allow-Headers X-Requested-With;</div><div class="line">add_header Access-Control-Allow-Methods GET,POST;</div></pre></td></tr></table></figure>
<pre><code>&lt;script&gt;
</code></pre><p>(function(){<br>    var bp = document.createElement(‘script’);<br>    var curProtocol = window.location.protocol.split(‘:’)[0];<br>    if (curProtocol === ‘https’) {<br>        bp.src = ‘<a href="https://zz.bdstatic.com/linksubmit/push.js" target="_blank" rel="external">https://zz.bdstatic.com/linksubmit/push.js</a>‘;<br>    }<br>    else {<br>        bp.src = ‘<a href="http://push.zhanzhang.baidu.com/push.js" target="_blank" rel="external">http://push.zhanzhang.baidu.com/push.js</a>‘;<br>    }<br>    var s = document.getElementsByTagName(“script”)[0];<br>    s.parentNode.insertBefore(bp, s);</p>
<pre><code>var sozzsrc = (document.location.protocol == &quot;http:&quot;) ? &quot;http://js.passport.qihucdn.com/11.0.1.js?6934e60f0fcbf5f113646cf0c3c61c6a&quot;:&quot;https://jspassport.ssl.qhimg.com/11.0.1.js?6934e60f0fcbf5f113646cf0c3c61c6a&quot;;
document.write(&apos;&lt;script src=&quot;&apos; + sozzsrc + &apos;&quot; id=&quot;sozz&quot;&gt;&lt;\/script&gt;&apos;);
</code></pre><p>})();<br></p>
]]></content>
    
    <summary type="html">
    
      server admin usage and note
    
    </summary>
    
      <category term="server" scheme="https://austinxishou.github.io/categories/server/"/>
    
    
      <category term="server" scheme="https://austinxishou.github.io/tags/server/"/>
    
  </entry>
  
  <entry>
    <title>composerʹ��</title>
    <link href="https://austinxishou.github.io/2018/01/18/server/php-composer-usage/"/>
    <id>https://austinxishou.github.io/2018/01/18/server/php-composer-usage/</id>
    <published>2018-01-18T13:19:11.241Z</published>
    <updated>2018-01-18T13:58:19.000Z</updated>
    
    <content type="html"><![CDATA[<p><a href="http://www.pfinal.cn/" target="_blank" rel="external">http://www.pfinal.cn/</a></p>
<h2 id="composer-������"><a href="#composer-������" class="headerlink" title="composer ������"></a>composer ������</h2><h2 id="composer-autoload-�Զ�����"><a href="#composer-autoload-�Զ�����" class="headerlink" title="composer autoload - �Զ�����"></a>composer autoload - �Զ�����</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&quot;autoload&quot;: &#123;</div><div class="line">        &quot;classmap&quot;: [</div><div class="line">            &quot;database/seeds&quot;,</div><div class="line">            &quot;database/factories&quot;</div><div class="line">        ],</div><div class="line">        &quot;psr-4&quot;: &#123;</div><div class="line">            &quot;App\\&quot;: &quot;app/&quot;,</div><div class="line">			&quot;&quot;</div><div class="line">        &#125;</div><div class="line">    &#125;,</div></pre></td></tr></table></figure>
<p>�����Զ������ļ�<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">composer dump-autoload</div></pre></td></tr></table></figure></p>
<p>��ȻҲ���������� <code>autoload_psr4.php</code> ������<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&apos;App\\&apos; =&gt; array($baseDir . &apos;/app&apos;),</div></pre></td></tr></table></figure><script><br>(function(){<br>    var bp = document.createElement(‘script’);<br>    var curProtocol = window.location.protocol.split(‘:’)[0];<br>    if (curProtocol === ‘https’) {<br>        bp.src = ‘<a href="https://zz.bdstatic.com/linksubmit/push.js">https://zz.bdstatic.com/linksubmit/push.js</a>‘;<br>    }<br>    else {<br>        bp.src = ‘<a href="http://push.zhanzhang.baidu.com/push.js">http://push.zhanzhang.baidu.com/push.js</a>‘;<br>    }<br>    var s = document.getElementsByTagName(“script”)[0];<br>    s.parentNode.insertBefore(bp, s);</p>
<pre><code>var sozzsrc = (document.location.protocol == &quot;http:&quot;) ? &quot;http://js.passport.qihucdn.com/11.0.1.js?6934e60f0fcbf5f113646cf0c3c61c6a&quot;:&quot;https://jspassport.ssl.qhimg.com/11.0.1.js?6934e60f0fcbf5f113646cf0c3c61c6a&quot;;
document.write(&apos;&lt;script src=&quot;&apos; + sozzsrc + &apos;&quot; id=&quot;sozz&quot;&gt;&lt;\/script&gt;&apos;);
</code></pre><p>})();<br></script></p>
]]></content>
    
    <summary type="html">
    
      server admin usage and note
    
    </summary>
    
      <category term="server" scheme="https://austinxishou.github.io/categories/server/"/>
    
    
      <category term="server" scheme="https://austinxishou.github.io/tags/server/"/>
    
  </entry>
  
  <entry>
    <title>server admin usage and note</title>
    <link href="https://austinxishou.github.io/2018/01/17/server/server-admin-usage-note/"/>
    <id>https://austinxishou.github.io/2018/01/17/server/server-admin-usage-note/</id>
    <published>2018-01-17T02:18:46.864Z</published>
    <updated>2018-01-21T02:40:57.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="����ssh-sftp"><a href="#����ssh-sftp" class="headerlink" title="����ssh-sftp"></a>����ssh-sftp</h2><pre><code>&gt; �ڷ������Ͽ�ͨSFTP�ļ�����������ĳЩ�û��ϴ��������ļ���������Щ�û�ֻ��ʹ��SFTP�����ļ�������ʹ��SSH�ն˷��ʷ�����������SFTP���ܷ���ϵͳ�ļ�������ν�ġ�Jail��������������ϵͳ����Ա������ʹ��SFTP�����ļ���Ҳ��ʹ��SSHԶ�̹�����������
</code></pre><ol>
<li><p>��װOpenSSH������</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install openssh-server</div></pre></td></tr></table></figure>
</li>
<li><p>ΪSFTP���ʴ����û��飬���ڹ���Ȩ��</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo addgroup sftp-users</div></pre></td></tr></table></figure>
</li>
<li><p>����SFTP�û�����������ӦȨ��</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">sudo adduser austin</div><div class="line">sudo usermod -G sftp-users -s /bin/false austin  </div><div class="line">//��austin�����������û������Ƴ������뵽sftp-users�飬���ҹر���Shell����</div><div class="line">// -s /bin/false ָ����¼shell,���ﲻ����ssh��¼</div></pre></td></tr></table></figure>
</li>
<li><p>����SSH�û��飬���ѹ���Ա���뵽����</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sudo addgroup ssh-users </div><div class="line">sudo usermod -a -G ssh-users admin  \\-a��������˼�ǲ��������û������Ƴ�</div><div class="line">sudo usermod -a -G ssh-users root \\��������root�û�ssh����</div></pre></td></tr></table></figure>
</li>
<li><p>׼�����������ĸ�Ŀ¼������Ŀ¼</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">sudo mkdir /home/sftp_root</div><div class="line">sudo mkdir /home/sftp_root/shared</div><div class="line">sudo chown admin:sftp-users /home/sftp_root/shared</div><div class="line">sudo chmod 770 /home/sftp_root/shared</div></pre></td></tr></table></figure>
<blockquote>
<p>���������ĸ�Ŀ¼������������Ҫ����������Ϊroot�������κ��û�������ӵ��д��Ȩ�ޡ����ˣ�Ϊ����SFTP�û��ܹ��ϴ��ļ����������ڡ���������Ŀ¼���ٴ���һ����ͨ�û��ܹ�д���Ĺ����ļ�Ŀ¼��Ϊ�˱��ڹ���Աͨ��SFTP�����ϴ����ļ����Ұ����������ļ�Ŀ¼����Ϊ����admin���У�����sftp-users��д������������Ա��SFTP�û�����Ա�Ͷ��ܶ�д����Ŀ¼�ˡ�</p>
</blockquote>
</li>
<li><p>�޸�SSH�����ļ�</p>
<blockquote>
<p>sudo nano /etc/ssh/sshd_config<br> ��sshd_config�ļ��������������������ݣ�</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">AllowGroups ssh-users sftp-users</div><div class="line">Match Group sftp-users</div><div class="line">    ChrootDirectory /home/sftp_root</div><div class="line">    AllowTcpForwarding no</div><div class="line">    X11Forwarding no</div><div class="line">    ForceCommand internal-sftp</div></pre></td></tr></table></figure>
</blockquote>
<p> ��Щ���ݵ���˼�ǣ�<br> ֻ����ssh-uers��sftp-usersͨ��SSH����ϵͳ��<br> ����sftp-users�û�����������һЩ���ã�����/home/sftp_root������Ϊ�����û���ϵͳ��Ŀ¼���������ǽ����ܷ��ʸ�Ŀ¼֮��������ϵͳ�ļ�������ֹTCP Forwarding��X11 Forwarding��ǿ�Ƹ����û�����ʹ��SFTP��</p>
</li>
<li><p>service sshd reload</p>
</li>
</ol>
<h3 id="DEBUG"><a href="#DEBUG" class="headerlink" title="DEBUG"></a>DEBUG</h3><pre><code>&gt; SFTP �C subsystem request failed on channel X
</code></pre><p>   �޸�:</p>
<blockquote>
<p>You are using sftp to connect your server in a chrooted environment and you met the error below.</p>
</blockquote>
<pre><code>subsystem request failed on channel 0
Couldn��t read packet: Connection reset by peer

This causes because of wrong external library configured in your sshd_config. So, edit your sshd_config and use internal-sftp. Because openssh already has internal sftp functionality and you dont need any external libraries.

Find the line beginning with ��Subsystem��. Comment out and add the following line.

<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#Subsystem sftp /usr/lib/openssh/sftp-server</div><div class="line">Subsystem sftp internal-sftp</div></pre></td></tr></table></figure>
</code></pre><h2 id="���o�ʱ����"><a href="#���o�ʱ����" class="headerlink" title="���ö�ʱ����"></a>���ö�ʱ����</h2><pre><code>1. crontabl����
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">crontab: invalid option -- &apos;h&apos;</div><div class="line">crontab: usage error: unrecognized option</div><div class="line">usage:	crontab [-u user] file</div><div class="line">	crontab [ -u user ] [ -i ] &#123; -e | -l | -r &#125;</div><div class="line">		(default operation is replace, per 1003.2)</div><div class="line">	-e	(edit user&apos;s crontab)</div><div class="line">	-l	(list user&apos;s crontab)</div><div class="line">	-r	(delete user&apos;s crontab)</div><div class="line">	-i	(prompt before deleting user&apos;s crontab)</div></pre></td></tr></table></figure>


2. �༭���Ӷ�ʱ���� crontabl -u root -e

<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">* * * * * php /home/forge/default/artisan  schedule:run &gt;&gt; /dev/null 2&gt;&amp;1</div><div class="line">//������crontab�ĸ�ʽ��</div><div class="line">//�� ʱ �� �� ���� Ҫ���е�����</div></pre></td></tr></table></figure>


3. ȷ��cmd�ܹ�����ִ��
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">php /home/forge/default/artisan  schedule:run</div></pre></td></tr></table></figure>


4. �鿴cron����
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">//�鿴״̬</div><div class="line">/etc/init.d/cron status</div><div class="line"></div><div class="line">//����cron����</div><div class="line">/etc/init.d/cron restart</div></pre></td></tr></table></figure>

&lt;script&gt;
</code></pre><p>(function(){<br>    var bp = document.createElement(‘script’);<br>    var curProtocol = window.location.protocol.split(‘:’)[0];<br>    if (curProtocol === ‘https’) {<br>        bp.src = ‘<a href="https://zz.bdstatic.com/linksubmit/push.js" target="_blank" rel="external">https://zz.bdstatic.com/linksubmit/push.js</a>‘;<br>    }<br>    else {<br>        bp.src = ‘<a href="http://push.zhanzhang.baidu.com/push.js" target="_blank" rel="external">http://push.zhanzhang.baidu.com/push.js</a>‘;<br>    }<br>    var s = document.getElementsByTagName(“script”)[0];<br>    s.parentNode.insertBefore(bp, s);</p>
<pre><code>var sozzsrc = (document.location.protocol == &quot;http:&quot;) ? &quot;http://js.passport.qihucdn.com/11.0.1.js?6934e60f0fcbf5f113646cf0c3c61c6a&quot;:&quot;https://jspassport.ssl.qhimg.com/11.0.1.js?6934e60f0fcbf5f113646cf0c3c61c6a&quot;;
document.write(&apos;&lt;script src=&quot;&apos; + sozzsrc + &apos;&quot; id=&quot;sozz&quot;&gt;&lt;\/script&gt;&apos;);
</code></pre><p>})();<br></p>
]]></content>
    
    <summary type="html">
    
      server admin usage and note
    
    </summary>
    
      <category term="server" scheme="https://austinxishou.github.io/categories/server/"/>
    
    
      <category term="server" scheme="https://austinxishou.github.io/tags/server/"/>
    
  </entry>
  
  <entry>
    <title>docker ʹ�ñʼ�</title>
    <link href="https://austinxishou.github.io/2018/01/15/server/docker-note-useage/"/>
    <id>https://austinxishou.github.io/2018/01/15/server/docker-note-useage/</id>
    <published>2018-01-15T01:18:42.376Z</published>
    <updated>2018-02-04T23:55:34.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="About-����"><a href="#About-����" class="headerlink" title="About-����"></a>About-����</h2><p><a href="https://www.cnblogs.com/linuxops/p/6781047.html" target="_blank" rel="external">�ο��ĵ�</a></p>
<blockquote>
<p>Docker��ʹ��go���Ի���LINUX�ں˵�cgroup��namespace�Լ�AUFS ���� Union FS �ȼ������Խ��̽��з�װ������һ�ֲ���ϵͳ���������⻯���������ڸ����Ľ��̶����������������ĸ����Ľ��̣�����Ҳ����Ϊ������</p>
</blockquote>
<h3 id="Docker�ʹ�ͳ���⻯�����KԱ�"><a href="#Docker�ʹ�ͳ���⻯�����KԱ�" class="headerlink" title="Docker�ʹ�ͳ���⻯�����ĶԱ�"></a>Docker�ʹ�ͳ���⻯�����ĶԱ�</h3><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/images/kvm-vs-docker.png" alt="kvm-vs-docker" title="">
                </div>
                <div class="image-caption">kvm-vs-docker</div>
            </figure>
<h3 id="ΪʲoҪʹ��-Docker"><a href="#ΪʲoҪʹ��-Docker" class="headerlink" title="ΪʲôҪʹ�� Docker"></a>ΪʲôҪʹ�� Docker</h3><ul>
<li><strong>����Ч������ϵͳ��Դ</strong><ul>
<li>����Docker�����ڽ��̼��𣬲���Ҫ����Ӳ�������Լ�������������ϵͳ�ȶ��⿪��������Docker��ϵͳ��Դ�������ʸ��ߡ�����������������һ����ͬ���õ������������������и���������Ӧ�á�</li>
</ul>
</li>
<li><strong>�����ٵ�����ʱ��</strong><ul>
<li>��ͳ����������������Ӧ�÷���������Ҫ�����ӣ��� Docker����Ӧ�ã�����ֱ�������������ںˣ��������������Ĳ���ϵͳ�����˿��������뼶���������뼶������ʱ�䡣�����Ľ�Լ�˿��������ԡ�������ʱ�䡣</li>
</ul>
</li>
<li><strong>һ�µ����л���</strong><ul>
<li>���ڿ������������Ի���������������һ�£�������Щ bug ��δ�ڿ��������б����֡�Docker �ľ����ṩ�˳��ں�������������ʱ������ȷ����Ӧ�����л���һ���ԣ��Ӷ������ٳ��� �����δ������һ�����û���Ⱑ�� �������⡣</li>
</ul>
</li>
<li><strong>���������Ͳ���</strong><ul>
<li>һ�δ������������С�ͨ������Ӧ�þ�����ʵ�ֳ������ɡ��������������𡣿�����Ա����ͨ�� Dockerfile �����о��񹹽��������ϳ�������(Continuous Integration)ϵͳ���м��ɲ��ԣ�����ά��Ա������ֱ�������������п��ٲ����þ������������� ��������(Continuous Delivery/Deployment) ϵͳ�����Զ����𡣶���ʹ�� Dockerfile ʹ���񹹽�͸�����������������Ŷӿ�������Ӧ�����л�����Ҳ������ά�Ŷ�����Ӧ�����������������������õ����������в����þ�����</li>
</ul>
</li>
<li><strong>�����ɵ�Ǩ��</strong><ul>
<li>Docker ȷ����ִ�л�����һ���ԣ����������������������������ơ�˽���ƣ������ǱʼǱ��������н�����һ�µġ����˿��Ժ�����Ǩ�Ƶ������ϣ������õ������л����ı仯����Ӧ���޷��������е�������</li>
</ul>
</li>
<li><strong>�����ɵ�ά������չ</strong><ul>
<li>Docker ʹ�õķֲ��洢�Լ������ļ�����Docker �Ŷ�ͬ������Դ��Ŀ�Ŷ�һ��ά����һ�����������Ĺٷ����񣬼ȿ���ֱ������������ʹ�ã��ֿ�����Ϊ������һ�����ơ�</li>
</ul>
</li>
</ul>
<h2 id="Docker�L�������"><a href="#Docker�L�������" class="headerlink" title="Docker�Ļ�������"></a>Docker�Ļ�������</h2><h3 id="Docker-����"><a href="#Docker-����" class="headerlink" title="Docker ����"></a>Docker ����</h3><pre><code>���Ƕ�֪��������ϵͳ��Ϊ�ں˺��û��ռ䡣���� Linux ���ԣ��ں������󣬻����ظ��ļ�ϵͳΪ���ṩ�û��ռ�֧�֡��� Docker ������Image�������൱����һ�����ļ�ϵͳ��Docker ������һ���������ļ�ϵͳ�������ṩ��������ʱ�����ĳ��򡢿⡢��Դ�����õ��ļ��⣬��������һЩΪ����ʱ׼����һЩ���ò��������������������������û��ȣ������񲻰����κζ�̬���ݣ��������ڹ���֮��Ҳ���ᱻ�ı䡣
</code></pre><h3 id="�ֲ��洢"><a href="#�ֲ��洢" class="headerlink" title="�ֲ��洢"></a>�ֲ��洢</h3><pre><code>��Ϊ������������ϵͳ�����ĸ��ļ�ϵͳ���������������Ӵ��ģ������� Docker ����ʱ���ͳ������� Union FS �ļ�������������Ϊ�ֲ��洢�ļܹ��������ϸ���˵�����񲢷�����һ�� ISO �����Ĵ����ļ�������ֻ��һ�������ĸ����ʵ�����ֲ�����һ���ļ����ɣ�������һ���ļ�ϵͳ���ɣ�����˵���ɶ����ļ�ϵͳ�������ɡ�
���񹹽�ʱ����һ���㹹����ǰһ���Ǻ�һ���Ļ�����ÿһ�㹹�����Ͳ����ٷ����ı䣬��һ���ϵ��κθı�ֻ�������Լ���һ�㡣���磬ɾ��ǰһ���ļ��Ĳ�����ʵ�ʲ�������ɾ��ǰһ�����ļ������ǽ��ڵ�ǰ������Ϊ���ļ���ɾ�����������������е�ʱ������Ȼ���ῴ�������ļ�������ʵ���ϸ��ļ���һֱ���澵�������ˣ��ڹ���������ʱ������Ҫ����С�ģ�ÿһ�㾡��ֻ�����ò���Ҫ���ӵĶ������κζ����Ķ���Ӧ���ڸò㹹������ǰ��������

�ֲ��洢��������ʹ�þ����ĸ��á����Ʊ��ĸ�Ϊ���ס�����������֮ǰ�����õľ�����Ϊ�����㣬Ȼ����һ�������µĲ㣬�Զ����Լ����������ݣ������µľ�����
</code></pre><h3 id="Docker-����-1"><a href="#Docker-����-1" class="headerlink" title="Docker ����"></a>Docker ����</h3><pre><code>������Image����������Container���Ĺ�ϵ�������������������������е�����ʵ��һ���������Ǿ�̬�Ķ��壬�����Ǿ�������ʱ��ʵ�塣�������Ա�������������ֹͣ��ɾ������ͣ�ȡ�

������ʵ���ǽ��̣�����ֱ��������ִ�еĽ��̲�ͬ���������������������Լ��Ķ����������ռ䡣������������ӵ���Լ��ĸ��ļ�ϵͳ���Լ����������á��Լ��Ľ��̿ռ䣬�����Լ����û� ID �ռ䡣�����ڵĽ�����������һ�������Ļ����ʹ���������ͺ�������һ��������������ϵͳ�²���һ������������ʹ��������װ��Ӧ�ñ�ֱ�����������и��Ӱ�ȫ��

ǰ�潲������ʹ�õ��Ƿֲ��洢������Ҳ�����ˡ�ÿһ����������ʱ�����Ծ���Ϊ�����㣬�����ϴ���һ����ǰ�����Ĵ洢�㣬���ǿ��Գ�����Ϊ��������ʱ��д��׼���Ĵ洢��Ϊ�����洢�㡣

�����洢�����������ں�����һ������������ʱ�������洢��Ҳ��֮���������ˣ��κα����������洢������Ϣ����������ɾ������ʧ��

���� Docker ����ʵ����Ҫ����������Ӧ�������洢����д���κ����ݣ������洢��Ҫ������״̬�������е��ļ�д����������Ӧ��ʹ�� ���ݾ���Volume�������߰�������Ŀ¼������Щλ�õĶ�д�����������洢�㣬ֱ�Ӷ�����(�������洢)������д�������ܺ��ȶ��Ը��ߡ�

���ݾ����������ڶ������������������������ݾ��������������ˣ�ʹ�����ݾ�����������������ɾ�����������У�����ȴ���ᶪʧ��
</code></pre><h3 id="Docker-Registry"><a href="#Docker-Registry" class="headerlink" title="Docker Registry"></a>Docker Registry</h3><pre><code>Docker Registry �ṩ�˾����ļ��еĴ洢���ַ����ܡ�һ�� Docker Registry �п��԰��������ֿ⣨Repository����ÿ���ֿ����԰���������ǩ��Tag����ͨ�� &lt;�ֿ���&gt;:&lt;��ǩ&gt; �ĸ�ʽ��ָ�����������������ĸ��汾�ľ�����Docker Registry ��Ϊ���з�����˽�з��������ǿ��Դһ�����ڱ��ص�registry
</code></pre><h2 id="Docker-����-2"><a href="#Docker-����-2" class="headerlink" title="Docker ����"></a>Docker ����</h2><h3 id="��װdocker"><a href="#��װdocker" class="headerlink" title="��װdocker"></a>��װdocker</h3><pre><code>������Ubuntu��,����ֱ������:

<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">apt-get install docker</div></pre></td></tr></table></figure>
</code></pre><h3 id="���þ�������"><a href="#���þ�������" class="headerlink" title="���þ�������"></a>���þ�������</h3><pre><code>���ڹ��ڷ���dockerԭվ���ǳ����ѣ����ڵ��Ʒ����ṩ���ṩ�˼��ٹ��ܡ�����ʹ�ð����ƽ���docker����
��ַΪ: https://dev.aliyun.com/search.html

<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sed -i &quot;s|ExecStart=/usr/bin/dockerd|ExecStart=/usr/bin/dockerd --registry-mirror=https://fz5yth0r.mirror.aliyuncs.com|g&quot; /usr/lib/systemd/system/docker.service</div><div class="line">systemctl daemon-reload</div><div class="line">systemctl restart docker</div></pre></td></tr></table></figure>
</code></pre><h3 id="ʹ�þ���"><a href="#ʹ�þ���" class="headerlink" title="ʹ�þ���"></a>ʹ�þ���</h3><ul>
<li><p><strong>��ȡ����</strong></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker pull [OPTIONS] NAME[:TAG|@DIGEST]</div></pre></td></tr></table></figure>
</li>
<li><p><strong>�г�����</strong></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[root@node1 docker]# docker images</div><div class="line">#�ֿ���             #��ǩ                #����ID             #����ʱ��            #��С</div><div class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</div><div class="line">centos              latest              98d35105a391        7 days ago          192 MB</div><div class="line"></div><div class="line">docker images  -a //ʹ��-a��������ʾ�м��㾵����</div><div class="line"></div><div class="line">//����ָ����ʽ����</div><div class="line">docker images   --format &quot;table &#123;&#123;.ID&#125;&#125;\t&#123;&#123;.Repository&#125;&#125;\t&#123;&#123;.Tag&#125;&#125;&quot;</div></pre></td></tr></table></figure>
</li>
<li><p><strong>Docker ����</strong></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">//ʹ��nginx ��������һ������������Ϊ webserver�����Ұ�������80�˿�ӳ������������80�˿ڡ�</div><div class="line">docker run --name webserver -d -p 80:80 nginx</div></pre></td></tr></table></figure>
</li>
<li><p><strong>Docker commit</strong></p>
<ul>
<li>�����޸��������Ĵ洢�㣬ʹ��docker diff �鿴�ļ��ĸĶ�</li>
<li>���ƺ�ҳ��֮�󣬱���Ϊ���񣬵���������һ��������ʱ����������ʹ�þ��Ļ��������������κ��ļ��޸Ķ��ᱻ��¼�������洢���</li>
<li><p>�� Docker �ṩ��һ�� docker commit ������Խ������Ĵ洢�㱣��������Ϊ���񡣻��仰˵��������ԭ�о����Ļ����ϣ��ٵ����������Ĵ洢�㣬�������µľ�����</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">docker commit \</div><div class="line">   --author &quot;austin &lt;xxx@163.com&gt;&quot; \</div><div class="line">   --message &quot;�޸ĳ�ʼ��ҳ&quot; \</div><div class="line">   webserver \</div><div class="line">   nginx:v2</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<pre><code>- �������� docker history �����鿴�����ڵ���ʷ��¼�������Ƚ� nginx:latest ����ʷ��¼

- ���� docker commit
&gt; �۲�֮ǰ�� docker diff webserver �Ľ��������ᷢ�ֳ���������Ҫ�޸ĵ� /usr/share/nginx/html/index.html �ļ��⣬���кܶ��ļ����Ķ��������ˡ������ǰ�װ�����������빹�����ǻ��д������޹����ݱ����ӽ��������ᵼ�¾�����Ϊӷ�ס�

ʹ�� docker commit ��ζ�ų���������������֪��ִ�й�ʲô�����ô���ɵľ��񣬱��˸����޴ӵ�֪�����ң���ʹ�����������������ˣ���һ��ʱ����Ҳ�޷����������ڲ����ġ�

����ʹ�� docker commit ��������������ֻ�ڵ�ǰ�������������޸ĵĻ���ÿһ���޸Ķ����þ�������ӷ��һ�Σ���ɾ������һ���Ķ��������ᶪʧ����һֱ��Ӱ���εĸ�������������
��ʹ�����޷����ʵ�?�������þ�������ӷ�ס�

docker commit ��������ѧϰ֮�⣬����һЩ������Ӧ�ó��ϣ����类���ֺ󱣴��ֳ��ȡ����ǣ���Ҫʹ�� docker commit ���ƾ��񣬶�����ΪӦ��ʹ�� Dockerfile �����ɡ�
</code></pre><h3 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h3><pre><code>Dockerfile��һ���ı��ļ������������������ƾ�����֮ǰʹ�� docker commit �ἰ���޷��ظ������⡢���񹹽�͸���Ե����⡢�����������Ͷ���������
ʹ��docker file ����nginx����

<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">FROM nginx</div><div class="line">RUN echo &apos;&lt;h1&gt;Hello, Docker!&lt;/h1&gt;&apos; &gt; /usr/share/nginx/html/index.html</div></pre></td></tr></table></figure>
</code></pre><ul>
<li><p><strong>FROM</strong></p>
<ul>
<li><p>ָ��һ���������񣬿���ֱ������ʹ�õķ������ľ�������ubuntu��debian��centos��fedora��alpine��nginx��redis��mongo��mysql��httpd��php��tomcat �ȡ�</p>
</li>
<li><p>ָ��һ���հ׾���</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">FROM scratch</div><div class="line">RUN  ...</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>RUN</strong></p>
<ul>
<li><p>RUN ָ��������ִ���������������ʽ�����֡�</p>
<ul>
<li><p>SHELL��ʽ��</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">RUN echo &apos;&lt;h1&gt;Hello, Docker!&lt;/h1&gt;&apos; &gt; /usr/share/nginx/html/index.html</div></pre></td></tr></table></figure>
</li>
<li><p>exec ��ʽ:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">RUN [&quot;��ִ���ļ�&quot;, &quot;����1&quot;, &quot;����2&quot;]</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>��ʹ��shellģʽ��дʱ��������ÿ�����дһ��RUN��ÿһ�� RUN ����Ϊ���ͺ͸ղ������ֹ����������Ĺ���һ�����½���һ�㣬������ִ����Щ���ִ�н�������commit ��һ�����޸ģ������µľ�����Union FS ���������������Ƶģ����� AUFS�����������󲻵ó��� 42 �㣬�����ǲ��ó��� 127 �㡣</p>
</li>
<li><p>��ȷdockerfileд��</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">FROM debian:jessie</div><div class="line"></div><div class="line">RUN buildDeps=&apos;gcc libc6-dev make&apos; \</div><div class="line">   &amp;&amp; apt-get update \</div><div class="line">   &amp;&amp; apt-get install -y $buildDeps \</div><div class="line">   &amp;&amp; wget -O redis.tar.gz &quot;http://download.redis.io/releases/redis-3.2.5.tar.gz&quot; \</div><div class="line">   &amp;&amp; mkdir -p /usr/src/redis \</div><div class="line">   &amp;&amp; tar -xzf redis.tar.gz -C /usr/src/redis --strip-components=1 \</div><div class="line">   &amp;&amp; make -C /usr/src/redis \</div><div class="line">   &amp;&amp; make -C /usr/src/redis install \</div><div class="line">   &amp;&amp; rm -rf /var/lib/apt/lists/* \</div><div class="line">   &amp;&amp; rm redis.tar.gz \</div><div class="line">   &amp;&amp; rm -r /usr/src/redis \</div><div class="line">   &amp;&amp; apt-get purge -y --auto-remove $buildDeps</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<pre><code>- ��������д����
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">FROM debian:jessie</div><div class="line"></div><div class="line">RUN apt-get update</div><div class="line">RUN apt-get install -y gcc libc6-dev make</div><div class="line">RUN wget -O redis.tar.gz &quot;http://download.redis.io/releases/redis-3.2.5.tar.gz&quot;</div><div class="line">RUN mkdir -p /usr/src/redis</div><div class="line">RUN tar -xzf redis.tar.gz -C /usr/src/redis --strip-components=1</div><div class="line">RUN make -C /usr/src/redis</div><div class="line">RUN make -C /usr/src/redis install</div></pre></td></tr></table></figure>
</code></pre><ul>
<li><p><strong>��������</strong></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker build -t nginx:v3 .</div></pre></td></tr></table></figure>
<blockquote>
<p>���񹹽������ģ�Context��</p>
</blockquote>
</li>
<li><p><strong>COPY</strong></p>
<ul>
<li><p>SHELL��ʽ��</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">COPY &lt;Դ·��&gt;... &lt;Ŀ��·��&gt;</div></pre></td></tr></table></figure>
<ul>
<li>exec ��ʽ:<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">	COPY [&quot;&lt;Դ·��1&gt;&quot;,... &quot;&lt;Ŀ��·��&gt;&quot;]</div><div class="line">	``` </div><div class="line">- Դ·��&quot;�����Ƕ�����Ҳ������ͨ��������ͨ��������Ҫ���� Go �� filepath.Match �������磺</div></pre></td></tr></table></figure>
</li>
</ul>
<p>COPY hom* /mydir/<br>COPY hom?.txt /mydir/</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">	</div><div class="line">	&gt; &quot;Ŀ��·��&quot;�����������ڵľ���·����Ҳ�����������ڹ���Ŀ¼������·��������Ŀ¼������ WORKDIRָ����ָ������Ŀ��·������Ҫ���ȴ���������Ŀ¼�����ڻ��ڸ����ļ�ǰ���д���ȱʧĿ¼��</div><div class="line">	ʹ�� COPY ָ�Դ�ļ��ĸ���Ԫ���ݶ��ᱣ������������д��ִ��Ȩ�ޡ��ļ�����ʱ���ȡ��������Զ��ھ������ƺ����á��ر��ǹ��������ļ�����ʹ�� Git ���й�����ʱ����</div><div class="line"></div><div class="line"></div><div class="line">- **ADD**</div><div class="line">	&quot;Դ·��&quot;������һ�� URL�����������£�Docker ��������ͼȥ�����������ӵ��ļ��ŵ�&quot;Ŀ��·��&quot;�����غ����ļ�Ȩ���Զ�����Ϊ600��</div><div class="line"></div><div class="line">	�����Ⲣ������Ҫ��Ȩ�ޣ���ô����Ҫ���Ӷ�����һ�� RUN ����Ȩ�޵�����</div><div class="line"></div><div class="line">	����&quot;Դ·��&quot;Ϊһ�� tar.gzip,tar.bzip2,tar.xz���ļ���ADD ָ����Զ���ѹ������ѹ���ļ���&quot;Ŀ��·��&quot;ȥ��</div></pre></td></tr></table></figure>
<p>FROM scratch<br>ADD ubuntu-xenial-core-cloudimg-amd64-root.tar.gz /</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">	</div><div class="line">	�� Docker �ٷ�������ʵ���ĵ���Ҫ�󣬾����ܵ�ʹ�� COPY����Ϊ COPY ����������ȷ�����Ǹ����ļ����ѣ��� ADD �������˸����ӵĹ��ܣ�����ΪҲ��һ�������������ʺ�ʹ�� ADD �ĳ��ϣ��������ἰ����Ҫ�Զ���ѹ���ĳ��ϡ�</div><div class="line"></div><div class="line">	</div><div class="line">- **CMD**</div><div class="line">	- CMD ָ���ĸ�ʽ�� RUN ���ƣ�Ҳ�����ָ�ʽ��</div><div class="line">	- SHELL��ʽ��</div></pre></td></tr></table></figure>
<p>  CMD &lt;����&gt;</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- exec ��ʽ:</div></pre></td></tr></table></figure>
<p>  CMD [“��ִ���ļ�”, “����1”, “����2”…]</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- �����б���ʽ</div></pre></td></tr></table></figure>
<p>  CMD [“����1”, “����2”…]��</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">��ָ���� ENTRYPOINT ָ�������� CMD ָ�������Ĳ�����</div><div class="line"></div><div class="line">&gt; ֮ǰ����������ʱ������˵����Docker �������������������ǽ��̡���Ȼ�ǽ��̣���ô������������ʱ������Ҫָ�������еĳ��򼰲�����CMD ָ����������ָ��Ĭ�ϵ����������̵����������ġ�</div><div class="line"></div><div class="line">&gt; ������ʱ����ָ���µ��������������������е�����Ĭ���������Ĭ�ϵ� CMD �� `/bin/bash` ����������ֱ�� `docker run -it centos` �Ļ�����ֱ�ӽ��� `bash`������Ҳ����������ʱָ�����б�������� `docker run -it ubuntu cat /etc/os-release`���������� `cat /etc/os-release`�����滻��Ĭ�ϵ� `/bin/bash `�����ˣ�������ϵͳ�汾��Ϣ��</div><div class="line"></div><div class="line">��ָ����ʽ�ϣ�һ���Ƽ�ʹ�� exec ��ʽ��������ʽ�ڽ���ʱ�ᱻ����Ϊ JSON ���飬����һ��Ҫʹ��˫���� &quot;������Ҫʹ�õ����š�</div><div class="line"></div><div class="line">����ʹ�� shell ��ʽ�Ļ���ʵ�ʵ������ᱻ��װΪsh -c �Ĳ�������ʽ����ִ�С����磺</div></pre></td></tr></table></figure>
<p>CMD echo $HOME</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">��ʵ��ִ���У��Ὣ������Ϊ��</div></pre></td></tr></table></figure>
<p>CMD [ “sh”, “-c”, “echo $HOME” ]</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">������Ϊʲô���ǿ���ʹ�û���������ԭ������Ϊ��Щ���������ᱻ shell ���н���������</div><div class="line">Docker �����������������е�Ӧ�ö�Ӧ����ǰִ̨�У����������������������������������� upstart/systemd ȥ������̨������������û�к�̨�����ĸ��</div><div class="line"></div><div class="line">һЩ��ѧ�߽� CMD дΪ��</div></pre></td></tr></table></figure>
<p>CMD service nginx start</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">Ȼ����������ִ�к��������˳��ˡ�������������ȥʹ�� `systemctl `��������ȴ���ָ���ִ�в��ˡ���������Ϊû�и�����ǰ̨����̨�ĸ��û�������������������Ĳ��죬�������Դ�ͳ�������ĽǶ�ȥ����������</div><div class="line"></div><div class="line">�����������ԣ���������������`����Ӧ�ý���`����������Ϊ�������̶����ڵģ��������˳���������ʧȥ�˴��ڵ����壬�Ӷ��˳��������������̲�������Ҫ���ĵĶ�����</div><div class="line"></div><div class="line">��ʹ��`service nginx start`�������ϣ�� `upstart` ���Ժ�̨�ػ�������ʽ���� `nginx` ���񡣶��ղ�˵�� `CMD service nginx start` �ᱻ����Ϊ `CMD [ &quot;sh&quot;, &quot;-c&quot;, &quot;service nginx start&quot;]`������������ʵ������` sh`����ô�� `service nginx start` ������������`sh` Ҳ�ͽ����ˣ�`sh` ��Ϊ�������˳��ˣ���Ȼ�ͻ��������˳���</div><div class="line"></div><div class="line">��ȷ��������ֱ��ִ�� `nginx` ��ִ���ļ�������Ҫ����ǰ̨��ʽ���С����磺</div></pre></td></tr></table></figure>
<p>CMD [“nginx”, “-g”, “daemon off;”]</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">- **ENTRYPOINT**</div><div class="line">	</div><div class="line">	&gt; `ENTRYPOINT` ��Ŀ�ĺ� `CMD` һ����������ָ�������������򼰲�����`ENTRYPOINT` ������ʱҲ���������������� `CMD` Ҫ���Է�������Ҫͨ�� `docker run` �Ĳ��� `--entrypoint` ��ָ����</div><div class="line">	��ָ���� ENTRYPOINT ����`CMD` �ĺ����ͷ����˸ı䣬������ֱ�ӵ�������������ǽ� `CMD` ��������Ϊ�������� `ENTRYPOINT` ָ����仰˵ʵ��ִ��ʱ������Ϊ��</div></pre></td></tr></table></figure>
<p><entrypoint> “<cmd>“</cmd></entrypoint></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">����һ���þ�������������һ��ʹ��</div><div class="line">����������Ҫһ����֪�Լ���ǰ���� IP �ľ�������ô�������� CMD ��ʵ�֣�</div></pre></td></tr></table></figure>
<p>mkdir ~/myip/<br>cd ~/myip/<br>tee Dockerfile &lt;&lt;’EOF’<br>FROM centos<br>RUN  yum -y install wget \<br>   &amp;&amp; wget -O /etc/yum.repos.d/CentOS-Base.repo <a href="http://mirrors.aliyun.com/repo/Centos-7.repo" target="_blank" rel="external">http://mirrors.aliyun.com/repo/Centos-7.repo</a> \<br>   &amp;&amp;wget -O /etc/yum.repos.d/epel.repo <a href="http://mirrors.aliyun.com/repo/epel-7.repo" target="_blank" rel="external">http://mirrors.aliyun.com/repo/epel-7.repo</a> \<br>   &amp;&amp;yum -y install  curl<br>CMD [ “curl”, “-s”, “<a href="http://ip.cn" target="_blank" rel="external">http://ip.cn</a>“ ]<br>EOF<br>docker build  -t myip .</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">����һ����������</div></pre></td></tr></table></figure>
<p>[root@node1 myip]# docker run  myip<br>��ǰ IP��123.117.85.77 ���ԣ������� ��ͨ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">��ô��������������ֱ�ӰѾ�����������ʹ���ˣ���������ϣ���Ӳ����أ�</div><div class="line">�������� CMD �п��Կ���ʵ�ʵ������� curl����ô��������ϣ����ʾ HTTP ͷ��Ϣ������Ҫ���� -i ��������ô���ǿ���ֱ�Ӽ� -i ������ docker run myip ô��</div></pre></td></tr></table></figure>
<p>[root@node1 myip]# docker rum myip -i<br>unknown shorthand flag: ‘i’ in -i<br>See ‘docker –help’.<br>…</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">���ھ������������� command������ʱ���滻 CMD ��Ĭ��ֵ������������ -i �滻��ԭ���� CMD��������������ԭ���� curl -s http://ip.cn ���档�� -i �����������������Ȼ�Ҳ�����</div><div class="line"></div><div class="line">��������ϣ������ -i �����������Ǿͱ������������������������</div></pre></td></tr></table></figure>
<p>[root@node1 myip]# docker run myip curl -s <a href="http://ip.cn" target="_blank" rel="external">http://ip.cn</a> -i<br>HTTP/1.1 200 OK<br>Server: nginx/1.10.0 (Ubuntu)<br>Date: Fri, 24 Mar 2017 02:21:43 GMT<br>Content-Type: text/html; charset=UTF-8<br>Transfer-Encoding: chunked<br>Connection: keep-alive</p>
<p>��ǰ IP��123.117.85.77 ���ԣ������� </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">��ʹ�� ENTRYPOINT �Ϳ��Ը� docker ���Σ��޸�docker����</div></pre></td></tr></table></figure>
<p>cd ~/myip/<br>tee Dockerfile &lt;&lt;’EOF’<br>FROM centos<br>RUN  yum -y install wget \<br>   &amp;&amp; wget -O /etc/yum.repos.d/CentOS-Base.repo <a href="http://mirrors.aliyun.com/repo/Centos-7.repo" target="_blank" rel="external">http://mirrors.aliyun.com/repo/Centos-7.repo</a> \<br>   &amp;&amp;wget -O /etc/yum.repos.d/epel.repo <a href="http://mirrors.aliyun.com/repo/epel-7.repo" target="_blank" rel="external">http://mirrors.aliyun.com/repo/epel-7.repo</a> \<br>   &amp;&amp;yum -y install  curl<br>ENTRYPOINT [ “curl”, “-s”, “<a href="http://ip.cn" target="_blank" rel="external">http://ip.cn</a>“ ]<br>EOF<br>docker build  -t myip .</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">�ٴ�����</div></pre></td></tr></table></figure>
<p>[root@node1 myip]# docker run myip<br>��ǰ IP��123.117.85.77 ���ԣ�������</p>
</li>
</ul>
</li>
</ul>
<pre><code>[root@node1 myip]# docker run myip -i
HTTP/1.1 200 OK
Server: nginx/1.10.0 (Ubuntu)
Date: Fri, 24 Mar 2017 02:24:42 GMT
Content-Type: text/html; charset=UTF-8
Transfer-Encoding: chunked
Connection: keep-alive

��ǰ IP��123.117.85.77 ���ԣ�������

<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">��������Ӧ������ǰ��׼������</div><div class="line">[redis�Ĺٷ�dockerfile]( https://github.com/docker-library/redis/blob/master/3.2/alpine/Dockerfile)</div></pre></td></tr></table></figure>

FROM alpine:3.5
...
RUN addgroup -S redis &amp;&amp; adduser -S -G redis redis
...
ENTRYPOINT [&quot;docker-entrypoint.sh&quot;]

EXPOSE 6379
CMD [ &quot;redis-server&quot; ]
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">���Կ�������Ϊ�� redis ���񴴽��� redis �û�����������ָ���� ENTRYPOINT Ϊ docker-entrypoint.sh �ű���</div></pre></td></tr></table></figure>

#!/bin/sh
...
# allow the container to be started with `--user`
if [ &quot;$1&quot; = &apos;redis-server&apos; -a &quot;$(id -u)&quot; = &apos;0&apos; ]; then
    chown -R redis .
    exec su-exec redis &quot;$0&quot; &quot;$@&quot;
fi

exec &quot;$@&quot;
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">�ýű������ݾ��Ǹ��� CMD ���������жϣ������� `redis-server` �Ļ������л��� `redis` �û�������������������������ʹ�� `root `����ִ�С����磺</div></pre></td></tr></table></figure>

$ docker run -it redis id
uid=0(root) gid=0(root) groups=0(root)
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">- **ENV ���û�������**</div><div class="line">	��ʽ�����֣�</div><div class="line">		- `ENV &lt;key&gt; &lt;value&gt;`</div><div class="line">		- `ENV &lt;key1&gt;=&lt;value1&gt; &lt;key2&gt;=&lt;value2&gt;...`</div><div class="line">	����ָ���ܼ򵥣��������û����������ѣ������Ǻ���������ָ��� RUN����������ʱ��Ӧ�ã�������ֱ��ʹ�����ﶨ���Ļ���������</div></pre></td></tr></table></figure>

ENV VERSION=1.0 DEBUG=on \
NAME=&quot;Happy Feet&quot;
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">- **ARG ��������**</div><div class="line">	- ��ʽ��</div><div class="line">		`ARG &lt;������&gt;[=&lt;Ĭ��ֵ&gt;]`</div><div class="line">	���������� ENV ��Ч��һ�����������û�������������ͬ���ǣ�ARG �����õĹ��������Ļ����������ڽ�����������ʱ�ǲ���������Щ���������ġ������� ARG ��������֮������Ϣ����Ϊ docker history ���ǿ��Կ�������ֵ�ġ�</div><div class="line">	</div><div class="line">- **VOLUME ����������**</div><div class="line">	- ��ʽ:</div></pre></td></tr></table></figure>

    VOLUME [&quot;&lt;·��1&gt;&quot;, &quot;&lt;·��2&gt;&quot;...]
    VOLUME &lt;·��&gt;
    <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&gt; ֮ǰ����˵������������ʱӦ�þ������������洢�㲻����д�������������ݿ�����Ҫ���涯̬���ݵ�Ӧ�ã������ݿ��ļ�Ӧ�ñ����ھ�(volume)�У��������½����ǻ���һ������ Docker ���ĸ��Ϊ�˷�ֹ����ʱ�û����ǽ���̬�ļ�������Ŀ¼����Ϊ������ Dockerfile �У����ǿ�������ָ��ĳЩĿ¼����Ϊ������������������ʱ�����û���ָ�����أ���Ӧ��Ҳ�����������У������������洢��д���������ݡ�</div></pre></td></tr></table></figure>

VOLUME /data
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Ҳ��������ʱ���������������á����磺</div></pre></td></tr></table></figure>

docker run -d -v mydata:/data xxxx
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">	�����������У���ʹ���� mydata �������������ص��� /data ����λ�ã������� Dockerfile �ж������������Ĺ������á�</div><div class="line">	</div><div class="line">- **EXPOSE �����˿�**</div><div class="line">	- ��ʽ:</div></pre></td></tr></table></figure>

    EXPOSE &lt;�˿�1&gt; [&lt;�˿�2&gt;...]
    <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">	EXPOSE ָ������������ʱ�����ṩ�����˿ڣ�������ʱ��������Ϊ��������Ӧ�þͻῪ�������˿ڵķ�����</div><div class="line">	</div><div class="line">	- �� Dockerfile ��д�������������������ô�:</div><div class="line">		- ��������ʹ�����������������������ػ��˿ڣ��Է�������ӳ��</div><div class="line">		- ������ʱʹ�������˿�ӳ��ʱ��Ҳ���� docker run -P ʱ�����Զ�����ӳ�� EXPOSE �Ķ˿ڡ�</div><div class="line">	&gt; ���⣬������ Docker �汾�л���һ���������ô�����ǰ����������������Ĭ���Ž������У�����������������֮�䶼����ֱ�ӷ��ʣ���������һ���İ�ȫ�����⡣��������һ�� Docker �������� --icc=false����ָ���ò������������佫Ĭ���޷����ã����ǻ�����ʹ���� --links �����������ſ��Ի�ͨ������ֻ�о����� EXPOSE �������Ķ˿ڲſ��Ա����ʡ����� --icc=false ���÷����������� docker network ���Ѿ����������ˣ�ͨ���Զ����������Ժ����ɵ�ʵ���������Ļ��������롣</div><div class="line">	</div><div class="line">	</div><div class="line">- **WORKDIR ָ������Ŀ¼**</div><div class="line">	- ��ʽ:</div></pre></td></tr></table></figure>

    WORKDIR &lt;����Ŀ¼·��&gt;
    <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ʹ�� WORKDIR ָ��������ָ������Ŀ¼�����߳�Ϊ��ǰĿ¼�����Ժ������ĵ�ǰĿ¼�ͱ���Ϊָ����Ŀ¼������Ŀ¼�����ڣ�WORKDIR �����㽨��Ŀ¼��</div><div class="line">֮ǰ�ᵽһЩ��ѧ�߳����Ĵ����ǰ� Dockerfile ��ͬ�� Shell �ű�����д�����ִ��������⻹���ܻᵼ�³������������Ĵ�����</div></pre></td></tr></table></figure>

RUN cd /app
RUN echo &quot;hello&quot; &gt; world.txt
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">	&gt; ���������� Dockerfile ���й����������к󣬻ᷢ���Ҳ��� /app/world.txt �ļ������������ݲ���hello��ԭ����ʵ�ܼ򵥣��� Shell �У�����������ͬһ������ִ�л���������ǰһ�������޸ĵ��ڴ�״̬����ֱ��Ӱ����һ��������� Dockerfile �У������� RUN ������ִ�л���������ͬ����������ȫ��ͬ�������������Ƕ� Dokerfile �����ֲ��洢�ĸ���˽������µĴ�����</div><div class="line">	</div><div class="line">	&gt; ֮ǰ˵��ÿһ�� `RUN `��������һ��������ִ�����Ȼ���ύ�洢���ļ���������һ�� `RUN cd /app `��ִ�н����ǵ�ǰ���̵Ĺ���Ŀ¼������һ���ڴ��ϵı仯���ѣ����������������κ��ļ������������ڶ�����ʱ������������һ��ȫ�µ�����������һ������������ȫû��ϵ����Ȼ�����ܼ̳�ǰһ�㹹�������е��ڴ��仯��</div><div class="line"></div><div class="line">	����������Ҫ�ı��Ժ������Ĺ���Ŀ¼��λ�ã���ôӦ��ʹ�� `WORKDIR` ָ�</div><div class="line">- **USER ָ����ǰ�û�**</div><div class="line">	- ��ʽ:</div></pre></td></tr></table></figure>

    USER &lt;�û���&gt;
    <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">USER ָ���� WORKDIR ���ƣ����Ǹı价��״̬��Ӱ���Ժ��Ĳ㡣WORKDIR �Ǹı乤��Ŀ¼��USER ���Ǹı�֮������ִ�� RUN, CMD �Լ� ENTRYPOINT �������������ݡ�</div><div class="line"></div><div class="line">��Ȼ���� WORKDIR һ����USER ֻ�ǰ������л���ָ���û����ѣ������û����������Ƚ����õģ������޷��л���</div></pre></td></tr></table></figure>

RUN groupadd -r redis &amp;&amp; useradd -r -g redis redis
USER redis
RUN [ &quot;redis-server&quot; ]
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">	</div><div class="line">- **HEALTHCHECK ��������**</div><div class="line">	- ��ʽ:</div></pre></td></tr></table></figure>

    HEALTHCHECK [ѡ��] CMD &lt;����&gt;�����ü�����������״��������
    HEALTHCHECK NONE���������������н�������ָ�ʹ�����п������ε��佡������ָ��
    <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">HEALTHCHECK ָ���Ǹ��� Docker Ӧ�����ν����ж�������״̬�Ƿ����������� Docker 1.12 ��������ָ�</div><div class="line"></div><div class="line">��û�� HEALTHCHECK ָ��ǰ��Docker ����ֻ����ͨ���������������Ƿ��˳����ж������Ƿ�״̬�쳣���ܶ���������û���⣬��������������������״̬��������ѭ��״̬��Ӧ�ý��̲����˳������Ǹ������Ѿ��޷��ṩ�����ˡ��� 1.12 ��ǰ��Docker �������⵽����������״̬���Ӷ��������µ��ȣ����¿��ܻ��в��������Ѿ��޷��ṩ������ȴ���ڽ����û�������</div><div class="line"></div><div class="line">���� 1.12 ֮����Docker �ṩ�� HEALTHCHECK ָ�ͨ����ָ��ָ��һ������������������ж����������̵ķ���״̬�Ƿ����������Ӷ��Ƚ���ʵ�ķ�Ӧ����ʵ��״̬��</div><div class="line"></div><div class="line">����һ������ָ���� HEALTHCHECK ָ����������������������ʼ״̬��Ϊ starting���� HEALTHCHECK ָ�������ɹ�����Ϊ healthy����������һ������ʧ�ܣ�������Ϊ unhealthy��</div><div class="line"></div><div class="line">HEALTHCHECK ֧������ѡ�</div></pre></td></tr></table></figure>

--interval=&lt;����&gt;�����ν��������ļ�����Ĭ��Ϊ 30 �룻
--timeout=&lt;ʱ��&gt;�����������������г�ʱʱ�䣬������������ʱ�䣬���ν��������ͱ���Ϊʧ�ܣ�Ĭ�� 30 �룻
--retries=&lt;����&gt;��������ʧ��ָ������������������״̬��Ϊ unhealthy��Ĭ�� 3 �Ρ�
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">&gt; �� CMD, ENTRYPOINT һ����HEALTHCHECK ֻ���Գ���һ�Σ�����д�˶�����ֻ������һ����Ч��</div><div class="line"></div><div class="line">�� HEALTHCHECK [ѡ��] CMD �����������ʽ�� ENTRYPOINT һ������Ϊ shell ��ʽ���� exec ��ʽ�������ķ���ֵ�����˸ôν��������ĳɹ�������0���ɹ���1��ʧ�ܣ�2����������Ҫʹ������ֵ��</div><div class="line"></div><div class="line">���������и������Ǹ����򵥵� Web ����������ϣ�����ӽ����������ж��� Web �����Ƿ����������������ǿ����� curl �������жϣ��� Dockerfile �� HEALTHCHECK ������ôд��</div></pre></td></tr></table></figure>

mkdir ~/nginxcheck
cd ~/nginxcheck
vim Dockerfile
FROM nginx
RUN apt-get update &amp;&amp; apt-get install -y curl &amp;&amp; rm -rf /var/lib/apt/lists/*
HEALTHCHECK --interval=5s --timeout=3s \
  CMD curl -fs http://localhost/ || exit 1

docker build -t myweb:v1 .
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">��������������ÿ 5 ������һ�Σ�����Ϊ���������Լ����ǳ��̣�ʵ��Ӧ�����Խϳ���������������������� 3 ��û��Ӧ����Ϊʧ�ܣ�����ʹ�� curl -fs http://localhost/ || exit 1 ��Ϊ�����������</div><div class="line"></div><div class="line">��������</div></pre></td></tr></table></figure>

docker run -d --name myweb -p 80:82 myweb:v1
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">�鿴</div></pre></td></tr></table></figure>

[root@node1 nginxcheck]# docker ps -f name=myweb
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                    PORTS                                 NAMES
beb18dcc15fe        myweb:v1            &quot;nginx -g &apos;daemon ...&quot;   22 seconds ago      Up 21 seconds (healthy)   80/tcp, 443/tcp, 0.0.0.0:80-&gt;82/tcp   myweb
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">	</div><div class="line">	����������������ʧ�ܳ��������Դ�����״̬�ͻ���Ϊ (unhealthy)��</div><div class="line">	������������������������ stdout �Լ� stderr�����ᱻ�洢�ڽ���״̬������� docker inspect ���鿴��</div><div class="line">	</div><div class="line">- **ONBUILD Ϊ����������**</div><div class="line">	ONBUILD ��һ��������ָ�����������������ָ����� RUN, COPY �ȣ�����Щָ��ڵ�ǰ���񹹽�ʱ�����ᱻִ�С�ֻ�е��Ե�ǰ����Ϊ����������ȥ������һ��������ʱ���Żᱻִ�С�</div><div class="line">	���磺</div></pre></td></tr></table></figure>

FROM node:slim
RUN &quot;mkdir /app&quot;
WORKDIR /app
ONBUILD COPY ./package.json /app
ONBUILD RUN [ &quot;npm&quot;, &quot;install&quot; ]
ONBUILD COPY . /app/
CMD [ &quot;npm&quot;, &quot;start&quot; ]
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">�ڹ�������������ʱ�򣬰���ONBUILD�����в����ᱻִ�У����ǵ�������������Ϊ�������񹹽�ʱ�������оͻ�ִ�С�</div></pre></td></tr></table></figure>

#���ȹ�����������
docker build -t my-node .

#��������Ŀ��Ҫʹ������Dockerfile�����ľ�����Ϊ��������ʱ��ֱ��дDockerfile���������������л�����Dockerfile��ִ��
FROM my-node
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">- **�����������񷽷�**</div><div class="line">	���˱�׼��ʹ�� Dockerfile ���ɾ����ķ����⣬���ڸ���������������ʷԭ�򣬻��ṩ��һЩ���������������ɾ�����</div><div class="line">	</div><div class="line">	- �� rootfs ѹ��������</div></pre></td></tr></table></figure>

    ��ʽ��docker import [ѡ��] &lt;�ļ�&gt;|&lt;URL&gt;|- [&lt;�ֿ���&gt;[:&lt;��ǩ&gt;]]
    <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ѹ���������Ǳ����ļ���Զ�� Web �ļ��������Ǵӱ�׼�����еõ���ѹ���������ھ��� / Ŀ¼չ������ֱ����Ϊ������һ���ύ��</div><div class="line"></div><div class="line">����������Ҫ����һ�� OpenVZ �� Ubuntu 14.04 ģ���ľ�����</div></pre></td></tr></table></figure>

    docker import \
    http://download.openvz.org/template/precreated/ubuntu-14.04-x86_64-minimal.tar.gz \
    openvz/ubuntu:14.04
    <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">	</div><div class="line">	���������Զ������� ubuntu-14.04-x86_64-minimal.tar.gz �ļ���������Ϊ���ļ�ϵͳչ�����룬������Ϊ���� openvz/ubuntu:14.04��</div><div class="line">	</div><div class="line">- docker save �� docker load</div><div class="line">	Docker ���ṩ�� docker load �� docker save ������Խ����񱣴�Ϊһ�� tar �ļ���Ȼ�����䵽��һ��λ���ϣ��ټ��ؽ�����������û�� Docker Registry ʱ�������������Ѿ����Ƽ�������Ǩ��Ӧ��ֱ��ʹ�� Docker Registry��������ֱ��ʹ�� Docker Hub ����ʹ������˽�� Registry �����ԡ�</div><div class="line">	</div><div class="line">	ʹ�� docker save �������Խ����񱣴�Ϊ�鵵�ļ���</div></pre></td></tr></table></figure>

    docker pull alpine
    docker save alpine |gzip &gt; alpine.tar.gz
    <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">Ȼ�����ǽ� alpine-latest.tar.gz �ļ����Ƶ��˵�����һ�������ϣ����������������������ؾ�����</div></pre></td></tr></table></figure>

    docker load -i alpine-latest.tar.gz
    <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">## ʹ������</div><div class="line">### ��������</div><div class="line">	�������������ַ�ʽ��һ���ǻ��ھ����½�һ������������������һ���ǽ�����ֹ״̬��stopped������������������</div><div class="line">	</div><div class="line">- **��������������**</div><div class="line">	������ docker run ����������ʱ��Docker �ں�̨���еı�׼����������</div><div class="line">		1. ���鱾���Ƿ�����ָ���ľ��񣬲����ھʹӹ��вֿ�����</div><div class="line">		1. ���þ��񴴽�������һ������</div><div class="line">		1. ����һ���ļ�ϵͳ������ֻ���ľ�������������һ���ɶ�д��</div><div class="line">		1. �������������õ����Žӿ����Ž�һ�������ӿڵ�������ȥ</div><div class="line">		1. �ӵ�ַ������һ�� ip ��ַ������</div><div class="line">		1. ִ���û�ָ����Ӧ�ó���</div><div class="line">		1. ִ�����Ϻ���������ֹ</div><div class="line">	</div><div class="line"></div><div class="line">- **ʹ��docker run����**</div><div class="line">	��������������һ�� ��Hello World����֮����ֹ������</div></pre></td></tr></table></figure>

docker run centos /bin/echo &apos;Hello world&apos;
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">����һ��ǰ̨��bash���̣�-t ѡ����Docker����һ��α�նˣ�pseudo-tty�����󶨵������ı�׼�����ϣ�-i ���������ı�׼���뱣�ִ򿪡�</div></pre></td></tr></table></figure>

docker run -t -i centos /bin/bash
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- **ʹ��docker start��������ֹ����**</div></pre></td></tr></table></figure>

docker start  �������ֻ�ID
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">�鿴��������Դռ��,ֻ��һ��bash����</div></pre></td></tr></table></figure>

[root@94b57792acbf /]# ps aux
USER        PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
root          1  0.0  0.1  11768  1932 ?        Ss   07:19   0:00 /bin/bash
root         56  0.0  0.1  47440  1672 ?        R+   07:27   0:00 ps aux
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">	</div><div class="line">	</div><div class="line">- **�������Ժ�̨����ģʽ����**	</div><div class="line">	������ʱ������Ҫ�� Docker�ں�̨���ж�����ֱ�Ӱ�ִ�������Ľ��������ڵ�ǰ�������¡���ʱ������ͨ������ -d ������ʵ�֡�</div><div class="line">	ʹ���������������𣺲�ʹ�� -d ������</div></pre></td></tr></table></figure>

[root@node1 ~]# docker run centos /bin/bash -c &quot;while true; do echo hello world; sleep 1; done&quot;
hello world
hello world
hello world
hello world
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">���е���������������������</div><div class="line"></div><div class="line">��-d����</div></pre></td></tr></table></figure>

[root@node1 ~]# docker run  -d centos /bin/bash -c &quot;while true; do echo hello world; sleep 1; done&quot;
a8e42575a9ff340c65f0023c77926b0f80051f53ade13c38847f0e8a6319ee63
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">��ʱ�������ں�̨���в������������Ľ�����ӡ���������ϣ�����ʹ�� docker logs �鿴</div></pre></td></tr></table></figure>

[root@node1 ~]# docker logs a8e42575a9ff
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">	</div><div class="line">	&gt; ע�� �����Ƿ��᳤�����У��Ǻ�docker runָ���������йأ��� -d �����޹ء�</div><div class="line">	</div><div class="line">- **��ֹ����**</div></pre></td></tr></table></figure>

docker stop {CONTAINER ID| NAMES}
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">	������һ�½���ֻ������һ��bash���������û�ͨ�� exit ������ Ctrl+d ���˳��ն�ʱ��������������������ֹ��</div><div class="line">	</div><div class="line">- **��������**	</div><div class="line">	attach ����</div></pre></td></tr></table></figure>

[root@node1 ~]# docker run -dit centos /bin/bash
14c0b4a935f57317f25111aa55beed0f3329afe60871ca06c44a12acc4172140
[root@node1 ~]# docker ps 
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                 PORTS                                 NAMES
14c0b4a935f5        centos              &quot;/bin/bash&quot;              25 seconds ago      Up 24 seconds                                                dreamy_wiles

[root@node1 ~]# docker attach dreamy_wiles
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">	&gt; ����ʹ�� attach ������ʱ�򲢲����㡣����������ͬʱ attach ��ͬһ��������ʱ�������д��ڶ���ͬ����ʾ����ĳ����������������ʱ,��������Ҳ�޷�ִ�в�����,ʹ��attach�����˳�ʹ��ctrl+p+q �˳���Ӱ���������С�</div><div class="line"></div><div class="line">- **nsenter ����**	</div><div class="line">	��װ����</div></pre></td></tr></table></figure>

yum -y install  util-linux
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">��ȡ����PID</div></pre></td></tr></table></figure>

PID=$(docker inspect --format &quot;{{ .State.Pid }}&quot; dreamy_wiles)
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">��������</div></pre></td></tr></table></figure>

nsenter --target $PID --mount --uts --ipc --net --pid
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">	</div><div class="line">- **���뵼������**	</div><div class="line">	������������</div></pre></td></tr></table></figure>

docker export 7691a814370e &gt; centos.tar
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">������������</div></pre></td></tr></table></figure>

cat centos.tar | sudo docker import - myimages/centos:v1.0
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">ɾ������</div></pre></td></tr></table></figure>

docker rm {CONTAINER ID| NAMES}
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">### Docer ���ݹ���</div><div class="line">	Docker �ڲ�����������Ҫ�����ַ�ʽ��</div><div class="line">		- ���ݾ���Data volumes��</div><div class="line">		- ���ݾ�������Data volume containers��</div><div class="line">	</div><div class="line">- **���ݾ�**	</div><div class="line">	���ݾ���һ���ɹ�һ������������ʹ�õ�����Ŀ¼�����ƹ� UFS�������ṩ�ܶ����õ����ԣ�</div><div class="line">		- ���ݾ�����������֮�乲��������</div><div class="line">		- �����ݾ����޸Ļ�������Ч</div><div class="line">		- �����ݾ��ĸ��£�����Ӱ�쾵��</div><div class="line">		- ���ݾ�Ĭ�ϻ�һֱ���ڣ���ʹ������ɾ��</div><div class="line">	&gt; ע�⣺���ݾ���ʹ�ã������� Linux �¶�Ŀ¼���ļ����� mount�������еı�ָ��Ϊ���ص���Ŀ¼�е��ļ������ص�������ʾ�����ǹ��ص����ݾ���</div><div class="line">	</div><div class="line">	ʹ�� `-v` ����Ҳ����ָ������һ������������Ŀ¼��������ȥ��</div></pre></td></tr></table></figure>

docker run -dit --name test  -v /tmp:/opt:ro centos  /bin/bash
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">	</div><div class="line">- **���ݾ�����**	</div><div class="line">	���ݾ���������ʵ����һ��������������ר�������ṩ���ݾ��������������صġ�</div></pre></td></tr></table></figure>

docker run -dit -v /dbdata --name dbdata centos /bin/bash
[root@node1 ~]# docker attach dbdata
[root@a9642e6adf7b /]# touch /dbdata/{1..10}.txt
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">������������ʹ�� --volumes-from ������ dbdata �����е����ݾ���</div></pre></td></tr></table></figure>

docker run -dit --volumes-from dbdata --name db1 centos /bin/bash
docker run -dit --volumes-from dbdata --name db2 centos /bin/bash
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">��֤</div></pre></td></tr></table></figure>

[root@node1 ~]# docker attach db1
[root@87f964ea0f31 /]# ls /dbdata/
1.txt  10.txt  2.txt  3.txt  4.txt  5.txt  6.txt  7.txt  8.txt  9.txt
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">	</div><div class="line">	&gt; ע�⣺ʹ�� --volumes-from �������������ݾ��������Լ�������Ҫ����������״̬��</div><div class="line">	</div><div class="line">	����ɾ���˹��ص����������� dbdata��db1 �� db2�������ݾ������ᱻ�Զ�ɾ��������Ҫɾ��һ�����ݾ���������ɾ������һ������������������ʱʹ�� docker rm -v ������ָ��ͬʱɾ�������������� ���������û�������֮���������ƶ����ݾ���</div><div class="line"></div><div class="line">- **�������ݾ����������ݡ��ָ���Ǩ�����ݾ�**	</div><div class="line">	�����������ݾ������е����ݽ��н��б��ݡ��ָ���Ǩ�ơ�</div><div class="line">	`����`</div><div class="line">	����ʹ�� --volumes-from ����������һ������ dbdata ��������������������������/opt/backup�������� /backup Ŀ¼���������£�</div></pre></td></tr></table></figure>

docker run --volumes-from dbdata -v /opt/backup:/backup centos tar cvf /backup/backup.tar /dbdata
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">`�ָ�`</div><div class="line">����Ҫ�ָ����ݵ�һ�����������ȴ���һ�����п����ݾ������� dbdata2��</div></pre></td></tr></table></figure>

docker run --volumes-from dbdata2 -v /opt/backup:/backup centos tar xvf /backup/backup.tar
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Ϊ�˲鿴/��֤�ָ������ݣ�����������һ����������ͬ�������������鿴</div></pre></td></tr></table></figure>

docker run --volumes-from dbdata2 centos /bin/ls /dbdata
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">## Docker registry</div><div class="line">### Registry �� Repository ������</div><div class="line">	ע����������Registry�����ǹ����ֿ��ľ�����������ÿ���������Ͽ����ж����ֿ⣨Repository������ÿ���ֿ⣨Repository�������ж���������</div><div class="line">### ����registry</div><div class="line">	registry������Ҫ���˿���ʹ�ã���Ҫhttps�ſ��ԣ����ǿ�������openssl���˽�е�CA������������ǩ�����䷢֤�飬������ǩ��֤�����ѵ���֤���ȡ�</div><div class="line">### �˽��CA</div><div class="line">	��ʼ��CA��������/etc/pki/CA/�½���֤���������ݿ��ļ�index.txt�����к��ļ�serial����Ϊ֤�����к��ļ��ṩ��ʼֵ��</div></pre></td></tr></table></figure>

touch /etc/pki/CA/{index.txt,serial}
echo 01 &gt; /etc/pki/CA/serial
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">������Կ�����浽/etc/pki/CA/private/cakey.pem</div></pre></td></tr></table></figure>

(umask 077;openssl genrsa -out  /etc/pki/CA/private/cakey.pem 2048)
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">���ɸ�֤��</div></pre></td></tr></table></figure>

openssl req -new -x509 -key  /etc/pki/CA/private/cakey.pem -out /etc/pki/CA/cacert.pem -days 3650
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">��д����Ϣ</div></pre></td></tr></table></figure>

Country Name (2 letter code) [XX]:CN
State or Province Name (full name) []:Beijing
Locality Name (eg, city) [Default City]:Beijing
Organization Name (eg, company) [Default Company Ltd]:mycompany
Organizational Unit Name (eg, section) []:ops
Common Name (eg, your name or your server&apos;s hostname) []:registry.mycompany.com
Email Address []:admin@mycompany.com
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">ʹLinuxϵͳ���θ�֤��</div></pre></td></tr></table></figure>

cat /etc/pki/CA/cacert.pem &gt;&gt; /etc/pki/tls/certs/ca-bundle.crt
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">ǩ��֤��</div></pre></td></tr></table></figure>

yum -y install nginx //��װnginx
mkdir  /etc/nginx/ssl //����sslĿ¼����������Կ�ļ���֤�������ļ�
//������Կ�ļ���֤�������ļ�
(umask 077;openssl genrsa -out /etc/nginx/ssl/docker.key 2048)
openssl req -new -key /etc/nginx/ssl/docker.key -out /etc/nginx/ssl/docker.csr
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">��д��������Ϣǰ����Ҫ��˽��CA����Ϣһ��</div></pre></td></tr></table></figure>

Country Name (2 letter code) [XX]:CN
State or Province Name (full name) []:Beijing
Locality Name (eg, city) [Default City]:Beijing
Organization Name (eg, company) [Default Company Ltd]:mycompany
Organizational Unit Name (eg, section) []:ops
Common Name (eg, your name or your server&apos;s hostname) []:registry.mycompany.com
Email Address []:admin@mycompany.com
#ֱ�ӻس�
A challenge password []:
An optional company name []:
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">ǩ����֤��</div></pre></td></tr></table></figure>

[root@node1 ~]# openssl ca -in /etc/nginx/ssl/docker.csr -out /etc/nginx/ssl/docker.crt -days 3650
Using configuration from /etc/pki/tls/openssl.cnf
Check that the request matches the signature
Signature ok
Certificate Details:
        Serial Number: 1 (0x1)
        Validity
            Not Before: Mar 30 08:12:58 2017 GMT
            Not After : Mar 28 08:12:58 2027 GMT
        Subject:
            countryName               = CN
            stateOrProvinceName       = Beijing
            organizationName          = mycompany
            organizationalUnitName    = ops
            commonName                = registry.mycompany.com
            emailAddress              = admin@mycompany.com
        X509v3 extensions:
            X509v3 Basic Constraints: 
                CA:FALSE
            Netscape Comment: 
                OpenSSL Generated Certificate
            X509v3 Subject Key Identifier: 
                59:27:56:F3:67:46:4B:6D:A5:1B:66:C0:D8:C7:7D:0F:CA:90:C2:ED
            X509v3 Authority Key Identifier: 
                keyid:76:4A:E0:BB:91:F5:0C:B2:67:2E:D1:3C:74:2B:05:F6:2C:A9:9B:7B

Certificate is to be certified until Mar 28 08:12:58 2027 GMT (3650 days)
Sign the certificate? [y/n]:y


1 out of 1 certificate requests certified, commit? [y/n]y
Write out database with 1 new entries
Data Base Updated
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">����index.txt��serial���кŸ���</div></pre></td></tr></table></figure>

[root@node1 ~]# cat /etc/pki/CA/index.txt
V    270328055023Z        01    unknown    /C=CN/ST=Beijing/O=mycompany/OU=ops/CN=registry.mycompany.com/emailAddress=admin@mycompany.com

[root@node1 ~]# cat /etc/pki/CA/serial
02
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">	</div><div class="line">### ����localhost�docker-registry</div><div class="line">	����registry</div></pre></td></tr></table></figure>

docker run -d -p 5000:5000 --restart=always --name registry -v /opt/registry:/var/lib/registry registry:2
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">��dockerhub����centos������ʹ��docker tag �� centos ������������Ϊ localhost:5000/centos</div></pre></td></tr></table></figure>

docker pull centos &amp;&amp; docker tag centos localhost:5000/centos
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">ʹ��docker push �ϴ����ǵľ���</div></pre></td></tr></table></figure>

docker push localhost:5000/centos
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">��˽�вֿ����ؾ���</div></pre></td></tr></table></figure>

docker pull  localhost:5000/centos
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">	</div><div class="line">	</div><div class="line">### ����nginx��������docker registry</div><div class="line">	- **Ϊnginx������֤**</div></pre></td></tr></table></figure>

yum -y install httpd-tools
htpasswd -cb /etc/nginx/conf.d/docker-registry.htpasswd admin admin
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- **����nginx��server**</div></pre></td></tr></table></figure>

[root@node1 ~]# cat /etc/nginx/conf.d/docker-registry.conf
upstream docker-registry {
    server 127.0.0.1:5000;
}
server {
        listen       443;
        server_name           registry.mycompany.com;
        ssl                   on;
        ssl_certificate       /etc/nginx/ssl/docker.crt;
        ssl_certificate_key   /etc/nginx/ssl/docker.key;
        client_max_body_size 0;
        chunked_transfer_encoding on;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        location / {
               auth_basic   &quot;Docker registry&quot;;
               auth_basic_user_file /etc/nginx/conf.d/docker-registry.htpasswd;
               proxy_pass  http://docker-registry;
        }
         location /_ping{
               auth_basic off;
               proxy_pass  http://docker-registry;
               }
         location /v1/_ping{
               auth_basic off;
               proxy_pass  http://docker-registry;
               }
}
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">- **����nginx**</div></pre></td></tr></table></figure>

systemctl restart nginx
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">- **�޸�hosts**</div></pre></td></tr></table></figure>

10.0.7.1    registry.mycompany.com
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">- **����**</div></pre></td></tr></table></figure>

[root@node1 ~]# docker login registry.mycompany.com
Username: admin
Password: 
Login Succeeded
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">- **�ϴ�����**</div></pre></td></tr></table></figure>

docker tag centos registry.mycompany.com/centos
docker push registry.mycompany.com/centos
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">- **�鿴**</div></pre></td></tr></table></figure>

curl --user admin:admin  https://registry.mycompany.com/v2/_catalog
{&quot;repositories&quot;:[&quot;centos&quot;]}
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">- **���þ�����������������֤**</div></pre></td></tr></table></figure>

// �޸�hosts
vim /etc/hosts
10.0.7.1    registry.mycompany.com

//ͬ����ϵͳ�汾,ֱ�Ӹ���ca-bundle.crt��
 scp -rp /etc/pki/tls/certs/ca-bundle.crt  root@10.0.7.2:/etc/pki/tls/certs/ca-bundle.crt
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">��ͬ�汾��CA����Կ���͵��ͻ����������ӵ�ca-bundle.crt</div></pre></td></tr></table></figure>

scp -rp  /etc/pki/CA/cacert.pem root@10.0.7.2:/etc/pki/CA/cacert.pem
cat /etc/pki/CA/cacert.pem &gt;&gt; /etc/pki/tls/certs/ca-bundle.crt
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">����docker������������������docker��ʾx509֤��û����Ȩ</div></pre></td></tr></table></figure>

systemctl daemon-reload
systemctl restart docker
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">��֤</div></pre></td></tr></table></figure>

[root@node1 ~]# curl --user admin:admin  https://registry.mycompany.com/v2/_catalog
{&quot;repositories&quot;:[&quot;centos&quot;]}
[root@node1 ~]# docker login registry.mycompany.com
Username: admin
Password: 
Login Succeeded
[root@node1 ~]# docker pull registry.mycompany.com/centos
Using default tag: latest
latest: Pulling from centos
4969bbd91a1e: Pull complete 
Digest: sha256:d7f3db1caf4ea76117abce89709ebfc66c9339e13866016b8b2e4eee3ab4bea0
Status: Downloaded newer image for registry.mycompany.com/centos:latest
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">	</div><div class="line">## Docker ����</div><div class="line">### �鿴����IP</div><div class="line">	- ** ��һ�ַ��� **</div></pre></td></tr></table></figure>

docker run -d --name nginx nginx
docker inspect --format &apos;{{ .NetworkSettings.IPAddress }}&apos; nginx
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- ** �ڶ��ַ��� **</div></pre></td></tr></table></figure>

docker exec -ti nginx ip add | grep global
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- ** �����ַ��� **</div></pre></td></tr></table></figure>

docker exec -ti nginx cat /etc/hosts
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">	</div><div class="line">### �˿�ӳ��</div><div class="line">	��Docker���ڲ��˿�ͨ���˿�ӳ���ķ���ӳ�䵽��������ĳһ���˿ڣ���ʹ�� -P ����ʱ��Docker ������ӳ��һ�� `49000~49900` �Ķ˿ڵ��ڲ��������ŵ������˿ڡ�</div></pre></td></tr></table></figure>

docker run -d -P nginx

docker ps
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                         NAMES
3a5ec1bc2837        nginx               &quot;nginx -g &apos;daemon ...&quot;   About an hour ago   Up About an hour    0.0.0.0:2049-&gt;80/tcp, 0.0.0.0:2048-&gt;443/tcp   adoring_pike
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">ͨ��docker logs�鿴Ӧ����Ϣ</div></pre></td></tr></table></figure>

[root@node1 ~]# docker logs -f adoring_pike 
172.17.0.1 - - [30/Mar/2017:15:02:40 +0000] &quot;GET / HTTP/1.1&quot; 200 612 &quot;-&quot; &quot;curl/7.29.0&quot; &quot;-&quot;
10.0.7.1 - - [30/Mar/2017:15:02:47 +0000] &quot;GET / HTTP/1.1&quot; 200 612 &quot;-&quot; &quot;curl/7.29.0&quot; &quot;-&quot;
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">-p��Сд�ģ�������ָ��Ҫӳ���Ķ˿ڣ����ң���һ��ָ���˿���ֻ���԰���һ��������</div><div class="line">֧�ֵĸ�ʽ��`ip:hostPort:containerPort` | `ip::containerPort` | `hostPort:containerPort`��</div><div class="line"></div><div class="line">ӳ�䵽��������IP�� 80 �˿�ӳ�䵽������ 80 �˿�</div></pre></td></tr></table></figure>

docker run -d -p 80��80 nginx
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">�鿴ӳ���Ķ˿�</div></pre></td></tr></table></figure>

docker port adoring_pike
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">## ��������</div><div class="line">	ʹ�� `--link` ��������������֮�䰲ȫ�Ľ��н�����</div><div class="line">	�����ȴ���һ���µ����ݿ�������</div></pre></td></tr></table></figure>

docker run -d --name db training/postgres
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">Ȼ�󴴽�һ�� web ���������������ӵ� db ����</div></pre></td></tr></table></figure>

docker run -d -P --name web --link db:db training/webapp python app.py
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">��ʱ��db ������ web ��������������ϵ��</div><div class="line">`--link` �����ĸ�ʽΪ `--link name:alias`������ name ��Ҫ���ӵ����������ƣ�alias ���������ӵı�����</div><div class="line"></div><div class="line">ʹ�� `env` �������鿴 web �����Ļ�������</div></pre></td></tr></table></figure>

[root@node1 ~]# docker run --rm --name web2 --link db:db training/webapp env
PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
HOSTNAME=f2868b0479d8
DB_PORT=tcp://172.17.0.8:5432
DB_PORT_5432_TCP=tcp://172.17.0.8:5432
DB_PORT_5432_TCP_ADDR=172.17.0.8
DB_PORT_5432_TCP_PORT=5432
DB_PORT_5432_TCP_PROTO=tcp
DB_NAME=/web2/db
DB_ENV_PG_VERSION=9.3
HOME=/root
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">���� DB_ ��ͷ�Ļ��������ǹ� web �������� db ����ʹ�ã�ǰ׺���ô�д�����ӱ�����</div><div class="line"></div><div class="line">���˻���������`Docker` ������ `host` ��Ϣ���������� `/etc/hosts `���ļ��������Ǹ����� web �� hosts �ļ�</div></pre></td></tr></table></figure>

[root@node1 ~]# docker run -t -i --rm --link db:db training/webapp /bin/bash
root@8299f9685894:/opt/webapp# cat /etc/hosts
127.0.0.1    localhost
::1    localhost ip6-localhost ip6-loopback
fe00::0    ip6-localnet
ff00::0    ip6-mcastprefix
ff02::1    ip6-allnodes
ff02::2    ip6-allrouters
172.17.0.8    db d65ebb9124a4
172.17.0.10    8299f9685894
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">## docker������ģʽ</div><div class="line">	Docker������ģʽ��Ϊ����</div><div class="line">### Bridgeģʽ</div><div class="line">	��Docker��������ʱ�����������ϴ���һ����Ϊdocker0���������ţ���������������Docker���������ӵ��������������ϡ��������ŵĹ�����ʽ���������������ƣ����������ϵ�����������ͨ��������������һ�����������С�</div><div class="line">	</div><div class="line">	��docker0�����з���һ��IP������ʹ�ã�������docker0��IP��ַΪ������Ĭ�����ء��������ϴ���һ����������veth pair�豸��Docker��veth pair�豸��һ�˷����´����������У�������Ϊeth0������������������һ�˷��������У���vethxxx�������Ƶ������������������������豸���뵽docker0�����С�����ͨ��brctl show�����鿴��</div><div class="line">	</div><div class="line">	bridgeģʽ��docker��Ĭ������ģʽ����д--net����������bridgeģʽ��ʹ��docker run -pʱ��dockerʵ������iptables����DNAT������ʵ�ֶ˿�ת�����ܡ�</div><div class="line">	</div><div class="line">	����ʹ��iptables -t nat -vnL�鿴��</div><div class="line">	bridgeģʽ����ͼ��ʾ��</div><div class="line">	![bridgeģʽ](/images/bridge-mode.png)</div><div class="line">	</div><div class="line">	��ʾ��</div></pre></td></tr></table></figure>

docker run -tid --net=bridge --name docker_bri1 ubuntu-base:v3
docker run -tid --net=bridge --name docker_bri2 ubuntu-base:v3

brctl show
docker exec -ti docker_bri1 /bin/bash
docker exec -ti docker_bri1 /bin/bash

ifconfig �Ca
route �Cn
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">	</div><div class="line">### Hostģʽ</div><div class="line">	��������������ʱ��ʹ��`host`ģʽ����ô������������������һ��������`Network Namespace`�����Ǻ�����������һ��`Network Namespace`�������������������Լ��������������Լ���IP�ȣ�����ʹ����������IP�Ͷ˿ڡ����ǣ��������������棬���ļ�ϵͳ�������б��Ȼ��Ǻ������������ġ�</div><div class="line">	</div><div class="line">	Hostģʽ����ͼ��ʾ��</div><div class="line">	![Hostģʽ](/images/docker-host-mode.png)</div><div class="line">	</div><div class="line">### Containerģʽ</div><div class="line">	����ģʽָ���´������������Ѿ����ڵ�һ����������һ�� Network Namespace�������Ǻ��������������´������������ᴴ���Լ��������������Լ��� IP�����Ǻ�һ��ָ������������ IP���˿ڷ�Χ�ȡ�ͬ�������������������緽�棬���������ļ�ϵͳ�������б��Ȼ��Ǹ����ġ����������Ľ��̿���ͨ�� lo �����豸ͨ�š�</div><div class="line">	</div><div class="line">	Containerģʽʾ��ͼ��</div><div class="line">	![Containerģʽ](/images/docker-container-mode.png)</div><div class="line">	</div><div class="line">### Noneģʽ</div><div class="line">	ʹ��noneģʽ��Docker����ӵ���Լ���Network Namespace�����ǣ�����ΪDocker���������κ��������á�Ҳ����˵������Docker����û��������IP��·�ɵ���Ϣ����Ҫ�����Լ�ΪDocker������������������IP�ȡ�</div><div class="line">	</div><div class="line">	![Noneģʽ](/images/docker-none-mode.png)</div><div class="line">	</div><div class="line">## Docker��������</div><div class="line">### ���� DNS</div><div class="line">	��docker runʱʹ�����²�����</div><div class="line"></div><div class="line">	����	˵��</div><div class="line">	-h HOSTNAME or --hostname=HOSTNAME	�趨�����������������ᱻд�������ڵ� /etc/hostname ��/etc/hosts�������������ⲿ���������Ȳ����� docker ps ����ʾ��Ҳ������������������/etc/hosts ������</div><div class="line">	--link=CONTAINER_NAME:ALIAS	ѡ�����ڴ���������ʱ��������һ�������������������� /etc/hosts �ļ��У����������Ľ��̿���ʹ�������� ALIAS �Ϳ�����������</div><div class="line">	--dns=IP_ADDRESS	���� DNS �������������� /etc/resolv.conf �У����������������������������в��� /etc/hosts �е���������</div><div class="line">	--dns-search=DOMAIN	�趨�����������򣬵��趨������Ϊ .example.com ʱ��������һ����Ϊ host ������ʱ��DNS ��������host���������� host.example.com�� ע�⣺����û���������� 2 ��ѡ�Docker ��Ĭ���������ϵ� /etc/resolv.conf ������������</div><div class="line">	</div><div class="line">### �������ʿ���</div><div class="line">	</div><div class="line">	- ** ���������ⲿ���� **</div><div class="line">		����Ҫ�������ⲿ���磬��Ҫ����ϵͳ��ת��֧�֡���Linux ϵͳ�У�����ת���Ƿ��򿪡�</div></pre></td></tr></table></figure>

    sysctl net.ipv4.ip_forward
    net.ipv4.ip_forward = 1
    <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">- ** ����֮������ **</div><div class="line">	����֮���໥���ʣ���Ҫ��������֧�֡�</div><div class="line">	- ���������������Ƿ��Ѿ�������Ĭ�������£������������ᱻ���ӵ� `docker0` �����ϡ�</div><div class="line">	- ����ϵͳ�ķ���ǽ���� `-- iptables `�Ƿ�����ͨ����</div><div class="line"></div><div class="line">- ** �������ж˿� **</div><div class="line">	������ Docker ����ʱ����Ĭ�ϻ�����һ��ת�����Ե� iptables �� FORWARD ���ϡ�����Ϊͨ����ACCEPT�����ǽ�ֹ��DROP��ȡ�������� --icc=true��ȱʡֵ������ --icc=false����Ȼ�������ֶ�ָ�� --iptables=false �򲻻����� iptables ������</div><div class="line">	</div><div class="line">	�ɼ���Ĭ�������£���ͬ����֮�����������绥ͨ�ġ�����Ϊ�˰�ȫ���ǣ�������docker�����޸�/usr/lib/systemd/system/docker.service����ʱ����--icc=false��</div><div class="line">	</div><div class="line">- ** ����ָ���˿� **</div><div class="line">	��ͨ�� -icc=false �ر��������ʺ󣬿���ͨ�� `--link=CONTAINER_NAME:ALIAS` ѡ�������������Ŀ��Ŷ˿ڡ�</div><div class="line">	���磬������ Docker ����ʱ������ͬʱʹ�� `--icc=false --iptables=true` �������ر������໥���������ʣ����� `Docker` �����޸�ϵͳ�е� `iptables` ������</div><div class="line">��ʱ��ϵͳ�е� `iptables` ��������������</div></pre></td></tr></table></figure>

iptables -nL
...
Chain FORWARD (policy ACCEPT)
target     prot opt source               destination
DROP       all  --  0.0.0.0/0            0.0.0.0/0
...
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">	</div><div class="line">## ���ڼ���</div><div class="line"></div><div class="line">	���ڹ�����docker�����ֿ�һ�㶼�Ƚ���������һ����ʹ�ù��ڵ�һЩ���ٲֿ⣬�簢����</div><div class="line"></div><div class="line">	���룺https://cr.console.aliyun.com/#/accelerator</div><div class="line">	</div><div class="line">	����</div></pre></td></tr></table></figure>

mkdir -p /etc/docker
cat /etc/docker/daemon.json
{
  &quot;registry-mirrors&quot;: [&quot;https://xxxxxxx.mirror.aliyuncs.com&quot;]
}



https://xxxxxxx.mirror.aliyuncs.com�滻�������뵽�ĵ�ַ��//https://5f2jam6c.mirror.aliyuncs.com


sudo systemctl daemon-reload
sudo systemctl restart docker
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">	</div><div class="line"></div><div class="line">## Docker Composeʹ��</div><div class="line">### ����</div><div class="line">&gt; Docker Compose��һ���������������и���Ӧ�õ�Docker���ߡ�ʹ��Compose����������һ���ļ��ж���һ��������Ӧ�ã�Ȼ��ʹ��һ����������������Ӧ�ã�����һ��׼��������</div><div class="line"></div><div class="line">&gt; һ��ʹ��Docker������Ӧ�ã�ͨ���ɶ����������ɡ�ʹ��Docker Compose��������Ҫʹ��shell�ű��������������������ļ��У����е�����ͨ��services�����壬Ȼ��ʹ��docker-compose�ű���������ֹͣ������Ӧ�ã���Ӧ���еķ����Լ���������������������</div><div class="line"></div><div class="line">### ��װ</div><div class="line"></div><div class="line">## ��װ docker-compose</div></pre></td></tr></table></figure>
</code></pre><p>curl -L <a href="https://get.daocloud.io/docker/compose/releases/download/1.18.0/docker-compose-`uname" target="_blank" rel="external">https://get.daocloud.io/docker/compose/releases/download/1.18.0/docker-compose-`uname</a> -s<code>-</code>uname -m` &gt; /usr/local/bin/docker-compose<br>chmod +x /usr/bin/docker-compose<br>docker-compose –version<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div><div class="line">### �����ļ�</div><div class="line">    ����Ϊһ�� `docker-compose` �ο������ļ�:</div></pre></td></tr></table></figure></p>
<pre><code>version: &apos;2&apos;
services:
  web:
    image: dockercloud/hello-world
    ports:
      - 8080
    networks:
      - front-tier
      - back-tier

  redis:
    image: redis
    links:
      - web
    networks:
      - back-tier

  lb:
    image: dockercloud/haproxy
    ports:
      - 80:80
    links:
      - web
    networks:
      - front-tier
      - back-tier
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock 

networks:
  front-tier:
    driver: bridge
  back-tier:
driver: bridge
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">    </div><div class="line">    ���Կ���һ�ݱ�׼�����ļ�Ӧ�ð��� version��services��networks ���󲿷֣��������ؼ��ľ��� services �� networks �������֣����������� services ����д������</div><div class="line"> </div><div class="line">### image</div></pre></td></tr></table></figure>

services:
  web:
    image: hello-world
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">�� services ��ǩ�µĵڶ�����ǩ�� web�������������û��Լ��Զ��壬�����Ƿ������ơ�</div><div class="line">image ����ָ�������ľ������ƻ����� ID�����������ڱ��ز����ڣ�Compose ���᳢����ȡ����������</div><div class="line">����������Щ��ʽ���ǿ��Եģ�</div></pre></td></tr></table></figure>

image: redis
image: ubuntu:14.04
image: tutum/influxdb
image: example-registry.com:4000/postgresql
image: a4bc65fd
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">   </div><div class="line">### build</div><div class="line">    �������˿��Ի���ָ���ľ��񣬻����Ի���һ�� Dockerfile����ʹ�� up ����֮ʱִ�й�������������������ǩ���� build��������ָ�� Dockerfile �����ļ��е�·����Compose �����������Զ���������������Ȼ��ʹ������������������������</div></pre></td></tr></table></figure>

build: /path/to/build/dir
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">Ҳ����������·����ֻҪ������ȷ���Ϳ��Զ�ȡ�� Dockerfile��</div></pre></td></tr></table></figure>

build: ./dir
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">�趨�����ĸ�Ŀ¼��Ȼ���Ը�Ŀ¼Ϊ׼ָ�� Dockerfile��</div></pre></td></tr></table></figure>

build:
  context: ../
  dockerfile: path/of/Dockerfile
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">ע�� build ����һ��Ŀ¼��������Ҫָ�� Dockerfile �ļ���Ҫ�� build ��ǩ���Ӽ���ǩ��ʹ�� dockerfile ��ǩָ���������������ӡ�</div><div class="line">������ͬʱָ���� image �� build ������ǩ����ô Compose �ṹ���������ҰѾ�������Ϊ image �������Ǹ����֡�</div></pre></td></tr></table></figure>

build: ./dir
image: webapp:tag
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">��Ȼ������ docker-compose.yml �ж��幹����������ôһ���ٲ��� arg ������ǩ������ Dockerfile �е� ARG ָ��������ڹ���������ָ�����������������ڹ����ɹ���ȡ������ docker-compose.yml �ļ���Ҳ֧��������д����</div></pre></td></tr></table></figure>

build:
  context: .
  args:
    buildno: 1
    password: secret
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">��������д��Ҳ��֧�ֵģ�һ����˵������д�����ʺ��Ķ���</div></pre></td></tr></table></figure>

build:
  context: .
  args:
    - buildno=1
    - password=secret
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">�� ENV ��ͬ���ǣ�ARG ��������ֵ�ġ����磺</div></pre></td></tr></table></figure>

args:
  - buildno
  - password
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">    </div><div class="line">    �����������̿��������Ǹ�ֵ��</div><div class="line">    </div><div class="line">    &gt; ע�⣺YAML �Ĳ���ֵ��true, false, yes, no, on, off������Ҫʹ�������������������š�˫���ž��ɣ��������ᵱ���ַ���������</div><div class="line">    </div><div class="line">### command</div><div class="line">    ʹ�� command ���Ը�������������Ĭ��ִ�е����</div></pre></td></tr></table></figure>

command: bundle exec thin -p 3000
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">Ҳ����д������ Dockerfile �еĸ�ʽ��</div></pre></td></tr></table></figure>

command: [bundle, exec, thin, -p, 3000]
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">    </div><div class="line">### container_name</div><div class="line">    ǰ��˵�� Compose ���������Ƹ�ʽ�ǣ�&lt;��Ŀ����&gt;&lt;��������&gt;&lt;����&gt;</div><div class="line">    ��Ȼ�����Զ�����Ŀ���ơ��������ƣ���������������ȫ��������������������ʹ��������ǩָ����</div></pre></td></tr></table></figure>

container_name: app
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">    �������������־�ָ��Ϊ app �ˡ�</div><div class="line">### depends_on</div><div class="line">    ��ʹ�� Compose ʱ�������ĺô������ٴ������������һ����Ŀ����������˳������Ҫ���ģ�����ֱ�Ӵ��ϵ���������������Ȼ����Ϊ������������������ʧ�ܡ�</div><div class="line">    ������û�������ݿ�������ʱ��������Ӧ����������ʱ��Ӧ����������Ϊ�Ҳ������ݿ����˳���Ϊ�˱�����������������Ҫ����һ����ǩ������ depends_on��������ǩ�����������������������Ⱥ������⡣</div><div class="line">    </div><div class="line">    �������������������� redis �� db �������������������� web ������</div></pre></td></tr></table></figure>

version: &apos;2&apos;
services:
  web:
    build: .
    depends_on:
      - db
      - redis
  redis:
    image: redis
  db:
    image: postgres
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">    </div><div class="line">    &gt; ע�����ǣ�Ĭ��������ʹ�� docker-compose up web �����ķ�ʽ���� web ����ʱ��Ҳ������ redis �� db ������������Ϊ�������ļ��ж�����������ϵ��</div><div class="line">   </div><div class="line">### dns</div><div class="line">    �� --dns ����һ����;����ʽ���£�</div></pre></td></tr></table></figure>

dns: 8.8.8.8
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">Ҳ������һ���б���</div></pre></td></tr></table></figure>

dns:
  - 8.8.8.8
  - 9.9.9.9
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">���� dns_search ������Ҳ���ƣ�</div></pre></td></tr></table></figure>

dns_search: example.com
dns_search:
  - dc1.example.com
  - dc2.example.com
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">    </div><div class="line">### tmpfs</div><div class="line">    ������ʱĿ¼�������ڲ����� run �Ĳ���һ��Ч����</div></pre></td></tr></table></figure>

tmpfs: /run
tmpfs:
  - /run
  - /tmp
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">    </div><div class="line">### entrypoint</div><div class="line">    �� Dockerfile ����һ��ָ������ ENTRYPOINT ָ�����ָ�������㣬�������жԱȹ��� CMD ��������</div><div class="line">    �� docker-compose.yml �п��Զ��������㣬���� Dockerfile �еĶ��壺</div></pre></td></tr></table></figure>

entrypoint: /code/entrypoint.sh
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">��ʽ�� Docker ���ƣ�����������д��������</div></pre></td></tr></table></figure>

entrypoint:
    - php
    - -d
    - zend_extension=/usr/local/lib/php/extensions/no-debug-non-zts-20100525/xdebug.so
    - -d
    - memory_limit=-1
    - vendor/bin/phpunit
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">    </div><div class="line">### env_file</div><div class="line">    ���ǵ�ǰ���ᵽ�� .env �ļ��ɣ������ļ��������� Compose �ı��������� docker-compose.yml �п��Զ���һ��ר�Ŵ��ű������ļ���</div><div class="line">    </div><div class="line">    ����ͨ�� docker-compose -f FILE ָ���������ļ����� env_file ��·����ʹ�������ļ�·����</div><div class="line">    </div><div class="line">    �����б��������� environment ָ����ͻ�����Ժ���Ϊ׼����ʽ���£�</div></pre></td></tr></table></figure>

env_file: .env
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">���߸��� docker-compose.yml ���ö�����</div></pre></td></tr></table></figure>

env_file:
  - ./common.env
  - ./apps/web.env
  - /opt/secrets.env
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">    &gt; ע������������˵�Ļ��������Ƕ��������� Compose ���Եģ������������ļ����� build ��������Щ�������������빹�������У�����Ҫ�ڹ�����ʹ�ñ���������ѡǰ���ս��� arg ��ǩ��</div><div class="line">    </div><div class="line">### environment</div><div class="line">    �������� env_file ��ǩ��ȫ��ͬ�������� arg �м������ƣ�������ǩ�����������þ��������������Ա����������������棬Ҳ����˵����������Ҳ��������Щ�������ã������� arg �����Ĳ�ͬ��</div><div class="line">    </div><div class="line">    һ�� arg ��ǩ�ı��������ڹ��������С��� environment �� Dockerfile �е� ENV ָ��һ�����ѱ���һֱ�����ھ����������У����� docker run -e ��Ч����</div></pre></td></tr></table></figure>

environment:
  RACK_ENV: development
  SHOW: &apos;true&apos;
  SESSION_SECRET:

environment:
  - RACK_ENV=development
  - SHOW=true
  - SESSION_SECRET

<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">    </div><div class="line">    </div><div class="line">### expose</div><div class="line">    ������ǩ��Dockerfile�е�EXPOSEָ��һ��������ָ����¶�Ķ˿ڣ�����ֻ����Ϊһ�ֲο���ʵ����docker-compose.yml�Ķ˿�ӳ�仹��ports�����ı�ǩ��</div></pre></td></tr></table></figure>

expose:
 - &quot;3000&quot;
 - &quot;8000&quot;
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">    </div><div class="line">### external_links</div><div class="line">    ��ʹ��Docker�����У����ǻ������൥��ʹ��docker run������������Ϊ��ʹCompose�ܹ�������Щ����docker-compose.yml�ж�����������������Ҫһ�������ı�ǩ������external_links����������Compose��Ŀ�������������ӵ���Щ��Ŀ�����ⲿ��������ǰ�����ⲿ�����б���������һ�����������ӵ�����Ŀ�ڵķ�����ͬһ���������棩��</div><div class="line">    </div><div class="line">    ��ʽ���£�</div></pre></td></tr></table></figure>

external_links:
 - redis_1
 - project_db_1:mysql
 - project_db_1:postgresql
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">    </div><div class="line">### extra_hosts</div><div class="line">    �����������ı�ǩ��������/etc/hosts�ļ�������һЩ��¼����Docker client��--add-host���ƣ�</div></pre></td></tr></table></figure>

extra_hosts:
 - &quot;somehost:162.242.195.82&quot;
 - &quot;otherhost:50.31.209.229&quot;
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">����֮���鿴�����ڲ�hosts��</div></pre></td></tr></table></figure>

162.242.195.82  somehost
50.31.209.229   otherhost
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">    </div><div class="line">### labels</div><div class="line">    ����������Ԫ���ݣ���Dockerfile��LABELָ��һ����˼����ʽ���£�</div></pre></td></tr></table></figure>

labels:
  com.example.description: &quot;Accounting webapp&quot;
  com.example.department: &quot;Finance&quot;
  com.example.label-with-empty-value: &quot;&quot;
labels:
  - &quot;com.example.description=Accounting webapp&quot;
  - &quot;com.example.department=Finance&quot;
  - &quot;com.example.label-with-empty-value&quot;

<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">### links</div><div class="line">    ���ǵ�������depends_on�ɣ��Ǹ���ǩ������������˳�����⣬������ǩ�������������������⣬��Docker client��--linkһ��Ч���������ӵ����������е�������</div><div class="line">    ��ʽ���£�</div></pre></td></tr></table></figure>

links:
 - db
 - db:database
 - redis
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ʹ�õı��������Զ��ڷ��������е�/etc/hosts�ﴴ�������磺</div></pre></td></tr></table></figure>

172.12.2.186  db
172.12.2.186  database
172.12.2.187  redis
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">    ��Ӧ�Ļ�������Ҳ����������</div><div class="line">### logging</div><div class="line">    ������ǩ����������־���񡣸�ʽ���£�</div></pre></td></tr></table></figure>

logging:
  driver: syslog
  options:
    syslog-address: &quot;tcp://192.168.0.42:123&quot;
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">    </div><div class="line">    Ĭ�ϵ�driver��json-file��ֻ��json-file��journald����ͨ��docker-compose logs��ʾ��־��������ʽ��������־�鿴��ʽ����ĿǰCompose��֧�֡����ڿ�ѡֵ����ʹ��optionsָ����</div><div class="line">    </div><div class="line">    </div><div class="line">### pid</div></pre></td></tr></table></figure>

pid: &quot;host&quot;
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">    ��PIDģʽ����Ϊ����PIDģʽ��������ϵͳ�������������ռ䡣����ʹ��������ǩ���ܹ����ʺͲ������������������������ƿռ䡣</div><div class="line">### ports</div><div class="line">    ӳ���˿ڵı�ǩ��</div><div class="line">    ʹ��HOST:CONTAINER��ʽ����ֻ��ָ�������Ķ˿ڣ�������������ӳ���˿ڡ�</div></pre></td></tr></table></figure>

ports:
 - &quot;3000&quot;
 - &quot;8000:8000&quot;
 - &quot;49100:22&quot;
 - &quot;127.0.0.1:8001:8001&quot;
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">    </div><div class="line">    &gt; ע�⣺��ʹ��HOST:CONTAINER��ʽ��ӳ���˿�ʱ��������ʹ�õ������˿�С��60�����ܻ��õ������ý�������ΪYAML��������xx:yy�������ָ�ʽΪ60���ơ����Խ��������ַ�����ʽ��</div><div class="line">    </div><div class="line">### security_opt</div><div class="line">    Ϊÿ����������Ĭ�ϵı�ǩ������˵�����ǹ���ȫ�������ı�ǩ����������ȫ��������user��ǩֵΪUSER��</div></pre></td></tr></table></figure>

security_opt:
  - label:user:USER
  - label:role:ROLE
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">    </div><div class="line">    </div><div class="line">### stop_signal</div><div class="line">    ������һ���ź���ֹͣ��������Ĭ��������ʹ�õ���SIGTERMֹͣ������������һ���źſ���ʹ��stop_signal��ǩ��</div></pre></td></tr></table></figure>

stop_signal: SIGUSR1
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">### volumes</div><div class="line">    ����һ��Ŀ¼����һ���Ѵ��ڵ����ݾ�����������ֱ��ʹ�� [HOST:CONTAINER] �����ĸ�ʽ������ʹ�� [HOST:CONTAINER:ro] �����ĸ�ʽ�����߶���������˵�����ݾ���ֻ���ģ�����������Ч�������������ļ�ϵͳ��</div><div class="line">    Compose�����ݾ�ָ��·������������·����ʹ�� . ���� .. ��ָ������Ŀ¼��</div><div class="line">    ���ݾ��ĸ�ʽ����������������ʽ��</div></pre></td></tr></table></figure>

volumes:
  // ֻ��ָ��һ��·����Docker ���Զ��ڴ���һ�����ݾ�������·���������ڲ��ģ���
  - /var/lib/mysql

  // ʹ�þ���·���������ݾ�
  - /opt/data:/var/lib/mysql

  // �� Compose �����ļ�Ϊ���ĵ�����·����Ϊ���ݾ����ص�������
  - ./cache:/tmp/cache

  // ʹ���û�������·����~/ ��ʾ��Ŀ¼�� /home/&lt;�û�Ŀ¼&gt;/ ���� /root/����
  - ~/configs:/etc/configs/:ro

  // �Ѿ����ڵ����������ݾ���
  - datavolume:/var/lib/mysql
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">�����㲻ʹ����������·����������ָ��һ��volume_driver��</div></pre></td></tr></table></figure>

volume_driver: mydriver
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">### volumes_from</div><div class="line">    �������������߷����������ݾ�����ѡ�Ĳ����� :ro���� :rw��ǰ�߱�ʾ����ֻ�������߱�ʾ���������ݾ��ǿɶ���д�ġ�Ĭ���������ǿɶ���д�ġ�</div></pre></td></tr></table></figure>

volumes_from:
  - service_name
  - service_name:ro
  - container:container_name
  - container:container_name:rw
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">    </div><div class="line">### cap_add, cap_drop</div><div class="line">    ���ӻ�ɾ���������ں˹��ܡ���ϸ��Ϣ��ǰ�������½��н��⣬�˴�����׸����</div></pre></td></tr></table></figure>

cap_add:
  - ALL

cap_drop:
  - NET_ADMIN
  - SYS_ADMIN
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">### cgroup_parent</div><div class="line">    ָ��һ�������ĸ���cgroup</div></pre></td></tr></table></figure>

cgroup_parent: m-executor-abcd
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">### devices</div><div class="line">    �豸ӳ���б�����Docker client��--device�������ơ�</div></pre></td></tr></table></figure>

devices:
    - &quot;/dev/ttyUSB0:/dev/ttyUSB0&quot;
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">### extends</div><div class="line">    ������ǩ������չ��һ����������չ���ݿ����������ڵ�ǰ�ļ���Ҳ���������������ļ�����ͬ�����������£������߻���ѡ���ظ���ԭ�����á�</div></pre></td></tr></table></figure>

extends:
  file: common.yml
  service: webapp
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">    </div><div class="line">    �û��������κεط�ʹ��������ǩ��ֻҪ��ǩ���ݰ���file��service����ֵ�Ϳ����ˡ�</div><div class="line">    file��ֵ���������Ի��߾���·����������ָ��file��ֵ����ôCompose����ȡ��ǰYML�ļ�����Ϣ��</div><div class="line"></div><div class="line">### network_mode</div><div class="line">    ����ģʽ����Docker client��--net�������ƣ�ֻ�����Զ���һ��service:[service name] �ĸ�ʽ��</div></pre></td></tr></table></figure>

network_mode: &quot;bridge&quot;
network_mode: &quot;host&quot;
network_mode: &quot;none&quot;
network_mode: &quot;service:[service name]&quot;
network_mode: &quot;container:[container name/id]&quot;

<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">    ����ָ��ʹ�÷����������������硣</div><div class="line">    </div><div class="line">### networks</div><div class="line">    ����ָ�����磬��ʽ���£�</div></pre></td></tr></table></figure>

services:
  some-service:
    networks:
     - some-network
     - other-network
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">����������ǩ����һ���ر����ӱ�ǩaliases������һ���������÷��������ı�ǩ�����磺</div></pre></td></tr></table></figure>

services:
  some-service:
    networks:
      some-network:
        aliases:
         - alias1
         - alias3
      other-network:
        aliases:
         - alias2
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">    </div><div class="line">    ��ͬ�ķ��������ڲ�ͬ�������в�ͬ�ı�����</div><div class="line"></div><div class="line">## �����Զ��徵��</div><div class="line">### ��¼</div></pre></td></tr></table></figure>
</code></pre><p>docker login -u {username} -p {passwd} <a href="https://registry.acs.aliyun.com" target="_blank" rel="external">https://registry.acs.aliyun.com</a><br>docker login -u 1012202451213731 -p 896423Dev <a href="https://registry.acs.aliyun.com" target="_blank" rel="external">https://registry.acs.aliyun.com</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">### ����ǩ</div><div class="line">https://registry.acs.aliyun.com</div></pre></td></tr></table></figure></p>
<p>docker tag bf46626ea2a8 registry.acs.aliyun.com/1012202451213731/laravel_taobao:v1.0<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">### ���ü�����</div></pre></td></tr></table></figure></p>
<p>echo “DOCKER_OPTS=\”\$DOCKER_OPTS –registry-mirror=<a href="https://lqjizur.mirror.acs.aliyun.com\" target="_blank" rel="external">https://lqjizur.mirror.acs.aliyun.com\</a>“” | sudo tee -a /etc/default/docker<br>sudo service docker restart<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">### docker push</div></pre></td></tr></table></figure></p>
<p>docker push registry.acs.aliyun.com/1012202451213731/austin_laravel_taobao:v1.0<br>```</p>
<h2 id="���o�������"><a href="#���o�������" class="headerlink" title="���ò�������"></a>���ò�������</h2><ul>
<li><p>�鿴��ǰ����������<br>sudo docker ps</p>
</li>
<li><p>�������ַ����ں��߼ӷ����������ӱ�ʾ�������У�-d ��ʾ�ں�̨����<br>sudo docker-compose up [nginx|php71|mysql|redis] -d</p>
</li>
<li><p>ֹͣ����������<br>sudo docker-compose stop [nginx|php71|mysql|redis]</p>
</li>
<li><p>ɾ������δ���е�����<br>sudo docker rm $(docker ps -qf status=exited)</p>
</li>
<li><p>ɾ�����о�����-f ����ǿ��ɾ��<br>sudo docker rmi $(docker images -q)</p>
<script>
(function(){
  var bp = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  if (curProtocol === 'https') {
      bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';       
  }
  else {
      bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(bp, s);

  var sozzsrc = (document.location.protocol == "http:") ? "http://js.passport.qihucdn.com/11.0.1.js?6934e60f0fcbf5f113646cf0c3c61c6a":"https://jspassport.ssl.qhimg.com/11.0.1.js?6934e60f0fcbf5f113646cf0c3c61c6a";
  document.write('<script src="' + sozzsrc + '" id="sozz"><\/script>');
})();
</script>
</li>
</ul>
]]></content>
    
    <summary type="html">
    
      dockerʹ�ñʼ�
    
    </summary>
    
      <category term="docker" scheme="https://austinxishou.github.io/categories/docker/"/>
    
    
      <category term="docker" scheme="https://austinxishou.github.io/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>html chuanbozhike</title>
    <link href="https://austinxishou.github.io/2018/01/07/wechat/html-chuanbozhike/"/>
    <id>https://austinxishou.github.io/2018/01/07/wechat/html-chuanbozhike/</id>
    <published>2018-01-07T09:24:19.364Z</published>
    <updated>2018-01-07T09:23:43.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="常用快捷键-windows-d-返回桌面"><a href="#常用快捷键-windows-d-返回桌面" class="headerlink" title="常用快捷键: windows+d  返回桌面"></a>常用快捷键: windows+d  返回桌面</h2><pre><code>Windows+e 我的电脑
Windows+r 打开运行
Alt+tab   切换软件
ctrl+tab  切换网页 文档切换
F2         重命名
F5        刷新
</code></pre><p>Web标准:由W3c制定<br>               html(结构标准)     Css(表现标准)     Js(行为标准)<br>Url地址就是网址</p>
<h2 id="Html结构标准"><a href="#Html结构标准" class="headerlink" title="Html结构标准"></a>Html结构标准</h2><p>&lt;!doctype html&gt; 声明文档类型</p>
<html>   根标签<br><head><br>     <title></title>  网页头标题<br></head><br><body><br></body><br></html>

<h2 id="标签分类"><a href="#标签分类" class="headerlink" title="标签分类"></a>标签分类</h2><p>单标签  &lt;! Doctype html&gt;<br>           注释标签<br>           <br>换行标签<br>           <hr> 水平线<br>双标签<br>  标题: </p><h1>定义最大的标题。<h6> 定义最小的标题。<br>           <h1>在一个页面里只能出现一次<br>  段落: <p></p><p></p>
<p>  文本内容: <font>  </font>  规定文本的字体、字体尺寸、字体颜色</p>
<pre><code>加粗&lt;strong&gt; &lt;/strong&gt;  &lt;b&gt;&lt;/b&gt;
倾斜 &lt;em&gt;&lt;/em&gt;  &lt;i&gt;&lt;/i&gt;
删除线 &lt;del&gt; &lt;/del&gt;     &lt;s&gt;&lt;/s&gt;
下划线 &lt;ins&gt;&lt;/ins&gt;  &lt;u&gt;&lt;/u&gt;
工作中尽量使用前者
</code></pre><p> 图片标签<img><br>              src图片来源<br>              alt 图片不显示的时候,显示文字<br>              titile 提示文本  鼠标放到图片上显示的文字</p>
<h2 id="Sublime"><a href="#Sublime" class="headerlink" title="Sublime"></a>Sublime</h2><p>1、标签输入后,按tab键,自动补全括号<br>2、html:xt +tab  结构代码</p>
<p>3、sublime 快捷键<br>     ctrl+shift+d  复制一行代码<br>     ctrl+shift+k  快速删除一行<br>     ctrl+鼠标单击  集体输入<br>     ctrl+h  查找和替换<br>     ctrl+f  查找<br>     crl+/ 注释<br>     ctrl+L 快速选中一行<br>     ctrl+shift+上下箭头   快速上下移动</p>
<h2 id="路径"><a href="#路径" class="headerlink" title="路径"></a>路径</h2><p>1、相对路径<br>     文件和图片在同一个目录(文件夹),直接写文件名即可;<br>2、图片在文件下一级目录里,文件夹名称+/图片(html文件)名称<br>3、图片在文件上一级目录里,  ../+图片(html文件)名称<br>4、图片在文件上一级目录的文件夹里,  ../+文件夹ming/+图片(html文件)名称</p>
<h2 id="超链接"><a href="#超链接" class="headerlink" title="超链接"></a>超链接</h2><p>  1、<a></a><br>    href 链接地址   titile 鼠标显示图片文字<br>    target显示图片打开方式   target=”_blank” 在新窗口打开<br>    target=”_self”在当前页面打开</p>
<p>  2、超链接优化写法<br>    让所有的超链接当前页面不关闭，打开新窗口： 在<head></head>中输入<base target="_blank"></p>
<h2 id="锚点"><a href="#锚点" class="headerlink" title="锚点"></a>锚点</h2><p>  1 、先定义一个锚点 </p><p id="sd"><br>      id=”取一个英文名作为锚点名称”<br>     超链接到锚点 <a herf="#sd">回到顶部</a></p>
<h2 id="空链-压缩文件下载-特殊字符"><a href="#空链-压缩文件下载-特殊字符" class="headerlink" title="空链 压缩文件下载    特殊字符"></a>空链 压缩文件下载    特殊字符</h2><p>   1、空链:就是没有目标端点的链接<br>           格式 <a href="#">显示内容</a></p>
<h2 id="列表"><a href="#列表" class="headerlink" title="列表"></a>列表</h2><p>   1、 无序列表<br>     格式:<br>     <ul type="列表前面的符号 "><br>        <li> </li><br>     </ul></p>
<pre><code>type=&quot;square&quot;  小方块 
type=&quot;disc&quot;  实心小圆圈
type=&quot;circle&quot; 空心小圆圈
</code></pre><p>  2、 有序列表<br>      格式:<br>      <ol><br>        <li> </li><br>      </ol></p>
<pre><code>type=&quot;&quot; type的值可以为1 a 等等
type=&quot;1&quot; start=3  数字序列从3开始,start决定了开始的数字或者字母
type=&quot;a&quot; start=3  字母序列从c开始
</code></pre><p>  3、自定义列表<br>      格式:<br>      <dl><br>        <dt>小标题</dt><br>        <dd>解释标题</dd><br>      <dl></dl></dl></p>
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';       
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);

    var sozzsrc = (document.location.protocol == "http:") ? "http://js.passport.qihucdn.com/11.0.1.js?6934e60f0fcbf5f113646cf0c3c61c6a":"https://jspassport.ssl.qhimg.com/11.0.1.js?6934e60f0fcbf5f113646cf0c3c61c6a";
    document.write('<script src="' + sozzsrc + '" id="sozz"><\/script>');
})();
</script>
</h1></h6></h1>]]></content>
    
    <summary type="html">
    
      html基础
    
    </summary>
    
      <category term="layout html" scheme="https://austinxishou.github.io/categories/layout-html/"/>
    
    
      <category term="html" scheme="https://austinxishou.github.io/tags/html/"/>
    
  </entry>
  
  <entry>
    <title>html layout</title>
    <link href="https://austinxishou.github.io/2018/01/07/wechat/html-css-layout/"/>
    <id>https://austinxishou.github.io/2018/01/07/wechat/html-css-layout/</id>
    <published>2018-01-07T04:05:01.668Z</published>
    <updated>2017-12-05T15:02:05.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Online-web"><a href="#Online-web" class="headerlink" title="Online web"></a>Online web</h2><p><a href="http://zh.learnlayout.com/" target="_blank" rel="external">ѧϰCSS����</a><br><a href="http://blog.doyoe.com/" target="_blank" rel="external">Webǰ��ʵ����</a></p>
<p><a href="http://www.jianshu.com/p/56d8672ccb0f" target="_blank" rel="external">http://www.jianshu.com/p/56d8672ccb0f</a></p>
<h2 id="����CSS-position����"><a href="#����CSS-position����" class="headerlink" title="����CSS position����"></a>����CSS position����</h2><p><a href="http://www.cnblogs.com/lrzw32/p/4966217.html" target="_blank" rel="external">����CSS position����</a><br>position��������</p>
<pre><code>1. static
    static��position���Ե�Ĭ��ֵ��Ĭ�������£��鼶Ԫ�غ�����Ԫ�ذ��ո��Ե����Խ�����ʾ
2. relative
    relative���������ĳ����Զ�λ���������������Ժ���Ԫ�ػ�����top��left��bottom��right����ƫ�ƣ��ؼ�������ԭ���Ŀռ���Ȼ������
3. absolute
    Ԫ�����ó�absolute���������ĵ��������Ҳ�ռ��ԭ���Ŀռ䣬������Ԫ�ػᶥ����ȥ�����Ҳ���Ԫ��������Ԫ�ػ��ǿ鼶Ԫ�أ���������һ���鼶����Ҳ������������Ԫ��span������absolute���Ϳ�������height��width�����ˡ�
4. fixed
    fixed�ı��ַ�ʽ������absolute������������absolute�����ڲ�ȷ���ĸ�Ԫ�ؽ���ƫ�ƣ�fixed�������������������ڽ���ƫ��
</code></pre><h2 id="����CSS-float����"><a href="#����CSS-float����" class="headerlink" title="����CSS float����"></a>����CSS float����</h2><p><a href="http://luopq.com/2015/11/08/CSS-float/" target="_blank" rel="external">����CSS float����</a></p>
<p>float����:</p>
<ol>
<li>����Ԫ�ػ�����ͨ�ĵ��������룬������Ԫ��Ӱ���Ĳ������Լ�������Ӱ����Χ��Ԫ�ض������л���</li>
<li>����Ԫ���ڸ�����ʱ������margin���ᳬ����������padding</li>
<li>�ж�������Ԫ�أ������ĸ���Ԫ�ص�margin���ᳬ��ǰ�渡��Ԫ�ص�margin</li>
<li>����Ԫ��һ�����󸡶���һ�����Ҹ������󸡶�Ԫ�ص�marginRight�������Ҹ���Ԫ�ص�marginLeft����</li>
<li>�������������Ȳ����������ĸ���Ԫ�ؽ������¸������䶥����ǰ�渡��Ԫ�صĵ׶�</li>
<li>����Ԫ�ض��˲��ᳬ�����������ڱ߽��׶ˣ������ж�������Ԫ�أ���һ������Ԫ�صĶ��˲��ᳬ����һ������Ԫ�صĵ׶�</li>
<li>����Ԫ�ػᾡ���ܵ��򶥶˶��롢���������Ҷ���</li>
</ol>
<p>float��������:</p>
<ol>
<li>����Ԫ�ص�������</li>
</ol>
<p>��������:</p>
<p>ΪʲôҪ��������:</p>
<blockquote>
<p>����֪����һ���鼶Ԫ������û������height����height������Ԫ�سſ��ġ�����Ԫ��ʹ���˸���֮������Ԫ�ػ�������׼�ĵ�����Ҳ����˵������Ԫ����û�����ݿ��Գſ����߶ȣ���������Ԫ�ص�height�ͻᱻ���ԣ���������ν�ĸ߶����ݡ�</p>
</blockquote>
<p>������������:</p>
<ol>
<li>���Ӷ�����div<br>����������ֱ�ӵķ����������и���Ԫ�أ������丸��Ԫ�ص�����������һ������Ϊ����һ����Ԫ�أ�<br> �ŵ㣺����ֱ�ӣ���ѧ�߳���ʹ�õķ�����Ҳ��������<br> ȱ�㣺���Ӷ�������������ǩ�����������廯��ÿ��������Ҫ���Ӷ����Ŀձ�ǩ�������˷�</li>
<li>����Ԫ������overflow:hidden<br> �ŵ㣺�������٣�û�ж����ı�ǩ<br> ȱ�㣺������Ԫ�س�����Ԫ�صķ�Χ�������ɳ����Ĳ��ֱ�����</li>
<li>afterαԪ��(�Ƽ�ʹ�����ַ���)<br> �ŵ㣺û�ж�����ǩ���ۺ��������ǱȽϺõķ���<br> ȱ�㣺���Ը��ӣ�����������ԭ����Ҳͦ�򵥵�<br> after��ʾ��Ԫ�صĺ��棬ͨ������������һ������clear��Ԫ�أ�Ȼ����������</li>
</ol>
<p>float��Ӧ��</p>
<pre><code>1. ���ֻ���Ч��
    float������Ӧ�þ������ֻ���Ч��������ͼ�Ĳ�ï�����º����á�
2. �����˵�����

3. ����
</code></pre><h2 id="����CSS-dispaly����"><a href="#����CSS-dispaly����" class="headerlink" title="����CSS dispaly����"></a>����CSS dispaly����</h2><p><a href="http://www.zhangxinxu.com/wordpress/2012/04/inline-block-space-remove-%E5%8E%BB%E9%99%A4%E9%97%B4%E8%B7%9D/" target="_blank" rel="external">ȥ��inline-blockԪ�ؼ�������N�ַ���</a></p>
<h2 id="��L�ߴ�"><a href="#��L�ߴ�" class="headerlink" title="��Ļ�ߴ�"></a>��Ļ�ߴ�</h2><p>����̨ʽ��1536*482��<br><a href="http://www.cnblogs.com/lyzg/p/4877277.html?utm_source=caibaojian.com" target="_blank" rel="external">���������Ա���font-size˼��ǰ�����Ƹ��빤����</a><br><a href="https://github.com/peunzhang/pageResponse" target="_blank" rel="external">pageResponse�ƶ�����Ӧʽ����</a></p>
<h3 id="�ٷֱY���"><a href="#�ٷֱY���" class="headerlink" title="�ٷֱȲ���"></a>�ٷֱȲ���</h3><h3 id="rem����"><a href="#rem����" class="headerlink" title="rem����"></a>rem����</h3><p>���㣺 remֻ����ĳ���ֲ���Χ����Ӧ����ĳЩ�ֱ�����Ч������</p>
<h3 id="transfer��scale����"><a href="#transfer��scale����" class="headerlink" title="transfer��scale����"></a>transfer��scale����</h3><h3 id="Flex����"><a href="#Flex����" class="headerlink" title="Flex����"></a>Flex����</h3><p><a href="https://segmentfault.com/a/1190000011428421" target="_blank" rel="external">Flex���ֲ���������������</a></p>
<h2 id="ͼTfloat��������DIV�д�ֱ����"><a href="#ͼTfloat��������DIV�д�ֱ����" class="headerlink" title="ͼƬfloat��������DIV�д�ֱ����"></a>ͼƬfloat��������DIV�д�ֱ����</h2><p>ͼƬfloat��������DIV�д�ֱ����?<br><a href="http://www.zhangxinxu.com/study/200908/img-text-vertical-align.html" target="_blank" rel="external">��С���̶���ͼƬ�Ͷ������ֵĴ�ֱˮƽ����</a></p>
<p>border-bottom: 3px solid #FD904B !important;</p>
<p>����/չ��</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">var zk = document.getElementById(&quot;zk&quot;);</div><div class="line">var iszk = false;</div><div class="line">zk.onclick = function () &#123;</div><div class="line">    if (iszk) &#123;</div><div class="line">        document.getElementById(&quot;banner2&quot;).style.padding = &quot;20px 0&quot;;</div><div class="line">        zk.innerHTML = &apos;&lt;p style=&quot;text-indent: 2em;margin-top: 10px&quot;&gt;�й��Ļ���������ȫ���ԣ�������ģ�Ļ�����ҵʢ�ᣬ�����ѳɹ��ٰ��Ľ죬���нϸߵ���ҵ֪����������Ӱ�������Ļ����������ᣨ���£�����&lt;span style=&quot;color: dodgerblue;&quot;&gt;չ��ȫ��&lt;/span&gt;&lt;/p&gt;&apos;;</div><div class="line">        iszk = false;</div><div class="line">    &#125; else &#123;</div><div class="line">        document.getElementById(&quot;banner2&quot;).style.padding = &quot;0 0 20px 0&quot;;</div><div class="line">        zk.innerHTML = &apos;&lt;p style=&quot;text-indent: 2em;margin-top: 10px&quot;&gt;�й��Ļ���������ȫ���ԡ�������ģ�Ļ�����ҵʢ�ᣬ�������ѳɹ��ٰ��Ľ죬���нϸߵ���ҵ֪����������Ӱ�������Ļ����������ᣨ���¼��ơ������ᡱ������������Ҫ���飬���������ټ��Ļ�����ҵ����������ҵ��λ������չʾ��ҵ�ڶ����Ļ����Ƽ������ι�Ӧ���Լ������Ļ����������ʲ�Ʒ��������Ϊ�����ٰ��ع�����������ҵ�λ���������һ���Ļ�����ʢ�硣&lt;/p&gt;&lt;div class=&quot;_underline&quot;&gt;&lt;/div&gt;&lt;p&gt;չ�����ƣ�2017���й��Ļ�������?�Ļ�����������&lt;/p&gt;&lt;p&gt;ʱ&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;�䣺2017��11��29��-12��1�գ�չ��3�죩&lt;/p&gt;&lt;p&gt;��&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;�㣺����ɽ�л�չ����&lt;/p&gt;&lt;p&gt;��&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;ģ��������չ������Լ30000ƽ���ף�ӵ��3��չ��������11000ƽ���ף����Ĵ�չ����&lt;/p&gt;&lt;div class=&quot;_underline&quot;&gt;&lt;/div&gt;&lt;p&gt;��һչ����������+�������Ļ�����ҵ�������ĸ�&lt;/p&gt;&lt;p&gt;�ڶ�չ�����������ʣ����㴫ͳ�Ļ��Ĵ����봴��&lt;/p&gt;&lt;p&gt;����չ�����Ļ����β�Ʒ����&lt;/p&gt;&lt;p&gt;����չ�������׹��ʻ��������Ļ����߻����˶���Ʒչ&lt;/p&gt;&lt;div&gt;&lt;p style=&quot;color: dodgerblue;text-align: right&quot;&gt;����&lt;/p&gt;&lt;/div&gt;&lt;br&gt;&apos;;</div><div class="line">        iszk = true;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">//Ѱ��</div><div class="line">function findGold() &#123;</div><div class="line">    window.location.href = &quot;?r=wbh/findgold&quot;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>�Զ��尴ť<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">.custombtn &#123;</div><div class="line">    padding: 10px;</div><div class="line">    border-radius: 5px;</div><div class="line">    background-color: #6A9FFD;</div><div class="line">    color: white !important;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>ͼ�Ŀ��»���<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">.underline &#123;</div><div class="line">    padding: 10px 0;</div><div class="line">    margin: 0 5px;</div><div class="line">    border-bottom: 1px solid #eeeeee;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&lt;div class=&quot;underline&quot;&gt;</div><div class="line">    &lt;a href=&quot;?r=site/cominfo&amp;amp;id=5&quot; class=&quot;cusBtn&quot;&gt;</div><div class="line">    &lt;div class=&quot;row&quot;&gt;</div><div class="line">        &lt;div class=&quot;col-xs-3&quot; align=&quot;center&quot;&gt;</div><div class="line">                                            &lt;img src=&quot;company/5.png&quot; width=&quot;100%&quot; style=&quot;max-height: 50px&quot;&gt;</div><div class="line">                                        &lt;/div&gt;</div><div class="line">        &lt;div class=&quot;col-xs-9&quot;&gt;</div><div class="line">            &lt;h4 style=&quot;color: #AE923F;&quot;&gt;������ͼ���������Ƽ���չ���޹�˾&lt;/h4&gt;</div><div class="line">            &lt;p style=&quot;margin:15px 0;&quot;&gt;������ͼ��һ���Ժ����л��Ļ���������������Ϊ��ּ���Ļ�������...&lt;/p&gt;</div><div class="line">        &lt;/div&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">    &lt;/a&gt;</div><div class="line">&lt;/div&gt;</div></pre></td></tr></table></figure>
<p>����������</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;div class=&quot;triangle&quot;&gt;&lt;/div&gt;</div><div class="line">.triangle &#123;</div><div class="line">    margin: 1em auto;</div><div class="line">    width: 0;</div><div class="line">    height: 0;</div><div class="line">    border-left: 0.5em solid transparent;</div><div class="line">    border-right: 0.5em solid transparent;</div><div class="line">    border-top: 0.6em solid #222;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">.researchFormTop .triangle &#123;</div><div class="line">    margin: 1em auto;</div><div class="line">    width: 0;</div><div class="line">    height: 0;</div><div class="line">    border-left: 0.5em solid transparent;</div><div class="line">    border-right: 0.5em solid transparent;</div><div class="line">    border-bottom: 0.6em solid #222;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>΢�ŷ���<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">wx.config(&#123;</div><div class="line">    debug: false,</div><div class="line">    appId: &apos;wxe0e045abe94b1536&apos;, // ������ںŵ�Ψһ��ʶ</div><div class="line">    timestamp: &apos;1512444969&apos;, // �������ǩ����ʱ����</div><div class="line">    nonceStr: &apos;53ee6134-5e1e-495d-b2d4-edac4fbed2e2&apos;, // �������ǩ����������</div><div class="line">    signature: &quot;ca62c5cdcc0b88b62c9b52783d4dcf4aad141ad7&quot;,</div><div class="line">    jsApiList: [&apos;onMenuShareTimeline&apos;, &apos;onMenuShareAppMessage&apos;,&apos;hideMenuItems&apos;] // �����Ҫʹ�õ�JS�ӿ��б�������JS�ӿ��б�����¼2</div><div class="line">&#125;);</div><div class="line"></div><div class="line">wx.ready(function()&#123;</div><div class="line">	console.log(&quot;΢����֤�ɹ�&quot;);</div><div class="line">	wx.hideMenuItems(&#123;</div><div class="line">	    menuList: [&apos;menuItem:copyUrl&apos;,&apos;menuItem:originPage&apos;,&apos;menuItem:openWithQQBrowser&apos;,&apos;menuItem:openWithSafari&apos;,&apos;menuItem:share:qq&apos;,&apos;menuItem:share:weiboApp&apos;,&apos;menuItem:share:QZone&apos;] // Ҫ���صĲ˵��ֻ�����ء������ࡱ�͡������ࡱ��ť������menu������¼3</div><div class="line">	&#125;);</div><div class="line">	</div><div class="line">	//����Ȧ</div><div class="line">	var title=&quot;�й��Ļ���������ֱ������&quot;;</div><div class="line">	var link=location.href;</div><div class="line">	if(location.href.indexOf(&quot;sub&quot;)==-1)&#123;</div><div class="line">		link+=&quot;&amp;sub=0&quot;;</div><div class="line">	&#125;</div><div class="line">	var imgUrl=location.protocol+location.host+&quot;/liveimage/zgwhwlds.jpg&quot;</div><div class="line">	var desc=&quot;�����˴����������ʣ���һʱ���ۿ�ȫ��Ⱥ���Ļ������ֱ����&quot;;</div><div class="line">wx.onMenuShareTimeline(&#123;</div><div class="line">    title: title, // ��������</div><div class="line">    link: link, // �������ӣ�������������·�������뵱ǰҳ����Ӧ�Ĺ��ں�JS��ȫ����һ��</div><div class="line">    imgUrl: imgUrl, // ����ͼ��</div><div class="line">    success: function () &#123; </div><div class="line">        layer_show(&quot;�����ɹ�&quot;);</div><div class="line">    &#125;,</div><div class="line">    cancel: function () &#123; </div><div class="line">    &#125;,fail:function()&#123;</div><div class="line">    	layer_show(&quot;����ʧ��&quot;);</div><div class="line">    &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"></div><div class="line">//����������</div><div class="line"> wx.onMenuShareAppMessage(&#123;</div><div class="line">    title: title, // ��������</div><div class="line">    desc: desc, // ��������</div><div class="line">    link: link, // �������ӣ�������������·�������뵱ǰҳ����Ӧ�Ĺ��ں�JS��ȫ����һ��</div><div class="line">    imgUrl: imgUrl, // ����ͼ��</div><div class="line">    type: &apos;&apos;, // ��������,music��video��link������Ĭ��Ϊlink</div><div class="line">    dataUrl: &apos;&apos;, // ����type��music��video����Ҫ�ṩ�������ӣ�Ĭ��Ϊ��</div><div class="line">    success: function () &#123; </div><div class="line">    	layer_show(&quot;�����ɹ�&quot;);</div><div class="line">    &#125;,</div><div class="line">    cancel: function () &#123; </div><div class="line">    &#125;,fail:function()&#123;</div><div class="line">    	layer_show(&quot;����ʧ��&quot;);</div><div class="line">    &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line">&#125;);</div><div class="line"></div><div class="line">wx.error(function(res)&#123;</div><div class="line">// config��Ϣ��֤ʧ�ܻ�ִ��error��������ǩ�����ڵ�����֤ʧ�ܣ�����������Ϣ���Դ���config��debugģʽ�鿴��Ҳ�����ڷ��ص�res�����в鿴������SPA��������������ǩ����</div><div class="line">console.log(&quot;΢����֤ʧ��&quot;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';       
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);

    var sozzsrc = (document.location.protocol == "http:") ? "http://js.passport.qihucdn.com/11.0.1.js?6934e60f0fcbf5f113646cf0c3c61c6a":"https://jspassport.ssl.qhimg.com/11.0.1.js?6934e60f0fcbf5f113646cf0c3c61c6a";
    document.write('<script src="' + sozzsrc + '" id="sozz"><\/script>');
})();
</script>
]]></content>
    
    <summary type="html">
    
      html��������
    
    </summary>
    
      <category term="layout html" scheme="https://austinxishou.github.io/categories/layout-html/"/>
    
    
      <category term="html" scheme="https://austinxishou.github.io/tags/html/"/>
    
  </entry>
  
  <entry>
    <title>fileinput.js ʵ���ļ��ϴ�����</title>
    <link href="https://austinxishou.github.io/2018/01/01/webdesign/wantu-cdn-sdk/"/>
    <id>https://austinxishou.github.io/2018/01/01/webdesign/wantu-cdn-sdk/</id>
    <published>2018-01-01T11:28:22.096Z</published>
    <updated>2018-01-01T11:39:56.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="About-����"><a href="#About-����" class="headerlink" title="About-����"></a>About-����</h2><p><a href="http://baichuan.taobao.com/docs/doc.htm?spm=a3c0d.7629140.0.0.MyI4iu&amp;treeId=38&amp;articleId=102762&amp;docType=1" target="_blank" rel="external">�ٷ��ĵ�</a></p>
<h2 id="�ٷ�jssdkʵ��"><a href="#�ٷ�jssdkʵ��" class="headerlink" title="�ٷ�jssdkʵ��"></a>�ٷ�jssdkʵ��</h2><ul>
<li>����html5 js�ϴ�����</li>
</ul>
<h3 id="ʹ�÷���"><a href="#ʹ�÷���" class="headerlink" title="ʹ�÷���"></a>ʹ�÷���</h3><pre><code>window.uploadJSSDK({
    file: File,   //�ļ�������,html5 file���ͣ�����Ҫ��������
    token: &apos;test&apos;,  //��Ȩtoken������
    dir: &apos;&apos;,  //Ŀ¼��ѡ�Ĭ�ϸ�Ŀ¼&apos;&apos;
    retries: 0,  //���Դ�����ѡ�Ĭ��0������
    maxSize: 0,  //�ϴ���С���ƣ�ѡ�Ĭ��0û������
    chunkSize: 4*1024*1024,  //��Ƭ�ϴ�ÿƬ��С��ѡ�Ĭ��4M
    name: &quot;test&quot;,  //�ļ����ƣ�ѡ�Ĭ��Ϊ�ļ�����
    callback: function (percent, result) {
        //percent���ϴ��ٷֱȣ���-1ʧ�ܣ�0-100�ϴ��İٷֱȣ�100�������ϴ�
        //result(�����˷��ص�responseText��json��ʽ)
    }
});
</code></pre><h3 id="upfile-js����"><a href="#upfile-js����" class="headerlink" title="upfile.js����"></a>upfile.js����</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">if (!file || !token) &#123;</div><div class="line">            callback(-1, &apos;�ϴ��ļ�������������file�Լ�token&apos;);</div><div class="line">            return;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        if (maxSize &amp;&amp; file.size &gt; maxSize) &#123;</div><div class="line">            callback(-1, &quot;�ļ���С���ܳ���&quot;+maxSize);</div><div class="line">            return;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        if (file.size &gt; chunkSize) &#123;</div><div class="line">            //�ֿ��ϴ�</div><div class="line">            startChunks();</div><div class="line">        &#125; else &#123;</div><div class="line">            //��ͨ�ϴ�</div><div class="line">            uploadSingle();</div><div class="line">        &#125;</div></pre></td></tr></table></figure>
<h3 id="uploadSingle-��ͨ�ϴ�"><a href="#uploadSingle-��ͨ�ϴ�" class="headerlink" title="uploadSingle-��ͨ�ϴ�"></a>uploadSingle-��ͨ�ϴ�</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">function uploadSingle() &#123;</div><div class="line">          var formData = new FormData();</div><div class="line">          formData.append(&apos;dir&apos;, dir);</div><div class="line">          formData.append(&apos;name&apos;, configName);</div><div class="line">          formData.append(&apos;size&apos;, file.size);</div><div class="line">          formData.append(&apos;content&apos;, file);</div><div class="line">          var url = upload_url;</div><div class="line"></div><div class="line">          ajax(url, formData, function (e) &#123;</div><div class="line">              var status = e.status,</div><div class="line">                  message = e.statusText || &quot;&quot;;</div><div class="line">              if (status == 200 &amp;&amp; message == &quot;OK&quot;) &#123;</div><div class="line">                  callback(100, JSON.parse(e.responseText));</div><div class="line">              &#125; else &#123;</div><div class="line">                  handleError(JSON.parse(e.responseText), &quot;&quot;, &quot;&quot;, status);</div><div class="line">              &#125;</div><div class="line">          &#125;);</div><div class="line">      &#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">function ajax(url,data,complete)&#123;</div><div class="line">    var request = new XMLHttpRequest();</div><div class="line">    var query = &apos;Authorization=&apos; + token + &apos;&amp;UserAgent=ALIMEDIASDK_WORKSTATION&apos;;</div><div class="line">    if(url.indexOf(&apos;?&apos;) &gt; -1)&#123;</div><div class="line">        url += &apos;&amp;&apos; + query;</div><div class="line">    &#125;else&#123;</div><div class="line">        url += &apos;?&apos; + query;</div><div class="line">    &#125;</div><div class="line">    request.open(&apos;POST&apos;, url);</div><div class="line">    </div><div class="line">    request.onload = function(e) &#123;</div><div class="line">        complete(request);</div><div class="line">    &#125;;</div><div class="line">    request.send(data);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="����plupload-jsʹ��"><a href="#����plupload-jsʹ��" class="headerlink" title="����plupload.jsʹ��"></a>����plupload.jsʹ��</h2><script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';       
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);

    var sozzsrc = (document.location.protocol == "http:") ? "http://js.passport.qihucdn.com/11.0.1.js?6934e60f0fcbf5f113646cf0c3c61c6a":"https://jspassport.ssl.qhimg.com/11.0.1.js?6934e60f0fcbf5f113646cf0c3c61c6a";
    document.write('<script src="' + sozzsrc + '" id="sozz"><\/script>');
})();
</script>
]]></content>
    
    <summary type="html">
    
      fileinput.js ʵ���ļ��ϴ�����
    
    </summary>
    
      <category term="webdesign" scheme="https://austinxishou.github.io/categories/webdesign/"/>
    
    
      <category term="JavaScript" scheme="https://austinxishou.github.io/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>�ƶ�Webǰ��֪ʶ��</title>
    <link href="https://austinxishou.github.io/2017/12/19/webdesign/iframe-cross-domain-control/"/>
    <id>https://austinxishou.github.io/2017/12/19/webdesign/iframe-cross-domain-control/</id>
    <published>2017-12-19T09:38:15.801Z</published>
    <updated>2017-12-19T09:46:13.225Z</updated>
    
    <content type="html"><![CDATA[<h2 id="iframe�������ܿ����໥���ʷ���"><a href="#iframe�������ܿ����໥���ʷ���" class="headerlink" title="iframe�������ܿ����໥���ʷ���"></a>iframe�������ܿ����໥���ʷ���</h2><h3 id="iframe-closed-by-itself"><a href="#iframe-closed-by-itself" class="headerlink" title="iframe closed by itself"></a>iframe closed by itself</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">//close by myself</div><div class="line">window.parent.document.body.removeChild(window.frameElement);</div><div class="line"></div><div class="line">//close by parent window //not cross domain</div><div class="line">top.window.close_iframe();//parent.close_iframe();</div><div class="line"></div><div class="line">//close by id //not allowed with cross origin</div><div class="line">let iframeRoom = window.parent.document.getElementById(&apos;iframe_room&apos;);</div><div class="line">iframeRoom.parentNode.removeChild(iframeRoom);</div></pre></td></tr></table></figure>
<h3 id="1-ͬ���໥����"><a href="#1-ͬ���໥����" class="headerlink" title="1.ͬ���໥����"></a>1.ͬ���໥����</h3><p>����A.html �� b.html domain����localhost ��ͬ����</p>
<p>A.html��iframe Ƕ�� B.html��name=myframe</p>
<p>A.html��js function fMain()</p>
<p>B.html��js function fIframe()</p>
<p>��Ҫʵ�� A.html ���� B.html �� fIframe()��B.html ���� A.html �� fMain()</p>
<p><code>A.html</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;  </div><div class="line">&lt;html&gt;  </div><div class="line"> &lt;head&gt;  </div><div class="line">  &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=utf-8&quot;&gt;  </div><div class="line">  &lt;title&gt; main window &lt;/title&gt;  </div><div class="line">  </div><div class="line">  &lt;script type=&quot;text/javascript&quot;&gt;  </div><div class="line">  // main js function  </div><div class="line">  function fMain()&#123;  </div><div class="line">    alert(&apos;main function execute success&apos;);  </div><div class="line">  &#125;  </div><div class="line">  </div><div class="line">  // exec iframe function  </div><div class="line">  function exec_iframe()&#123;  </div><div class="line">    window.myframe.fIframe();  </div><div class="line">  &#125;  </div><div class="line">  &lt;/script&gt;  </div><div class="line">  </div><div class="line"> &lt;/head&gt;  </div><div class="line">  </div><div class="line"> &lt;body&gt;  </div><div class="line">  &lt;p&gt;A.html main&lt;/p&gt;  </div><div class="line">  &lt;p&gt;&lt;input type=&quot;button&quot; value=&quot;exec iframe function&quot; onclick=&quot;exec_iframe()&quot;&gt;&lt;/p&gt;  </div><div class="line">  &lt;iframe src=&quot;B.html&quot; name=&quot;myframe&quot; width=&quot;500&quot; height=&quot;100&quot;&gt;&lt;/iframe&gt;  </div><div class="line"> &lt;/body&gt;  </div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure>
<p><code>B.html</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;  </div><div class="line">&lt;html&gt;  </div><div class="line"> &lt;head&gt;  </div><div class="line">  &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=utf-8&quot;&gt;  </div><div class="line">  &lt;title&gt; iframe window &lt;/title&gt;  </div><div class="line">  </div><div class="line">  &lt;script type=&quot;text/javascript&quot;&gt;  </div><div class="line">  // iframe js function   </div><div class="line">  function fIframe()&#123;  </div><div class="line">    alert(&apos;iframe function execute success&apos;);  </div><div class="line">  &#125;  </div><div class="line">  </div><div class="line">  // exec main function  </div><div class="line">  function exec_main()&#123;  </div><div class="line">    parent.fMain();  </div><div class="line">  &#125;  </div><div class="line">  &lt;/script&gt;  </div><div class="line">  </div><div class="line"> &lt;/head&gt;  </div><div class="line">  </div><div class="line"> &lt;body&gt;  </div><div class="line">  &lt;p&gt;B.html iframe&lt;/p&gt;  </div><div class="line">  &lt;p&gt;&lt;input type=&quot;button&quot; value=&quot;exec main function&quot; onclick=&quot;exec_main()&quot;&gt;&lt;/p&gt;  </div><div class="line"> &lt;/body&gt;  </div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure>
<p>����A.html �� exec iframe function button��ִ�гɹ�</p>
<h3 id="������������"><a href="#������������" class="headerlink" title="������������"></a>������������</h3><p>���� A.html domain�� localhost�� B.html domain �� 127.0.0.1 ��������</p>
<p>����ʹ�� localhost �� 127.0.0.1 ֻ�Ƿ������ԣ�localhost �� 127.0.0.1�Ѿ���ͬһ����������ִ��Ч����һ���ġ�</p>
<p>ʵ��ʹ��ʱ���� www.domaina.com �� www.domainb.com ���ɡ�</p>
<p>A.html��iframe Ƕ�� B.html��name=myframe</p>
<p>A.html��js function fMain()</p>
<p>B.html��js function fIframe()</p>
<p>��Ҫʵ�� A.html ���� B.html �� fIframe()��B.html ���� A.html �� fMain() ���������ã�</p>
<p>����ʹ������ͬ���ķ������������ж�A.html �� B.html ��ͬ�򣬻��д�����ʾ��</p>
<p>Uncaught SecurityError: Blocked a frame with origin “<a href="http://localhost" target="_blank" rel="external">http://localhost</a>“ from accessing a frame with origin “<a href="http://127.0.0.1" target="_blank" rel="external">http://127.0.0.1</a>“. Protocols, domains, and ports must match.</p>
<p>ʵ��ԭ����</p>
<p>��Ϊ������Ϊ�˰�ȫ����ֹ�˲�ͬ�����ʡ�����ֻҪ������ִ�е�˫����ͬ���������໥���ʡ�</p>
<p>���ȣ�A.html ���ε���B.html�� fIframe����</p>
<p>1.��A.html ����һ�� iframe</p>
<p>2.iframe��ҳ������ B.html ͬ���£�����ΪexecB.html</p>
<p>3.execB.html ���е���B.html fIframe������js����</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;script type=&quot;text/javascript&quot;&gt;  </div><div class="line">parent.window.myframe.fIframe(); // execute parent myframe fIframe function  </div><div class="line">&lt;/script&gt;</div></pre></td></tr></table></figure>
<p>��������ʵ�� A.html �� B.html �����໥���á�</p>
<p><code>A.html</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;  </div><div class="line">&lt;html&gt;  </div><div class="line"> &lt;head&gt;  </div><div class="line">  &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=utf-8&quot;&gt;  </div><div class="line">  &lt;title&gt; main window &lt;/title&gt;  </div><div class="line">  </div><div class="line">  &lt;script type=&quot;text/javascript&quot;&gt;  </div><div class="line">  </div><div class="line">  // main js function  </div><div class="line">  function fMain()&#123;  </div><div class="line">    alert(&apos;main function execute success&apos;);  </div><div class="line">  &#125;  </div><div class="line">  </div><div class="line">  // exec iframe function  </div><div class="line">  function exec_iframe()&#123;  </div><div class="line">    if(typeof(exec_obj)==&apos;undefined&apos;)&#123;  </div><div class="line">        exec_obj = document.createElement(&apos;iframe&apos;);  </div><div class="line">        exec_obj.name = &apos;tmp_frame&apos;;  </div><div class="line">        exec_obj.src = &apos;http://127.0.0.1/execB.html&apos;;  </div><div class="line">        exec_obj.style.display = &apos;none&apos;;  </div><div class="line">        document.body.appendChild(exec_obj);  </div><div class="line">    &#125;else&#123;  </div><div class="line">        exec_obj.src = &apos;http://127.0.0.1/execB.html?&apos; + Math.random();  </div><div class="line">    &#125;  </div><div class="line">  &#125;  </div><div class="line">  &lt;/script&gt;  </div><div class="line">  </div><div class="line"> &lt;/head&gt;  </div><div class="line">  </div><div class="line"> &lt;body&gt;  </div><div class="line">  &lt;p&gt;A.html main&lt;/p&gt;  </div><div class="line">  &lt;p&gt;&lt;input type=&quot;button&quot; value=&quot;exec iframe function&quot; onclick=&quot;exec_iframe()&quot;&gt;&lt;/p&gt;  </div><div class="line">  &lt;iframe src=&quot;http://127.0.0.1/B.html&quot; name=&quot;myframe&quot; width=&quot;500&quot; height=&quot;100&quot;&gt;&lt;/iframe&gt;  </div><div class="line"> &lt;/body&gt;  </div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure></p>
<p><code>B.html</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;  </div><div class="line">&lt;html&gt;  </div><div class="line"> &lt;head&gt;  </div><div class="line">  &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=utf-8&quot;&gt;  </div><div class="line">  &lt;title&gt; iframe window &lt;/title&gt;  </div><div class="line">  </div><div class="line">  &lt;script type=&quot;text/javascript&quot;&gt;  </div><div class="line">  // iframe js function   </div><div class="line">  function fIframe()&#123;  </div><div class="line">    alert(&apos;iframe function execute success&apos;);  </div><div class="line">  &#125;  </div><div class="line">  </div><div class="line">  // exec main function  </div><div class="line">  function exec_main()&#123;  </div><div class="line">    if(typeof(exec_obj)==&apos;undefined&apos;)&#123;  </div><div class="line">        exec_obj = document.createElement(&apos;iframe&apos;);  </div><div class="line">        exec_obj.name = &apos;tmp_frame&apos;;  </div><div class="line">        exec_obj.src = &apos;http://localhost/execA.html&apos;;  </div><div class="line">        exec_obj.style.display = &apos;none&apos;;  </div><div class="line">        document.body.appendChild(exec_obj);  </div><div class="line">    &#125;else&#123;  </div><div class="line">        exec_obj.src = &apos;http://localhost/execA.html?&apos; + Math.random();  </div><div class="line">    &#125;  </div><div class="line">  &#125;  </div><div class="line">  &lt;/script&gt;  </div><div class="line">  </div><div class="line"> &lt;/head&gt;  </div><div class="line">  </div><div class="line"> &lt;body&gt;  </div><div class="line">  &lt;p&gt;B.html iframe&lt;/p&gt;  </div><div class="line">  &lt;p&gt;&lt;input type=&quot;button&quot; value=&quot;exec main function&quot; onclick=&quot;exec_main()&quot;&gt;&lt;/p&gt;  </div><div class="line"> &lt;/body&gt;  </div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure></p>
<p><code>execA.html</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;  </div><div class="line">&lt;html&gt;  </div><div class="line"> &lt;head&gt;  </div><div class="line">  &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=utf-8&quot;&gt;  </div><div class="line">  &lt;title&gt; exec main function &lt;/title&gt;  </div><div class="line"> &lt;/head&gt;  </div><div class="line">  </div><div class="line"> &lt;body&gt;  </div><div class="line">    &lt;script type=&quot;text/javascript&quot;&gt;  </div><div class="line">        parent.parent.fMain(); // execute main function  </div><div class="line">    &lt;/script&gt;  </div><div class="line"> &lt;/body&gt;  </div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure></p>
<p><code>execB.html</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;  </div><div class="line">&lt;html&gt;  </div><div class="line"> &lt;head&gt;  </div><div class="line">  &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=utf-8&quot;&gt;  </div><div class="line">  &lt;title&gt; exec iframe function &lt;/title&gt;  </div><div class="line"> &lt;/head&gt;  </div><div class="line">  </div><div class="line"> &lt;body&gt;  </div><div class="line">    &lt;script type=&quot;text/javascript&quot;&gt;  </div><div class="line">        parent.window.myframe.fIframe(); // execute parent myframe fIframe function  </div><div class="line">    &lt;/script&gt;  </div><div class="line"> &lt;/body&gt;  </div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure></p>
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';       
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);

    var sozzsrc = (document.location.protocol == "http:") ? "http://js.passport.qihucdn.com/11.0.1.js?6934e60f0fcbf5f113646cf0c3c61c6a":"https://jspassport.ssl.qhimg.com/11.0.1.js?6934e60f0fcbf5f113646cf0c3c61c6a";
    document.write('<script src="' + sozzsrc + '" id="sozz"><\/script>');
})();
</script>
]]></content>
    
    <summary type="html">
    
      html��������
    
    </summary>
    
      <category term="layout html" scheme="https://austinxishou.github.io/categories/layout-html/"/>
    
    
      <category term="html" scheme="https://austinxishou.github.io/tags/html/"/>
    
  </entry>
  
  <entry>
    <title></title>
    <link href="https://austinxishou.github.io/2017/12/18/webdesign/JavaScript-parse-url-parameter/"/>
    <id>https://austinxishou.github.io/2017/12/18/webdesign/JavaScript-parse-url-parameter/</id>
    <published>2017-12-18T11:42:44.110Z</published>
    <updated>2017-12-18T11:42:36.000Z</updated>
    
    <content type="html"><![CDATA[<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';       
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);

    var sozzsrc = (document.location.protocol == "http:") ? "http://js.passport.qihucdn.com/11.0.1.js?6934e60f0fcbf5f113646cf0c3c61c6a":"https://jspassport.ssl.qhimg.com/11.0.1.js?6934e60f0fcbf5f113646cf0c3c61c6a";
    document.write('<script src="' + sozzsrc + '" id="sozz"><\/script>');
})();
</script>
]]></content>
    
    <summary type="html">
    
      &lt;script&gt;
(function(){
    var bp = document.createElement(&#39;script&#39;);
    var curProtocol = window.location.protocol.split(&#39;:&#39;)[0];
    if (c
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>docker-lnmp ���������� Laravel ����</title>
    <link href="https://austinxishou.github.io/2017/12/05/server/docker-lnmp-laravel/"/>
    <id>https://austinxishou.github.io/2017/12/05/server/docker-lnmp-laravel/</id>
    <published>2017-12-05T08:37:33.278Z</published>
    <updated>2018-01-23T09:36:16.178Z</updated>
    
    <content type="html"><![CDATA[<h2 id="�ο��j�"><a href="#�ο��j�" class="headerlink" title="�ο��ĵ�"></a>�ο��ĵ�</h2><p><a href="http://www.jianshu.com/p/2ad17b1df2c0" target="_blank" rel="external">ʹ��Docker�Laravel����</a></p>
<p><a href="https://www.jianshu.com/p/0ce73f584728" target="_blank" rel="external"></a><br><a href="https://www.jianshu.com/p/78b03cd5880e" target="_blank" rel="external">����docker���ٴ laravel ����</a></p>
<h2 id="docker-compose"><a href="#docker-compose" class="headerlink" title="docker-compose"></a>docker-compose</h2><h3 id="docker-compose-yml�򵥽���"><a href="#docker-compose-yml�򵥽���" class="headerlink" title="docker-compose.yml�򵥽���"></a>docker-compose.yml�򵥽���</h3><p>docker-compose�������������Ŷ�������Э���ġ�</p>
<p>ͨ��docker-compose.yml������nginx��php��mysql֮����ͨ�ź�Э����</p>
<p>��docker-lnmpĿ¼��ͨ������ docker-compose up ��������</p>
<p>Ȼ��ͨ�� localhost����localhost:8000�Ϳ��Է���index.php��</p>
<h2 id="Mysql"><a href="#Mysql" class="headerlink" title="Mysql"></a>Mysql</h2><p>Mysql����ֱ���������ٷ�,û�����κ��޸ġ�<br><a href="https://github.com/dockerfile/mysql" target="_blank" rel="external">�ٷ�Mysql���񹹽��ο�</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">mysql: ### ��������</div><div class="line">  image: mysql:5.7 ### �ٷ����� �汾��5.7</div><div class="line">  volumes:</div><div class="line">    - mysql-data:/var/lib/mysql ### ���ݾ���mysql���ݾʹ���������</div><div class="line">  ports:</div><div class="line">    - &quot;3306:3306&quot; ###�˿�ӳ�䣬�����˿�:���������˿�</div><div class="line">  environment:</div><div class="line">    - MYSQL_ROOT_PASSWORD=123456  ### ���û��������������������ǹٷ����������ġ�</div></pre></td></tr></table></figure>
<h2 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h2><p>PHP����Ҳ�������ٷ������ǹٷ�������û���ṩ����Mysql���ص�pdo_mysql��չ����������һ���޸ģ����Բ���ֱ����image�������ٷ���������Ҫ����дһ��Dockerfile���Զ���PHP������</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">php-fpm:</div><div class="line">      build:</div><div class="line">        context: ./php ### �Զ���PHP����������Ŀ¼</div><div class="line">      volumes:</div><div class="line">        - ./www:/var/www/html ### �����ļ��������ļ�ӳ�乲����PHP����������</div><div class="line">      expose:</div><div class="line">        - &quot;9000&quot; ### �������Ⱪ¶�Ķ˿�</div><div class="line">      depends_on:</div><div class="line">        - mysql ### ����������Mysql������������PHP�����Ϳ���ͨ��mysql��Ϊ������������Mysql������</div></pre></td></tr></table></figure>
<p>�Զ���PHP�����������ļ� Dockerfile</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">### ���Թٷ���PHP�����汾Ϊ7.1-fpm.</div><div class="line">### �ð汾ֻ����FPM������CLI,�������ﲢ����ִ��composer</div><div class="line">### ������Ҫ��PHP-CLI ��Ҫ�ٿ�һ��CLI���������߰�װͬʱ����FPM��CLI�İ汾</div><div class="line">FROM php:7.1-fpm </div><div class="line"></div><div class="line">### ���û�������</div><div class="line">ENV TZ=Asia/Shanghai</div><div class="line"></div><div class="line">### ִ��bash���װphp��������չ</div><div class="line">RUN apt-get update &amp;&amp; apt-get install -y \</div><div class="line">        libfreetype6-dev \</div><div class="line">        libjpeg62-turbo-dev \</div><div class="line">        libmcrypt-dev \</div><div class="line">        libpng12-dev \</div><div class="line">    ### ������docker�ṩ�İ�װphp��չ�ķ����������ﰲװ��pdo_mysql��չ����GD����</div><div class="line">    &amp;&amp; docker-php-ext-install -j$(nproc) iconv mcrypt mysqli pdo_mysql \</div><div class="line">    &amp;&amp; docker-php-ext-configure gd --with-freetype-dir=/usr/include/ --with-jpeg-dir=/usr/include/ \</div><div class="line">    &amp;&amp; docker-php-ext-install -j$(nproc) gd</div><div class="line">### ��չphp.ini</div><div class="line">COPY ./php.ini /usr/local/etc/php/conf.d/php.ini</div></pre></td></tr></table></figure>
<h2 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h2><p>Nginx��Ҫ����һ��server,����Ҳ��Ҫһ���򵥵Ķ���</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">nginx:</div><div class="line">  build:</div><div class="line">    context: ./nginx ### �Զ���Nginx����������Ŀ¼</div><div class="line">  volumes:</div><div class="line">      - ./www:/var/www/html �����ļ��������ļ�ӳ�乲����PHP����������</div><div class="line">  ports:</div><div class="line">      - &quot;80:80&quot; ### �˿�ӳ�䣬����������80�˿ڱ�ռ�ã�������8000:80</div><div class="line">      - &quot;443:443&quot;</div><div class="line">  depends_on:</div><div class="line">      - php-fpm ### ����������PHP������������Nginx�����Ϳ���ͨ��php-fpm��Ϊ������������PHP������</div></pre></td></tr></table></figure>
<p>�Զ���Nginx�����������ļ�Dockerfile</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">FROM nginx:1.11 ### �ٷ�����</div><div class="line"></div><div class="line">ENV TZ=Asia/Shanghai ### ��������</div><div class="line"></div><div class="line">COPY ./nginx.conf /etc/nginx/conf.d/default.conf ### server����</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">server &#123;</div><div class="line"></div><div class="line">    listen 80 default_server;</div><div class="line">    listen [::]:80 default_server ipv6only=on;</div><div class="line"></div><div class="line">    server_name localhost;</div><div class="line">    root /var/www/html;</div><div class="line">    index index.php index.html index.htm;</div><div class="line"></div><div class="line">    location / &#123;</div><div class="line">         try_files $uri $uri/ /index.php$is_args$args;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    location ~ \.php$ &#123;</div><div class="line">        try_files $uri /index.php =404;</div><div class="line"></div><div class="line">        ### ��Ҫ�������� php-fpm:9000������PHP����</div><div class="line">        fastcgi_pass php-fpm:9000;</div><div class="line">        fastcgi_split_path_info ^(.+\.php)(/.+)$;</div><div class="line">        fastcgi_index index.php;</div><div class="line">        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;</div><div class="line">        include fastcgi_params;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    location ~ /\.ht &#123;</div><div class="line">        deny all;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="��ȡ����"><a href="#��ȡ����" class="headerlink" title="��ȡ����"></a>��ȡ����</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker-compose pull</div></pre></td></tr></table></figure>
<h2 id="�޸�E��"><a href="#�޸�E��" class="headerlink" title="�޸�Ȩ��"></a>�޸�Ȩ��</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo chown www-data:www-data -R www/</div></pre></td></tr></table></figure>
<h2 id="��docker-��������laravel-����"><a href="#��docker-��������laravel-����" class="headerlink" title="��docker ��������laravel ����"></a>��docker ��������laravel ����</h2><pre><code>&gt; ��ȡ����������LavavelӦ�ó���,���ǲ�������Ҫһ����������PHP��web������,����Ҳ��Ҫ�ܹ�����PHP������Ӧ�ó�����composer��artisan.Ҳ�����и������л����ķ�ʽ(����������).��������һ���õĻ�������Dokcer��Laravel.ÿ�����̶���һ���Լ�������.

&gt; �з�����`composer`��`artisan`������������˵����һ������,���ǿ���ֻѡ������`docker-laravel-data`,`docker-laravel-nginx`��`docker-laravel-phpfpm`��������������.

![����ͼ��ͼ](/images/docker-lnmp-map.png)
</code></pre><h3 id="docker-laravel-data"><a href="#docker-laravel-data" class="headerlink" title="docker-laravel-data"></a>docker-laravel-data</h3><pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">FROM debian:jessie</div><div class="line"></div><div class="line">MAINTAINER &quot;Dylan Lindgren&quot; &lt;dylan.lindgren@gmail.com&gt;</div><div class="line"></div><div class="line">RUN mkdir -p /data</div><div class="line">VOLUME [&quot;/data&quot;]</div><div class="line">CMD [&quot;true&quot;]</div></pre></td></tr></table></figure>
</code></pre><h3 id="docker-laravel-nginx"><a href="#docker-laravel-nginx" class="headerlink" title="docker-laravel-nginx"></a>docker-laravel-nginx</h3><pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">FROM debian:jessie</div><div class="line"></div><div class="line">MAINTAINER &quot;Dylan Lindgren&quot; &lt;dylan.lindgren@gmail.com&gt;</div><div class="line"></div><div class="line">WORKDIR /tmp</div><div class="line"></div><div class="line">//Install Nginx</div><div class="line">RUN apt-get update -y &amp;&amp; \</div><div class="line">	apt-get install -y nginx</div><div class="line"></div><div class="line">//Apply Nginx configuration</div><div class="line">ADD config/nginx.conf /opt/etc/nginx.conf</div><div class="line">ADD config/laravel /etc/nginx/sites-available/laravel</div><div class="line">RUN ln -s /etc/nginx/sites-available/laravel /etc/nginx/sites-enabled/laravel &amp;&amp; \</div><div class="line">	rm /etc/nginx/sites-enabled/default</div><div class="line"></div><div class="line">//Nginx startup script</div><div class="line">ADD config/nginx-start.sh /opt/bin/nginx-start.sh</div><div class="line">RUN chmod u=rwx /opt/bin/nginx-start.sh</div><div class="line"></div><div class="line">RUN mkdir -p /data</div><div class="line">VOLUME [&quot;/data&quot;]</div><div class="line"></div><div class="line">//PORTS</div><div class="line">EXPOSE 80</div><div class="line">EXPOSE 443</div><div class="line"></div><div class="line">WORKDIR /opt/bin</div><div class="line">ENTRYPOINT [&quot;/opt/bin/nginx-start.sh&quot;]</div></pre></td></tr></table></figure>
</code></pre><h3 id="docker-laravel-phpfpm"><a href="#docker-laravel-phpfpm" class="headerlink" title="docker-laravel-phpfpm"></a>docker-laravel-phpfpm</h3><h3 id="Install-Composer"><a href="#Install-Composer" class="headerlink" title="Install Composer"></a>Install Composer</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">RUN curl -sS https://getcomposer.org/installer | php</div><div class="line">RUN mv composer.phar /usr/local/bin/composer</div><div class="line">RUN chmod a+x /usr/local/bin/composer</div></pre></td></tr></table></figure>
<h3 id="Install-MySQL-package"><a href="#Install-MySQL-package" class="headerlink" title="Install MySQL package"></a>Install MySQL package</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">RUN echo &quot;mysql-server mysql-server/root_password password devpass&quot; | debconf-set-selections</div><div class="line">RUN echo &quot;mysql-server mysql-server/root_password_again password devpass&quot; | debconf-set-selections</div><div class="line">RUN apt-get update &amp;&amp; apt-get install -y mysql-server mysql-client</div><div class="line">RUN usermod -d /var/lib/mysql/ mysql</div><div class="line">RUN update-rc.d mysql defaults</div></pre></td></tr></table></figure>
<h3 id="Access-Control-Allow-Origin-��������E������"><a href="#Access-Control-Allow-Origin-��������E������" class="headerlink" title="Access-Control-Allow-Origin ��������Ȩ������"></a>Access-Control-Allow-Origin ��������Ȩ������</h3><p>Nginx �����취��<br>add_header Access-Control-Allow-Origin *;<br>add_header Access-Control-Allow-Headers X-Requested-With;<br>add_header Access-Control-Allow-Methods GET,POST,OPTIONS;<br>�����δ������ӵ� http{} ���߾�̬��Դ��Ӧ�� server{} ��</p>
<p>����ֻΪ�Լ�����վʹ�ÿ��Խ���һ�д������ǺŸ�Ϊ�Լ������������� *.fbzl.org</p>
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';       
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);

    var sozzsrc = (document.location.protocol == "http:") ? "http://js.passport.qihucdn.com/11.0.1.js?6934e60f0fcbf5f113646cf0c3c61c6a":"https://jspassport.ssl.qhimg.com/11.0.1.js?6934e60f0fcbf5f113646cf0c3c61c6a";
    document.write('<script src="' + sozzsrc + '" id="sozz"><\/script>');
})();
</script>
]]></content>
    
    <summary type="html">
    
      docker-lnmp ���������� Laravel ����
    
    </summary>
    
      <category term="docker" scheme="https://austinxishou.github.io/categories/docker/"/>
    
    
      <category term="docker" scheme="https://austinxishou.github.io/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>�ƶ�Webǰ��֪ʶ��</title>
    <link href="https://austinxishou.github.io/2017/12/05/webdesign/web-front-lib/"/>
    <id>https://austinxishou.github.io/2017/12/05/webdesign/web-front-lib/</id>
    <published>2017-12-05T02:32:37.189Z</published>
    <updated>2017-12-05T02:41:11.791Z</updated>
    
    <content type="html"><![CDATA[<ol>
<li>(�����ṹ�淶)[<a href="https://html5boilerplate.com/mobile/" target="_blank" rel="external">https://html5boilerplate.com/mobile/</a>]</li>
<li>(��Դ�빤��)[<a href="https://github.com/AlloyTeam/Mars/tree/master/tools" target="_blank" rel="external">https://github.com/AlloyTeam/Mars/tree/master/tools</a>]</li>
<li><p><a href="https://github.com/AlloyTeam/AlloyLever" target="_blank" rel="external">�ƶ�Web�������Է������������ϱ��û����ⶨλ</a><script><br>(function(){<br> var bp = document.createElement(‘script’);<br> var curProtocol = window.location.protocol.split(‘:’)[0];<br> if (curProtocol === ‘https’) {</p>
<pre><code>bp.src = &apos;https://zz.bdstatic.com/linksubmit/push.js&apos;;       
</code></pre><p> }<br> else {</p>
<pre><code>bp.src = &apos;http://push.zhanzhang.baidu.com/push.js&apos;;
</code></pre><p> }<br> var s = document.getElementsByTagName(“script”)[0];<br> s.parentNode.insertBefore(bp, s);</p>
<p> var sozzsrc = (document.location.protocol == “http:”) ? “<a href="http://js.passport.qihucdn.com/11.0.1.js?6934e60f0fcbf5f113646cf0c3c61c6a&quot;:&quot;https://jspassport.ssl.qhimg.com/11.0.1.js?6934e60f0fcbf5f113646cf0c3c61c6a">http://js.passport.qihucdn.com/11.0.1.js?6934e60f0fcbf5f113646cf0c3c61c6a&quot;:&quot;https://jspassport.ssl.qhimg.com/11.0.1.js?6934e60f0fcbf5f113646cf0c3c61c6a</a>“;<br> document.write(‘<script src="' + sozzsrc + '" id="sozz">&lt;\/script&gt;’);<br>})();<br></script></p>
</li>
</ol>
]]></content>
    
    <summary type="html">
    
      html��������
    
    </summary>
    
      <category term="layout html" scheme="https://austinxishou.github.io/categories/layout-html/"/>
    
    
      <category term="html" scheme="https://austinxishou.github.io/tags/html/"/>
    
  </entry>
  
  <entry>
    <title>Javascript常用函数方法</title>
    <link href="https://austinxishou.github.io/2017/12/05/webdesign/js-common-method/"/>
    <id>https://austinxishou.github.io/2017/12/05/webdesign/js-common-method/</id>
    <published>2017-12-05T02:08:23.446Z</published>
    <updated>2017-12-05T02:16:18.915Z</updated>
    
    <content type="html"><![CDATA[<h2 id="getParameter"><a href="#getParameter" class="headerlink" title="getParameter"></a>getParameter</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">function getParameter(n) &#123;</div><div class="line">    var m = window.location.hash.match(new RegExp(&apos;(?:#|&amp;)&apos; + n + &apos;=([^&amp;]*)(&amp;|$)&apos;)),</div><div class="line">        result = !m ? &apos;&apos; : decodeURIComponent(m[1])</div><div class="line">    return result ||getParameterByName(n)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">function getParameterByName(name, url) &#123;</div><div class="line">    if (!url) url = window.location.href</div><div class="line">    name = name.replace(/[\[\]]/g, &quot;\\$&amp;&quot;)</div><div class="line">    var regex = new RegExp(&quot;[?&amp;]&quot; + name + &quot;(=([^&amp;#]*)|&amp;|#|$)&quot;),</div><div class="line">        results = regex.exec(url)</div><div class="line">    if (!results) return null</div><div class="line">    if (!results[2]) return &apos;&apos;</div><div class="line">    return decodeURIComponent(results[2].replace(/\+/g, &quot; &quot;))</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="getCookie"><a href="#getCookie" class="headerlink" title="getCookie"></a>getCookie</h2><p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">function getCookie(name)&#123;</div><div class="line">    var arr,reg=new RegExp(&quot;(^| )&quot;+name+&quot;=([^;]*)(;|$)&quot;)</div><div class="line"></div><div class="line">    if(arr=document.cookie.match(reg))</div><div class="line">        return unescape(arr[2])</div><div class="line">    else</div><div class="line">        return null</div><div class="line">&#125;</div></pre></td></tr></table></figure><script><br>(function(){<br>    var bp = document.createElement(‘script’);<br>    var curProtocol = window.location.protocol.split(‘:’)[0];<br>    if (curProtocol === ‘https’) {<br>        bp.src = ‘<a href="https://zz.bdstatic.com/linksubmit/push.js">https://zz.bdstatic.com/linksubmit/push.js</a>‘;<br>    }<br>    else {<br>        bp.src = ‘<a href="http://push.zhanzhang.baidu.com/push.js">http://push.zhanzhang.baidu.com/push.js</a>‘;<br>    }<br>    var s = document.getElementsByTagName(“script”)[0];<br>    s.parentNode.insertBefore(bp, s);</p>
<pre><code>var sozzsrc = (document.location.protocol == &quot;http:&quot;) ? &quot;http://js.passport.qihucdn.com/11.0.1.js?6934e60f0fcbf5f113646cf0c3c61c6a&quot;:&quot;https://jspassport.ssl.qhimg.com/11.0.1.js?6934e60f0fcbf5f113646cf0c3c61c6a&quot;;
document.write(&apos;&lt;script src=&quot;&apos; + sozzsrc + &apos;&quot; id=&quot;sozz&quot;&gt;&lt;\/script&gt;&apos;);
</code></pre><p>})();<br></script></p>
]]></content>
    
    <summary type="html">
    
      Javascript常用函数方法
    
    </summary>
    
      <category term="webdesign" scheme="https://austinxishou.github.io/categories/webdesign/"/>
    
    
      <category term="JavaScript" scheme="https://austinxishou.github.io/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>Laravel加Vue技术应用系列-1</title>
    <link href="https://austinxishou.github.io/2017/12/01/webdesign/Laravel-vue-series-1/"/>
    <id>https://austinxishou.github.io/2017/12/01/webdesign/Laravel-vue-series-1/</id>
    <published>2017-12-01T01:12:49.531Z</published>
    <updated>2017-11-27T13:03:51.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Start-起步"><a href="#Start-起步" class="headerlink" title="Start-起步"></a>Start-起步</h2><blockquote>
<p>起步说明:</p>
</blockquote>
<p>选择Github资源: <a href="https://github.com/phanan/koel" target="_blank" rel="external">phanan/koel</a></p>
<p><a href="https://koel.phanan.net/docs/#/" target="_blank" rel="external">官方文档-Official Documentation</a></p>
<h2 id="Install-安装"><a href="#Install-安装" class="headerlink" title="Install-安装"></a>Install-安装</h2><p><code>初始环境需求</code></p>
<ul>
<li>All requirements by Laravel – PHP, OpenSSL, composer and such. Consider setting PHP’s memory_limit to a good value (512M or better) if you have a big library.</li>
<li>MySQL or MariaDB. Actually, any DBMS supported by Laravel should work.</li>
<li><p>NodeJS latest stable with yarn<script><br>(function(){<br>  var bp = document.createElement(‘script’);<br>  var curProtocol = window.location.protocol.split(‘:’)[0];<br>  if (curProtocol === ‘https’) {</p>
<pre><code>bp.src = &apos;https://zz.bdstatic.com/linksubmit/push.js&apos;;       
</code></pre><p>  }<br>  else {</p>
<pre><code>bp.src = &apos;http://push.zhanzhang.baidu.com/push.js&apos;;
</code></pre><p>  }<br>  var s = document.getElementsByTagName(“script”)[0];<br>  s.parentNode.insertBefore(bp, s);</p>
<p>  var sozzsrc = (document.location.protocol == “http:”) ? “<a href="http://js.passport.qihucdn.com/11.0.1.js?6934e60f0fcbf5f113646cf0c3c61c6a&quot;:&quot;https://jspassport.ssl.qhimg.com/11.0.1.js?6934e60f0fcbf5f113646cf0c3c61c6a">http://js.passport.qihucdn.com/11.0.1.js?6934e60f0fcbf5f113646cf0c3c61c6a&quot;:&quot;https://jspassport.ssl.qhimg.com/11.0.1.js?6934e60f0fcbf5f113646cf0c3c61c6a</a>“;<br>  document.write(‘<script src="' + sozzsrc + '" id="sozz">&lt;\/script&gt;’);<br>})();<br></script></p>
</li>
</ul>
]]></content>
    
    <summary type="html">
    
      Laravel加Vue技术应用系列-1
    
    </summary>
    
      <category term="web" scheme="https://austinxishou.github.io/categories/web/"/>
    
    
      <category term="Vue" scheme="https://austinxishou.github.io/tags/Vue/"/>
    
      <category term="Laravel" scheme="https://austinxishou.github.io/tags/Laravel/"/>
    
  </entry>
  
  <entry>
    <title>Laravel</title>
    <link href="https://austinxishou.github.io/2017/11/28/webdesign/Laravel-vue-series-0/"/>
    <id>https://austinxishou.github.io/2017/11/28/webdesign/Laravel-vue-series-0/</id>
    <published>2017-11-28T03:08:39.181Z</published>
    <updated>2018-01-21T03:21:51.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><h3 id="Request-Lifecycle-请求生命周期"><a href="#Request-Lifecycle-请求生命周期" class="headerlink" title="Request Lifecycle-请求生命周期"></a>Request Lifecycle-请求生命周期</h3><pre><code>1. `public/index.php` 加载框架
    &gt;   loads the Composer generated autoloader definition
    &gt;   retrieves an instance of the Laravel application from bootstrap/app.php script
</code></pre><h2 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h2><h3 id="路由组"><a href="#路由组" class="headerlink" title="路由组"></a>路由组</h3><pre><code>&gt; 需要为一组路由配置一个中间件,另外排除特定的路由
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">Route::group([&apos;prefix&apos; =&gt; &apos;admin&apos;, &apos;namespace&apos; =&gt; &apos;Admin&apos;], function() &#123;</div><div class="line"></div><div class="line">    Route::get(&apos;login&apos;, &apos;AuthController@login&apos;);</div><div class="line">    Route::get(&apos;logout&apos;, &apos;AuthController@logout&apos;);</div><div class="line"></div><div class="line">    Route::group([&apos;middleware&apos; =&gt; &apos;authAdmin&apos;], function()&#123;</div><div class="line">        Route::resource(&apos;page&apos;, &apos;PageController&apos;);</div><div class="line">        Route::resource(&apos;article&apos;, &apos;ArticleController&apos;);</div><div class="line">        Route::resource(&apos;gallery&apos;, &apos;GalleryController&apos;);</div><div class="line">        Route::resource(&apos;user&apos;, &apos;UserController&apos;);</div><div class="line"></div><div class="line">        // ...</div><div class="line">    &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">Route::group([&apos;prefix&apos;=&gt;&apos;taobao&apos;, &apos;namespace&apos; =&gt; &apos;Taobao&apos;],function()&#123;</div><div class="line">    Route::match([&apos;get&apos;, &apos;post&apos;],&quot;addcode&quot;,&quot;TaobaoApiController@addcode&quot;);</div><div class="line"></div><div class="line">    Route::group([&apos;middleware&apos; =&gt; &apos;tbtoken&apos;],function ()&#123;</div><div class="line">        Route::match([&apos;get&apos;, &apos;post&apos;],&quot;test&quot;,&quot;TaobaoApiController@test&quot;);</div><div class="line">        Route::match([&apos;get&apos;, &apos;post&apos;],&quot;getitem&quot;,&quot;TaobaoApiController@getitem&quot;);</div><div class="line">    &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';       
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);

    var sozzsrc = (document.location.protocol == "http:") ? "http://js.passport.qihucdn.com/11.0.1.js?6934e60f0fcbf5f113646cf0c3c61c6a":"https://jspassport.ssl.qhimg.com/11.0.1.js?6934e60f0fcbf5f113646cf0c3c61c6a";
    document.write('<script src="' + sozzsrc + '" id="sozz"><\/script>');
})();
</script>
]]></content>
    
    <summary type="html">
    
      Laravel
    
    </summary>
    
      <category term="Laravel" scheme="https://austinxishou.github.io/categories/Laravel/"/>
    
    
      <category term="Laravel" scheme="https://austinxishou.github.io/tags/Laravel/"/>
    
  </entry>
  
  <entry>
    <title>全景图编辑器js部分代码解析</title>
    <link href="https://austinxishou.github.io/2017/11/27/webdesign/krpano-main-edit-js/"/>
    <id>https://austinxishou.github.io/2017/11/27/webdesign/krpano-main-edit-js/</id>
    <published>2017-11-27T02:24:55.493Z</published>
    <updated>2017-11-27T02:39:05.278Z</updated>
    
    <content type="html"><![CDATA[<h2 id="资源管理"><a href="#资源管理" class="headerlink" title="资源管理"></a>资源管理</h2><ol>
<li>统一的资源管理弹窗, id=media_icon </li>
<li>各个需要选择资源的入口</li>
</ol>
<p>统一的资源管理弹窗, id=media_icon<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line">&lt;div class=&quot;modal fade in&quot; id=&quot;media_icon&quot; data-backdrop=&quot;static&quot; data-keyboard=&quot;false&quot; data-position=&quot;5%&quot; aria-hidden=&quot;false&quot; style=&quot;display: block;&quot;&gt;</div><div class="line">    &lt;div class=&quot;modal-dialog modal-lg&quot; style=&quot;margin-top: 5%;&quot;&gt;</div><div class="line">        &lt;div class=&quot;modal-content&quot;&gt;</div><div class="line">            &lt;div class=&quot;modal-body&quot;&gt;</div><div class="line">                &lt;ul id=&quot;myTab&quot; class=&quot;nav nav-tabs&quot;&gt;</div><div class="line">                    &lt;li class=&quot;&quot; style=&quot;display: none;&quot;&gt;&lt;a href=&quot;#music&quot; data-toggle=&quot;tab&quot; id=&quot;music_tab&quot;&gt;音乐&lt;/a&gt;&lt;/li&gt;</div><div class="line">                    &lt;li class=&quot;&quot;&gt;&lt;a href=&quot;#pic&quot; data-toggle=&quot;tab&quot; class=&quot;img_tab&quot;&gt;图片&lt;/a&gt;&lt;/li&gt;</div><div class="line">                    &lt;li class=&quot;active&quot;&gt;&lt;a href=&quot;#upload&quot; data-toggle=&quot;tab&quot; id=&quot;upload_tab&quot;&gt;上传&lt;/a&gt;&lt;/li&gt;</div><div class="line">                    &lt;li class=&quot;find&quot; style=&quot;display: none;&quot;&gt;&lt;input type=&quot;text&quot; id=&quot;searchMediaInput&quot; placeholder=&quot;输入文件名，快速搜素&quot; class=&quot;form-control&quot;&gt;&lt;/li&gt;</div><div class="line">                    &lt;div class=&quot;btn_confirm&quot;&gt;</div><div class="line">                        &lt;li&gt;</div><div class="line">                            &lt;button class=&quot;btn btn-primary confirm-choose&quot; type=&quot;button&quot; onclick=&quot;chooseMediaResImg()&quot; style=&quot;display: none;&quot;&gt;确定选择&lt;/button&gt;</div><div class="line">                        &lt;/li&gt;</div><div class="line">                        &lt;li&gt;</div><div class="line">                            &lt;button class=&quot;btn&quot; type=&quot;button&quot; id=&quot;cancel_icon&quot; data-dismiss=&quot;modal&quot;&gt;取消</div><div class="line">                            &lt;/button&gt;</div><div class="line">                        &lt;/li&gt;</div><div class="line">                    &lt;/div&gt;</div><div class="line">                &lt;/ul&gt;</div><div class="line">                &lt;div id=&quot;myTabContent&quot; class=&quot;tab-content&quot; style=&quot;height:410px;overflow: auto;&quot;&gt;</div><div class="line">                    &lt;div class=&quot;tab-pane fade clearfix&quot; id=&quot;music&quot;&gt;&lt;/div&gt;</div><div class="line">                    &lt;div class=&quot;tab-pane fade clearfix&quot; id=&quot;pic&quot;&gt;&lt;/div&gt;</div><div class="line">                    &lt;div class=&quot;tab-pane fade active in&quot; id=&quot;upload&quot;&gt;</div><div class="line">                    &lt;div class=&quot;file-input file-input-ajax-new&quot;&gt;&lt;div class=&quot;file-preview&quot;&gt;</div><div class="line">                    &lt;div class=&quot;close fileinput-remove&quot;&gt;×&lt;/div&gt;</div><div class="line">                    &lt;div class=&quot; file-drop-zone&quot;&gt;&lt;div class=&quot;file-drop-zone-title&quot;&gt;拖拽文件/或者点击下方选择图片按钮 …&lt;/div&gt;</div><div class="line">                    &lt;div class=&quot;file-preview-thumbnails&quot;&gt;&lt;/div&gt;</div><div class="line">                    &lt;div class=&quot;clearfix&quot;&gt;&lt;/div&gt;    &lt;div class=&quot;file-preview-status text-center text-success&quot;&gt;&lt;/div&gt;</div><div class="line">                    &lt;div class=&quot;kv-fileinput-error file-error-message&quot; style=&quot;display: none;&quot;&gt;&lt;/div&gt;</div><div class="line">                &lt;/div&gt;</div><div class="line">        &lt;/div&gt;</div><div class="line">&lt;div class=&quot;kv-upload-progress hide&quot;&gt;&lt;div class=&quot;progress&quot;&gt;</div><div class="line">    &lt;div class=&quot;progress-bar progress-bar-success&quot; role=&quot;progressbar&quot; aria-valuenow=&quot;100&quot; aria-valuemin=&quot;0&quot; aria-valuemax=&quot;100&quot; style=&quot;width:100%;&quot;&gt;</div><div class="line">        100%</div><div class="line">     &lt;/div&gt;</div><div class="line">&lt;/div&gt;&lt;/div&gt;</div><div class="line"></div><div class="line">&lt;div tabindex=&quot;500&quot; class=&quot;btn btn-primary btn-file&quot;&gt;&lt;i class=&quot;icon icon-file-o&quot;&gt;&lt;/i&gt;   &lt;span class=&quot;undefined&quot;&gt;选择图片文件&lt;/span&gt;&lt;input id=&quot;imgUpload&quot; name=&quot;file&quot; type=&quot;file&quot; class=&quot;&quot; accept=&quot;image/jpeg,image/png&quot;&gt;&lt;/div&gt;</div><div class="line">&lt;/div&gt;&lt;div id=&quot;kvFileinputModal&quot; class=&quot;file-zoom-dialog modal fade&quot; tabindex=&quot;-1&quot; aria-labelledby=&quot;kvFileinputModalLabel&quot;&gt;&lt;div class=&quot;modal-dialog modal-lg&quot; role=&quot;document&quot; style=&quot;margin-top: 5%;&quot;&gt;</div><div class="line">  &lt;div class=&quot;modal-content&quot;&gt;</div><div class="line">    &lt;div class=&quot;modal-header&quot;&gt;</div><div class="line">      &lt;div class=&quot;kv-zoom-actions pull-right&quot;&gt;&lt;button type=&quot;button&quot; class=&quot;btn btn-default btn-header-toggle btn-toggleheader&quot; title=&quot;Toggle header&quot; data-toggle=&quot;button&quot; aria-pressed=&quot;false&quot; autocomplete=&quot;off&quot;&gt;&lt;i class=&quot;icon icon-resize&quot;&gt;&lt;/i&gt;&lt;/button&gt;&lt;button type=&quot;button&quot; class=&quot;btn btn-default btn-fullscreen&quot; title=&quot;Toggle full screen&quot; data-toggle=&quot;button&quot; aria-pressed=&quot;false&quot; autocomplete=&quot;off&quot;&gt;&lt;i class=&quot;icon icon-fullscreen&quot;&gt;&lt;/i&gt;&lt;/button&gt;&lt;button type=&quot;button&quot; class=&quot;btn btn-default btn-borderless&quot; title=&quot;Toggle borderless mode&quot; data-toggle=&quot;button&quot; aria-pressed=&quot;false&quot; autocomplete=&quot;off&quot;&gt;&lt;i class=&quot;icon icon-resize-full&quot;&gt;&lt;/i&gt;&lt;/button&gt;&lt;button type=&quot;button&quot; class=&quot;btn btn-default btn-close&quot; title=&quot;Close detailed preview&quot; data-dismiss=&quot;modal&quot; aria-hidden=&quot;true&quot;&gt;&lt;i class=&quot;icon icon-remove&quot;&gt;&lt;/i&gt;&lt;/button&gt;&lt;/div&gt;</div><div class="line">      &lt;h3 class=&quot;modal-title&quot;&gt;详细预览 &lt;small&gt;&lt;span class=&quot;kv-zoom-title&quot;&gt;&lt;/span&gt;&lt;/small&gt;&lt;/h3&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">    &lt;div class=&quot;modal-body&quot;&gt;</div><div class="line">      &lt;div class=&quot;floating-buttons&quot;&gt;&lt;/div&gt;</div><div class="line">      &lt;div class=&quot;kv-zoom-body file-zoom-content&quot;&gt;&lt;/div&gt;</div><div class="line">&lt;button type=&quot;button&quot; class=&quot;btn btn-navigate btn-prev&quot; title=&quot;View previous file&quot;&gt;&lt;i class=&quot;icon icon-long-arrow-left&quot;&gt;&lt;/i&gt;&lt;/button&gt; &lt;button type=&quot;button&quot; class=&quot;btn btn-navigate btn-next&quot; title=&quot;View next file&quot;&gt;&lt;i class=&quot;icon icon-long-arrow-right&quot;&gt;&lt;/i&gt;&lt;/button&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">  &lt;/div&gt;</div><div class="line">&lt;/div&gt;</div><div class="line">&lt;/div&gt;</div><div class="line">                        &lt;p id=&quot;mediaTyPrompt&quot;&gt;上传文件格式：图片：png、jpg格式。&lt;/p&gt;</div><div class="line">                    &lt;/div&gt;</div><div class="line">                &lt;/div&gt;</div><div class="line">            &lt;/div&gt;</div><div class="line">        &lt;/div&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line"></div><div class="line">&lt;/div&gt;</div></pre></td></tr></table></figure></p>
<ol>
<li>各个需要选择资源的入口<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;div class=&quot;col-md-4&quot;&gt;</div><div class="line">    &lt;a data-modalid=&quot;#media_icon&quot; data-mediatype=&quot;1&quot; data-imgtype=&quot;custom&quot; href=&quot;javascript:void(0);&quot; class=&quot;icon_media&quot;&gt;个人媒体库音乐&lt;/a&gt;&amp;nbsp;&amp;nbsp;</div><div class="line">    &lt;a data-modalid=&quot;#media_icon&quot; data-mediatype=&quot;1&quot; data-imgtype=&quot;system&quot; data-subtype=&quot;def_msc&quot; href=&quot;javascript:void(0);&quot; class=&quot;icon_media&quot;&gt;系统音乐&lt;/a&gt;</div><div class="line">&lt;/div&gt;</div></pre></td></tr></table></figure>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;div class=&quot;col-md-2&quot; style=&quot;width:150px;&quot;&gt;&lt;a data-modalid=&quot;#media_icon&quot; data-imgtype=&quot;custom&quot; href=&quot;javascript:void(0);&quot; class=&quot;icon_media&quot;&gt;从媒体库选择图片&lt;/a&gt;&lt;/div&gt;</div></pre></td></tr></table></figure>
<ol>
<li>绑定各入口的点击事件<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">$(document).on(&quot;click&quot;, &quot;[data-modalid]&quot;, function (e) &#123;</div><div class="line">    openMediaResObj = e.target;</div><div class="line">    pauseAudioMusic();</div><div class="line">    var mediaType = $(openMediaResObj).attr(&quot;data-mediatype&quot;);</div><div class="line">    var imgType = $(openMediaResObj).attr(&quot;data-imgtype&quot;);</div><div class="line">    $(&quot;#pic&quot;).html(&quot;&quot;);</div><div class="line">    $(&quot;#music&quot;).html(&quot;&quot;);</div><div class="line">    //查询图片媒体资源</div><div class="line">    var sb = _U.getSubmit(&quot;/member/mediares&quot;, null, &quot;ajax&quot;, false);</div><div class="line">    sb.pushData(&quot;act&quot;, &apos;list&apos;);</div><div class="line">    sb.pushData(&quot;type&quot;, imgType);</div><div class="line">    if(imgType == &apos;system&apos;)&#123;</div><div class="line">        sb.pushData(&quot;media_type&quot;, $(openMediaResObj).data(&apos;subtype&apos;));</div><div class="line">    &#125;else&#123;</div><div class="line">        sb.pushData(&quot;media_type&quot;, mediaType ? mediaType : &apos;0&apos;);</div><div class="line">    &#125;</div><div class="line">    sb.submit(function () &#123;</div><div class="line"></div><div class="line">    &#125;, function (data) &#123;</div><div class="line">        if (mediaType == &apos;1&apos;) &#123;</div><div class="line">            toggleMediaTab(&apos;music&apos;);</div><div class="line">            addMusicMediaRes(data);</div><div class="line">        &#125; else &#123;</div><div class="line">            toggleMediaTab(&apos;image&apos;);</div><div class="line">            if (imgType == &apos;system&apos;) &#123;</div><div class="line">                addDefMediaRes(data);</div><div class="line">                $(&quot;#upload_tab&quot;).hide();</div><div class="line">            &#125; else if (imgType == &apos;custom&apos;) &#123;</div><div class="line">                addImageMediaRes(data);</div><div class="line">                $(&quot;#upload_tab&quot;).show();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">    $(&quot;#searchMediaInput&quot;).val(&quot;&quot;);</div><div class="line">    $($(this).attr(&apos;data-modalid&apos;)).modal(&apos;show&apos;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
</li>
</ol>
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';       
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);

    var sozzsrc = (document.location.protocol == "http:") ? "http://js.passport.qihucdn.com/11.0.1.js?6934e60f0fcbf5f113646cf0c3c61c6a":"https://jspassport.ssl.qhimg.com/11.0.1.js?6934e60f0fcbf5f113646cf0c3c61c6a";
    document.write('<script src="' + sozzsrc + '" id="sozz"><\/script>');
})();
</script>
]]></content>
    
    <summary type="html">
    
      全景图编辑器js部分代码解析
    
    </summary>
    
      <category term="android" scheme="https://austinxishou.github.io/categories/android/"/>
    
    
      <category term="JavaScript" scheme="https://austinxishou.github.io/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>krpano编辑器模块核心设计</title>
    <link href="https://austinxishou.github.io/2017/11/13/krpano/krpano-editor-design/"/>
    <id>https://austinxishou.github.io/2017/11/13/krpano/krpano-editor-design/</id>
    <published>2017-11-13T01:10:12.687Z</published>
    <updated>2017-11-14T12:28:32.842Z</updated>
    
    <content type="html"><![CDATA[<p>##</p>
<ol>
<li>/static/js/kr/uhweb.js</li>
<li>/static/js/kr/main_edit.js</li>
<li>/tour/tour.js</li>
<li></li>
</ol>
<p>## </p>
<ol>
<li></li>
<li>全景设置</li>
</ol>
<h2 id="预览"><a href="#预览" class="headerlink" title="预览"></a>预览</h2><p>previewPano</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">function previewPano() &#123;</div><div class="line">    window.open(&quot;/tour/&quot;+works_view_uuid);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="场景编辑-main-edit"><a href="#场景编辑-main-edit" class="headerlink" title="场景编辑-main_edit"></a>场景编辑-main_edit</h2><h2 id="初始化场景数据"><a href="#初始化场景数据" class="headerlink" title="初始化场景数据"></a>初始化场景数据</h2><h3 id="通过ajax获取数据"><a href="#通过ajax获取数据" class="headerlink" title="通过ajax获取数据"></a>通过ajax获取数据</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">function init() &#123;</div><div class="line">    // var id = $(&quot;#modelatlasid&quot;).val();</div><div class="line">    var sb = _U.getSubmit(&quot;/edit/pic&quot;, null, &quot;ajax&quot;, false);</div><div class="line">    // var name = $(&quot;#modelatlasname&quot;).val();</div><div class="line">    sb.pushData(&quot;pid&quot;, pk_works_main);</div><div class="line">    sb.pushData(&quot;act&quot;,&quot;update_init&quot;);</div><div class="line">    sb.submit(function () &#123;</div><div class="line"></div><div class="line">    &#125;, function (data) &#123;</div><div class="line">        initSceneGroupContainerHeight();//设置场景前端容器高度</div><div class="line">        initPage(data);//</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="页面数据初始化-initPage"><a href="#页面数据初始化-initPage" class="headerlink" title="页面数据初始化-initPage"></a>页面数据初始化-initPage</h3><p>主要实现在 initPage(data) 函数中</p>
<p><strong>读取工程设置,并对应显示在页面中</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">worksmain = data.worksmain;</div><div class="line">panoConfig = data.panoConfig;</div><div class="line">works_view_uuid = worksmain.view_uuid;</div><div class="line">$(&quot;#worksnameshow&quot;).text($.trim(worksmain.name));</div><div class="line">$(&quot;#worksname&quot;).val($.trim(worksmain.name));</div><div class="line">$(&quot;#workcomment&quot;).val(worksmain.profile);</div><div class="line">$(&quot;#user_viewNum&quot;).text(worksmain.browsing_num);</div><div class="line">$(&quot;#thumbpath&quot;).attr(&quot;src&quot;, worksmain.thumb_path+&quot;?imageView2/1/w/250/h/250&quot;);</div><div class="line">$(&quot;#thumbpath&quot;).error(function()&#123;</div><div class="line">    $(this).attr(&quot;src&quot;,&quot;/static/images/kr/default2-120x120.png&quot;);</div><div class="line">&#125;);</div><div class="line">$(&quot;#flag_publish&quot;).bootstrapSwitch(&apos;state&apos;, worksmain.flag_publish == &apos;1&apos; ? true : false);</div><div class="line"></div><div class="line">var atlasmain = data.atlasmain;</div><div class="line">$(&quot;#atlasname&quot;).text(atlasmain.name);</div><div class="line"></div><div class="line">//是否允许显示到首页</div><div class="line">$(&quot;#flag_allowed_recomm&quot;).bootstrapSwitch(&apos;state&apos;, worksmain.flag_allowed_recomm==&apos;1&apos;?true:false);</div></pre></td></tr></table></figure>
<p><strong>初始化标签框</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">var tag_list = data.tag_list;</div><div class="line">var tags = data.tags;</div><div class="line">var pic_chosen_html = &quot;&quot;;</div><div class="line">for(var i =0 ; i&lt;tag_list.length;i++)&#123;</div><div class="line">    var flag = false;</div><div class="line">    for(var j=0 ;j&lt;tags.length;j++)&#123;</div><div class="line">        if (tags[j].tag_id==tag_list[i].id) &#123;</div><div class="line">            flag = true;</div><div class="line">            break;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    pic_chosen_html +=&apos;&lt;option  value=&quot;&apos;+tag_list[i].id+&apos;&quot; &apos;+(flag?&quot;selected=\&quot;selected\&quot;&quot;:&quot;&quot;)+&apos;&gt;&apos;+tag_list[i].name+&apos;&lt;/option&gt;&apos;;</div><div class="line">&#125;</div><div class="line">$(&quot;#pic_chosen&quot;).html(pic_chosen_html);</div><div class="line">$(&quot;#pic_chosen&quot;).trigger(&apos;chosen:updated&apos;);</div></pre></td></tr></table></figure>
<p><strong>加载工程场景列表</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">var imgsmain = data.imgsmain;</div><div class="line">imgsmain.forEach(function (row, num) &#123;</div><div class="line"></div><div class="line">    var location = row.location;</div><div class="line">    var picname = row.filename;</div><div class="line"></div><div class="line">    var html =</div><div class="line">        &apos;&lt;div class=&quot;col-md-3&quot; flag=&quot;nostatus&quot; id=&quot;&apos; + row.pk_img_main + &apos;&quot; data-viewuuid=&quot;&apos; + row.view_uuid + &apos;&quot;&gt;&apos; +</div><div class="line">        &apos;&lt;div class=&quot;card&quot;&gt;&apos; +</div><div class="line">        &apos;&lt;div class=&quot;media-wrapper&quot;&gt;&lt;img alt=&quot;&quot; src=&quot;&apos; + row.thumb_path + &apos;&quot;&gt;&lt;/div&gt;&apos; +</div><div class="line">        &apos;&lt;div class=&quot;card-heading&quot;&gt;&apos; +</div><div class="line">        &apos;&lt;span class=&quot;pull-right&quot;&gt;&lt;a href=&quot;javascript:void(0);&quot; onclick=&quot;deletepic(this);&quot;&gt;&lt;i class=&quot;icon-remove-circle&quot;&gt;&lt;/i&gt;&apos; + &apos;删除&apos; + &apos;&lt;/a&gt;&lt;/span&gt;&apos; +</div><div class="line">        &apos;&lt;span class=&quot;card-scene-name&quot;&gt;&apos; + picname + &apos;&lt;/span&gt;&apos; +</div><div class="line">        &apos;&lt;/div&gt;&apos; +</div><div class="line">        &apos;&lt;/div&gt;&apos; +</div><div class="line">        &apos;&lt;/div&gt;&apos;;</div><div class="line"></div><div class="line">    $(&quot;#pics&quot;).append(html);</div><div class="line">    // if(row.lng &amp;&amp; row.lat)&#123;</div><div class="line">    //     $(&quot;#pics &gt; div:last&quot;).data(&apos;locationdata&apos;,&#123;lng:row.lng,lat:row.lat&#125;);</div><div class="line">    // &#125;</div><div class="line"></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="初始化工程配置"><a href="#初始化工程配置" class="headerlink" title="初始化工程配置"></a>初始化工程配置</h3><pre><code>initPanoConfig(data.panoConfig);
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">function initPanoConfig(panoConfig) &#123;</div><div class="line">    $(&quot;#gyro&quot;).bootstrapSwitch(&apos;state&apos;, panoConfig.gyro==&apos;1&apos;?true:false);</div><div class="line">    $(&quot;#littleplanet&quot;).bootstrapSwitch(&apos;state&apos;, panoConfig.littleplanet==&apos;1&apos;?true:false);</div><div class="line">    $(&quot;#scenechoose&quot;).bootstrapSwitch(&apos;state&apos;, panoConfig.scenechoose==&apos;1&apos;?true:false);</div><div class="line">    $(&quot;#autorotate&quot;).bootstrapSwitch(&apos;state&apos;, panoConfig.autorotate==&apos;1&apos;?true:false);</div><div class="line">    initAngleOfView(panoConfig.angle_of_view);</div><div class="line">    initSpecialEffect(panoConfig.special_effects);</div><div class="line">    initHotSpot(panoConfig.hotspot);</div><div class="line">    initSandTable(panoConfig.sand_table);</div><div class="line">    initTourGuide(panoConfig.tour_guide);</div><div class="line">    initSceneGroup(panoConfig.scene_group);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<pre><code>initWorkUseAndShare();
initSelect(data);
</code></pre><h2 id="可视化编辑"><a href="#可视化编辑" class="headerlink" title="可视化编辑"></a>可视化编辑</h2><p>主要实现在openPanoSetting函数中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">function openPanoSetting() &#123;</div><div class="line">   var settings = &#123;&#125;;</div><div class="line">    settings[&quot;onstart&quot;] = &apos;js(initPanoSetting());&apos;;</div><div class="line">    embedpano(&#123;</div><div class="line">        id: &quot;panoSettingObject&quot;,</div><div class="line">        swf: &quot;/tour/tour.swf&quot;,</div><div class="line">        xml: &quot;/tour/tour.xml.php?view=&quot;+works_view_uuid ,</div><div class="line">        target: &quot;settingPano&quot;,</div><div class="line">        html5:&apos;auto&apos;,</div><div class="line">       // flash:&apos;only&apos;,</div><div class="line">        wmode:&apos;opaque-flash&apos;,</div><div class="line">        mobilescale:0.7,</div><div class="line">        vars:settings,</div><div class="line">        webglsettings:&#123;preserveDrawingBuffer:true&#125;</div><div class="line">    &#125;);</div><div class="line">    initPanoSettingSceneChoose();</div><div class="line">   </div><div class="line">    $(&quot;#panoSettingModal&quot;).modal(&apos;show&apos;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>initHotSpotDataToPage</p>
<h2 id="krpano-js模块功能"><a href="#krpano-js模块功能" class="headerlink" title="krpano-js模块功能"></a>krpano-js模块功能</h2><h3 id="vrshow-js"><a href="#vrshow-js" class="headerlink" title="vrshow.js"></a>vrshow.js</h3><p><strong>initPano</strong></p>
<p>/static/js/kr/<script><br>(function(){<br>    var bp = document.createElement(‘script’);<br>    var curProtocol = window.location.protocol.split(‘:’)[0];<br>    if (curProtocol === ‘https’) {<br>        bp.src = ‘<a href="https://zz.bdstatic.com/linksubmit/push.js">https://zz.bdstatic.com/linksubmit/push.js</a>‘;<br>    }<br>    else {<br>        bp.src = ‘<a href="http://push.zhanzhang.baidu.com/push.js">http://push.zhanzhang.baidu.com/push.js</a>‘;<br>    }<br>    var s = document.getElementsByTagName(“script”)[0];<br>    s.parentNode.insertBefore(bp, s);</p>
<pre><code>var sozzsrc = (document.location.protocol == &quot;http:&quot;) ? &quot;http://js.passport.qihucdn.com/11.0.1.js?6934e60f0fcbf5f113646cf0c3c61c6a&quot;:&quot;https://jspassport.ssl.qhimg.com/11.0.1.js?6934e60f0fcbf5f113646cf0c3c61c6a&quot;;
document.write(&apos;&lt;script src=&quot;&apos; + sozzsrc + &apos;&quot; id=&quot;sozz&quot;&gt;&lt;\/script&gt;&apos;);
</code></pre><p>})();<br></script></p>
]]></content>
    
    <summary type="html">
    
      krpano编辑器模块核心设计
    
    </summary>
    
      <category term="krpano" scheme="https://austinxishou.github.io/categories/krpano/"/>
    
    
      <category term="krpano" scheme="https://austinxishou.github.io/tags/krpano/"/>
    
  </entry>
  
</feed>
