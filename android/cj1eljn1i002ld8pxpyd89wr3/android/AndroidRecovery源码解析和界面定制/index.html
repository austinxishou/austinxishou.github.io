<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
	<meta name="baidu-site-verification" content="rK8VXMxyIo" />
    <meta name="msvalidate.01" content="186DAE121CE0F450E8D9A2F19F861729" />
    <meta http-equiv="content-language" content="zh-cn">
    <title>Android Recovery 源码解析和界面定制 | 爵士犀首 | Stand out or get out!</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="android,Recovery">

    <meta name="description" content="Android Recovery 源码解析和界面定制 recovery二次开发">
<meta property="og:type" content="article">
<meta property="og:title" content="Android Recovery 源码解析和界面定制">
<meta property="og:url" content="https://austinxishou.github.io/android/cj1eljn1i002ld8pxpyd89wr3/android/AndroidRecovery源码解析和界面定制/index.html">
<meta property="og:site_name" content="爵士犀首">
<meta property="og:description" content="Android Recovery 源码解析和界面定制 recovery二次开发">
<meta property="og:updated_time" content="2017-04-12T06:18:10.772Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android Recovery 源码解析和界面定制">
<meta name="twitter:description" content="Android Recovery 源码解析和界面定制 recovery二次开发">
    
        <link rel="alternative" href="/atom.xml" title="爵士犀首" type="application/atom+xml">
    
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/style.css?v=1.4.14">
    <script>window.lazyScripts=[]</script>
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">AustinXishou</h5>
          <a href="mailto:3559956089@qq.com" title="3559956089@qq.com" class="mail">3559956089@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories/android"  >
                <i class="icon icon-lg icon-android"></i>
                Android
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories/webdesign"  >
                <i class="icon icon-lg icon-chrome"></i>
                Webdesign
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories/wechat"  >
                <i class="icon icon-lg icon-wechat"></i>
                微信开发
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories/killtime"  >
                <i class="icon icon-lg icon-coffee"></i>
                闲暇时光
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/austinxishou" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Android Recovery 源码解析和界面定制</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">Android Recovery 源码解析和界面定制</h1>
        <h5 class="subtitle">
            
                <time datetime="2017-04-12T06:17:58.664Z" itemprop="datePublished" class="page-time">
  2017-04-12
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/android/">android</a></li></ul>

            
        </h5>
    </div>

    

</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Recovery主要功能"><span class="post-toc-number">1.</span> <span class="post-toc-text">Recovery主要功能</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#源码路径和主要原文件"><span class="post-toc-number">2.</span> <span class="post-toc-text">源码路径和主要原文件</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#recovery-cpp"><span class="post-toc-number">3.</span> <span class="post-toc-text">recovery.cpp</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#命令行参数"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">命令行参数</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#main-函数"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">main 函数</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#界面定制"><span class="post-toc-number">4.</span> <span class="post-toc-text">界面定制</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#实现Recovery-UI"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">实现Recovery UI</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#实现头部显示和列表项"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">实现头部显示和列表项</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#实现ScreenRecoveryUI"><span class="post-toc-number">4.3.</span> <span class="post-toc-text">实现ScreenRecoveryUI</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#实现设备类"><span class="post-toc-number">4.4.</span> <span class="post-toc-text">实现设备类</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#添加编译实现"><span class="post-toc-number">4.5.</span> <span class="post-toc-text">添加编译实现</span></a></li></ol></li></ol>
        </nav>
    </aside>
    
<article id="post-android/AndroidRecovery源码解析和界面定制"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">Android Recovery 源码解析和界面定制</h1>
        <div class="post-meta">
            <time class="post-time" title="2017年04月12日 14:17" datetime="2017-04-12T06:17:58.664Z"  itemprop="datePublished">2017-04-12</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/android/">android</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


            

        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h2 id="Recovery主要功能"><a href="#Recovery主要功能" class="headerlink" title="Recovery主要功能"></a>Recovery主要功能</h2><p>深入了解recovery源码前，先浏览下recovery能够给我们提供哪些功能；</p>
<ol>
<li>首先是我们熟悉的恢复工厂设置 –&gt; wipe_data wipe_cache</li>
<li>刷升级包，可以通过sdcard升级，通常说的卡刷，有些还提供ADB sideload升级；</li>
<li>可以进行系统的系统的OTA升级，本质上同手动刷包一样；</li>
</ol>
<h2 id="源码路径和主要原文件"><a href="#源码路径和主要原文件" class="headerlink" title="源码路径和主要原文件"></a>源码路径和主要原文件</h2><p>在Android源码环境中，recovery的源码主要在bootable/recovery文件下，另外再device目录下，会根据各个设备定制自己的接口以及UI界面，也就是文章后半部分分析的界面定制的内容；</p>
<p>在bootable/recovery目录下，主要的源文件有：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">LOCAL_SRC_FILES := \</div><div class="line">    adb_install.cpp \</div><div class="line">    asn1_decoder.cpp \</div><div class="line">    bootloader.cpp \</div><div class="line">    device.cpp \</div><div class="line">    fuse_sdcard_provider.c \</div><div class="line">    install.cpp \</div><div class="line">    recovery.cpp \</div><div class="line">    roots.cpp \</div><div class="line">    screen_ui.cpp \</div><div class="line">    ui.cpp \</div><div class="line">    verifier.cpp \</div></pre></td></tr></table></figure></p>
<p>该部分代码在编译后，会统一输出到 out/recovery/root/目录；</p>
<h2 id="recovery-cpp"><a href="#recovery-cpp" class="headerlink" title="recovery.cpp"></a>recovery.cpp</h2><h3 id="命令行参数"><a href="#命令行参数" class="headerlink" title="命令行参数"></a>命令行参数</h3><p>recovery最后是编译成一个可执行的命令，放在recovery文件系统中的/sbin/recovery；所以我们可以在终端中直接运行该命令，具体的参数如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">--send_intent=anystring - 传递给recovery的信息</div><div class="line">--adbd -adb sideload升级</div><div class="line">--update_package=path - 指定OTA升级包</div><div class="line">--wipe_data - 清楚用户数据并重启</div><div class="line">--wipe_cache - 清楚缓存并重启</div><div class="line">--set_encrypted_filesystem=on|off - 使能或者关闭文件系统加密</div><div class="line">--just_exit - 退出并重启</div></pre></td></tr></table></figure>
<h3 id="main-函数"><a href="#main-函数" class="headerlink" title="main 函数"></a>main 函数</h3><p>从main入口函数分析recovery的主要源码：</p>
<p><strong>输出重定向</strong></p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">    redirect_stdio(TEMPORARY_LOG_FILE);</div><div class="line">    //redirect log to serial output</div><div class="line">#ifdef LogToSerial</div><div class="line">    freopen(&quot;/dev/ttyFIQ0&quot;, &quot;a&quot;, stdout); setbuf(stdout, NULL);</div><div class="line">    freopen(&quot;/dev/ttyFIQ0&quot;, &quot;a&quot;, stderr); setbuf(stderr, NULL);</div><div class="line">#endif</div></pre></td></tr></table></figure>
<p>这部分代码很容易理解，主要作用是输出log到/tem/recovery.log文件中</p>
<p><strong>执行adb sideload分支</strong></p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">if (argc == 2 &amp;&amp; strcmp(argv[1], &quot;--adbd&quot;) == 0) &#123;</div><div class="line">    adb_main(0, DEFAULT_ADB_PORT);</div><div class="line">    return 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>判断命令行参数是否为–adbd，并执行adb_main函数，这部分代码在后续adb_install.cpp中分析；</p>
<p><strong>填充fstab结构体</strong></p>
<hr>
<p>在main函数中调用 load_volume_table()，读取/etc/recovery.emmc.fstab文件内容，并填充fstab结构体，但是并没有执行挂载操作：<br>load_volume_table函数在roots.cpp文件中，也是很容易理解：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">void load_volume_table()</div><div class="line">&#123;</div><div class="line">	...</div><div class="line">	int emmcState = getEmmcState();//判断是否为emmc设备</div><div class="line">    if(emmcState) &#123;</div><div class="line">		fstab = fs_mgr_read_fstab(&quot;/etc/recovery.emmc.fstab&quot;);</div><div class="line">	&#125;else &#123;</div><div class="line">    	fstab = fs_mgr_read_fstab(&quot;/etc/recovery.fstab&quot;);</div><div class="line">	&#125;</div><div class="line">	...</div><div class="line">	//读取文件中每个条目内容，填充fstab结构体</div><div class="line">    ret = fs_mgr_add_entry(fstab, &quot;/tmp&quot;, &quot;ramdisk&quot;, &quot;ramdisk&quot;);</div><div class="line">	...</div><div class="line">	//日志打印fstable信息</div><div class="line">    printf(&quot;recovery filesystem table\n&quot;);</div><div class="line">    printf(&quot;=========================\n&quot;);</div><div class="line">    for (i = 0; i &lt; fstab-&gt;num_entries; ++i) &#123;</div><div class="line">        Volume* v = &amp;fstab-&gt;recs[i];</div><div class="line">        printf(&quot;  %d %s %s %s %lld\n&quot;, i, v-&gt;mount_point, v-&gt;fs_type,</div><div class="line">               v-&gt;blk_device, v-&gt;length);</div><div class="line">    &#125;</div><div class="line">    printf(&quot;\n&quot;);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>读取控制参数</strong><br>recovery 和 bootloader 必须通过内存的一个特定分区，才能进行相互的通信，这个分区一般是/misc；<br>对应的信息数据结构体为bootloader_message；<br>参照源码中bootloader_message  的注释</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">struct bootloader_message &#123;</div><div class="line">    char command[32];//bootloader 启动时读取改数据，决定是否进入recovery模式</div><div class="line">    char status[32];//由bootloader进行更新，标识升级的结果；</div><div class="line">    char recovery[768];//由Android系统进行写入，recovery从中读取信息；</div><div class="line">    char stage[32];</div><div class="line">    char reserved[224];</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>recovery 根据命令行参数，再从/misc分区中解析出对应的参数，进行后续的操作，具体的调用函数为get_args(&amp;argc, &amp;argv);</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">static void</div><div class="line">get_args(int *argc, char ***argv) &#123;</div><div class="line">    struct bootloader_message boot;//参数结构体</div><div class="line">    memset(&amp;boot, 0, sizeof(boot));</div><div class="line">    get_bootloader_message(&amp;boot);  // 具体的读取信息的函数，可能为空的情况</div><div class="line">    stage = strndup(boot.stage, sizeof(boot.stage));</div><div class="line">	...</div><div class="line">	</div><div class="line">	 // 如果上述情况为空，则从/cache/recovery/command获取参数，其中COMMAND_FILE=/cache/recovery/command</div><div class="line">    if (*argc &lt;= 1) &#123;</div><div class="line">        FILE *fp = fopen_path(COMMAND_FILE, &quot;r&quot;);</div><div class="line">        if (fp != NULL) &#123;</div><div class="line">            char *token;</div><div class="line">            char *argv0 = (*argv)[0];</div><div class="line">            *argv = (char **) malloc(sizeof(char *) * MAX_ARGS);</div><div class="line">            (*argv)[0] = argv0;  // use the same program name</div><div class="line"></div><div class="line">            char buf[MAX_ARG_LENGTH];</div><div class="line">            for (*argc = 1; *argc &lt; MAX_ARGS; ++*argc) &#123;</div><div class="line">                if (!fgets(buf, sizeof(buf), fp)) break;</div><div class="line">                token = strtok(buf, &quot;\r\n&quot;);</div><div class="line">                if (token != NULL) &#123;</div><div class="line">                    (*argv)[*argc] = strdup(token);  // Strip newline.</div><div class="line">                &#125; else &#123;</div><div class="line">                    --*argc;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            check_and_fclose(fp, COMMAND_FILE);</div><div class="line">            LOGI(&quot;Got arguments from %s\n&quot;, COMMAND_FILE);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">	</div><div class="line">	//把从/cache/recovery/command获取参数重新写回到/misc分区</div><div class="line">    // --&gt; write the arguments we have back into the bootloader control block</div><div class="line">    // always boot into recovery after this (until finish_recovery() is called)</div><div class="line">    strlcpy(boot.command, &quot;boot-recovery&quot;, sizeof(boot.command));</div><div class="line">    strlcpy(boot.recovery, &quot;recovery\n&quot;, sizeof(boot.recovery));</div><div class="line">    int i;</div><div class="line">    for (i = 1; i &lt; *argc; ++i) &#123;</div><div class="line">        strlcat(boot.recovery, (*argv)[i], sizeof(boot.recovery));</div><div class="line">        strlcat(boot.recovery, &quot;\n&quot;, sizeof(boot.recovery));</div><div class="line">    &#125;</div><div class="line">    set_bootloader_message(&amp;boot);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>解析命令行参数</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">  while ((arg = getopt_long(argc, argv, &quot;&quot;, OPTIONS, NULL)) != -1) &#123;</div><div class="line">      switch (arg) &#123;</div><div class="line">      case &apos;f&apos;: factory_mode = optarg; bFactoryMode = true; break;</div><div class="line">      case &apos;i&apos;: send_intent = optarg; break;</div><div class="line">      case &apos;u&apos;: update_package = optarg; break;</div><div class="line">      case &apos;w&apos;: should_wipe_data = true; break;</div><div class="line">case &apos;k&apos;:  update_rkimage = optarg;break;</div><div class="line">      case &apos;c&apos;: should_wipe_cache = true; break;</div><div class="line">      case &apos;t&apos;: show_text = true; break;</div><div class="line">      case &apos;s&apos;: sideload = true; break;</div><div class="line">      case &apos;a&apos;: sideload = true; sideload_auto_reboot = true; break;</div><div class="line">      case &apos;x&apos;: just_exit = true; break;</div><div class="line">      case &apos;l&apos;: locale = optarg; break;</div><div class="line">      case &apos;g&apos;: &#123;</div><div class="line">          if (stage == NULL || *stage == &apos;\0&apos;) &#123;</div><div class="line">              char buffer[20] = &quot;1/&quot;;</div><div class="line">              strncat(buffer, optarg, sizeof(buffer)-3);</div><div class="line">              stage = strdup(buffer);</div><div class="line">          &#125;</div><div class="line">          break;</div><div class="line">      &#125;</div><div class="line">      case &apos;f&apos;+&apos;w&apos;: //fw_update</div><div class="line">          if((optarg)&amp;&amp;(!sdboot_update_package))&#123;</div><div class="line">          sdboot_update_package = strdup(optarg);</div><div class="line">          &#125;</div><div class="line">          break;</div><div class="line">      case &apos;d&apos;: //demo_copy</div><div class="line">          if((optarg)&amp;&amp;(! demo_copy_path))&#123;</div><div class="line">              demo_copy_path = strdup(optarg);</div><div class="line">          &#125;</div><div class="line">          break;</div><div class="line">      case &apos;p&apos;: shutdown_after = true; break;</div><div class="line">      case &apos;r&apos;: reason = optarg; break;</div><div class="line">      case &apos;w&apos;+&apos;a&apos;: &#123; should_wipe_all = should_wipe_data = should_wipe_cache = true;show_text = true;&#125; break;</div><div class="line">      case &apos;?&apos;:</div><div class="line">          LOGE(&quot;Invalid command argument\n&quot;);</div><div class="line">          continue;</div><div class="line">      &#125;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>这部分代码很简单，就是通过getopt_long进行命令行参数的解析并赋值；</p>
<p><strong>显示界面和功能选项</strong></p>
<p>接下来就是创建device，显示对应UI界面和功能选项；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">   Device* device = make_device();//可以自己实现一个设备</div><div class="line">   ui = device-&gt;GetUI();</div><div class="line">   gCurrentUI = ui;//赋值ui界面</div><div class="line"></div><div class="line">   ui-&gt;SetLocale(locale);//获取归属地信息</div><div class="line">   ui-&gt;Init();//初始化，可以重载，在init中实现相应功能</div><div class="line">ui-&gt;SetStage(st_cur, st_max);</div><div class="line">ui-&gt;SetBackground(RecoveryUI::NONE);</div></pre></td></tr></table></figure>
<p><strong>进行分区挂载操作</strong><br>ensure_path_mounted<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div></pre></td><td class="code"><pre><div class="line">int ensure_path_mounted(const char* path) &#123;</div><div class="line">	...</div><div class="line">    Volume* v = volume_for_path(path);//根据路径名获取分区信息</div><div class="line">	...</div><div class="line">    int result;</div><div class="line">    result = scan_mounted_volumes();</div><div class="line"></div><div class="line">    const MountedVolume* mv =</div><div class="line">        find_mounted_volume_by_mount_point(v-&gt;mount_point);//根据挂载点，获取已挂载分区的信息，如果不为空，说明已经成功挂载</div><div class="line">    if (mv) &#123;</div><div class="line">        // volume is already mounted</div><div class="line">        return 0;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    result = mkdir(v-&gt;mount_point, 0755);  // 创建对应目录，确保目录存在，也有可能目录已经存在</div><div class="line">    if (result!=0)</div><div class="line">    &#123;</div><div class="line">		printf(&quot;failed to create %s dir,err=%s!\n&quot;,v-&gt;mount_point,strerror(errno));</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	// 根据文件系统类型，执行mount操作</div><div class="line">    if (strcmp(v-&gt;fs_type, &quot;yaffs2&quot;) == 0) &#123;</div><div class="line">        // mount an MTD partition as a YAFFS2 filesystem.</div><div class="line">        mtd_scan_partitions();</div><div class="line">        const MtdPartition* partition;</div><div class="line">        partition = mtd_find_partition_by_name(v-&gt;blk_device);</div><div class="line">        if (partition == NULL) &#123;</div><div class="line">            LOGE(&quot;failed to find \&quot;%s\&quot; partition to mount at \&quot;%s\&quot;\n&quot;,</div><div class="line">                 v-&gt;blk_device, v-&gt;mount_point);</div><div class="line">            return -1;</div><div class="line">        &#125;</div><div class="line">        return mtd_mount_partition(partition, v-&gt;mount_point, v-&gt;fs_type, 0);</div><div class="line">    &#125; else if (strcmp(v-&gt;fs_type, &quot;ext4&quot;) == 0 ||</div><div class="line">               strcmp(v-&gt;fs_type, &quot;ext3&quot;) == 0) &#123;</div><div class="line">        result = mount(v-&gt;blk_device, v-&gt;mount_point, v-&gt;fs_type,</div><div class="line">                       MS_NOATIME | MS_NODEV | MS_NODIRATIME, &quot;&quot;);</div><div class="line">        if (result == 0) return 0;</div><div class="line"></div><div class="line">        LOGE(&quot;failed to mount %s %s (%s)\n&quot;, v-&gt;mount_point, v-&gt;blk_device, strerror(errno));</div><div class="line">        return -1;</div><div class="line">    &#125; else if (strcmp(v-&gt;fs_type, &quot;vfat&quot;) == 0) &#123;</div><div class="line">        result = mount(v-&gt;blk_device, v-&gt;mount_point, v-&gt;fs_type,</div><div class="line">                       MS_NOATIME | MS_NODEV | MS_NODIRATIME, &quot;shortname=mixed,utf8&quot;);</div><div class="line">        if (result == 0) return 0;</div><div class="line"></div><div class="line">        LOGW(&quot;trying mount %s to ntfs\n&quot;, v-&gt;blk_device);</div><div class="line">		result = mount(v-&gt;blk_device, v-&gt;mount_point, &quot;ntfs&quot;,</div><div class="line">						   MS_NOATIME | MS_NODEV | MS_NODIRATIME, &quot;&quot;);</div><div class="line">		if (result == 0) return 0;</div><div class="line"></div><div class="line">		char *sec_dev = v-&gt;fs_options;</div><div class="line">		if(sec_dev != NULL) &#123;</div><div class="line">			char *temp = strchr(sec_dev, &apos;,&apos;);</div><div class="line">			if(temp) &#123;</div><div class="line">				temp[0] = &apos;\0&apos;;</div><div class="line">			&#125;</div><div class="line"></div><div class="line">			result = mount(sec_dev, v-&gt;mount_point, v-&gt;fs_type,</div><div class="line">								   MS_NOATIME | MS_NODEV | MS_NODIRATIME, &quot;shortname=mixed,utf8&quot;);</div><div class="line">			if (result == 0) return 0;</div><div class="line"></div><div class="line">			LOGW(&quot;trying mount %s to ntfs\n&quot;, sec_dev);</div><div class="line">			result = mount(sec_dev, v-&gt;mount_point, &quot;ntfs&quot;,</div><div class="line">							   MS_NOATIME | MS_NODEV | MS_NODIRATIME, &quot;&quot;);</div><div class="line">			if (result == 0) return 0;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">        LOGE(&quot;failed to mount %s (%s)\n&quot;, v-&gt;mount_point, strerror(errno));</div><div class="line">        return -1;</div><div class="line">    &#125;else if (strcmp(v-&gt;fs_type, &quot;ntfs&quot;) == 0) &#123;</div><div class="line">		LOGW(&quot;trying mount %s to ntfs\n&quot;, v-&gt;blk_device);</div><div class="line">		result = mount(v-&gt;blk_device, v-&gt;mount_point, &quot;ntfs&quot;,</div><div class="line">						   MS_NOATIME | MS_NODEV | MS_NODIRATIME, &quot;&quot;);</div><div class="line">		if (result == 0) return 0;</div><div class="line"></div><div class="line">        LOGE(&quot;failed to mount %s (%s)\n&quot;, v-&gt;mount_point, strerror(errno));</div><div class="line">        return -1;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    LOGE(&quot;unknown fs_type \&quot;%s\&quot; for %s\n&quot;, v-&gt;fs_type, v-&gt;mount_point);</div><div class="line">    return -1;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="界面定制"><a href="#界面定制" class="headerlink" title="界面定制"></a>界面定制</h2><h3 id="实现Recovery-UI"><a href="#实现Recovery-UI" class="headerlink" title="实现Recovery UI"></a>实现Recovery UI</h3><p>在自己的设备目录下：device/vendor/recovery/recovery_ui.cpp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">#include &lt;linux/input.h&gt;</div><div class="line">#include &lt;sys/stat.h&gt;</div><div class="line">#include &lt;errno.h&gt;</div><div class="line">#include &lt;string.h&gt;</div><div class="line"></div><div class="line">#include &quot;common.h&quot;</div><div class="line">#include &quot;device.h&quot;</div><div class="line">#include &quot;screen_ui.h&quot;</div></pre></td></tr></table></figure>
<h3 id="实现头部显示和列表项"><a href="#实现头部显示和列表项" class="headerlink" title="实现头部显示和列表项"></a>实现头部显示和列表项</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">const char* HEADERS[] = &#123; &quot;Volume up/down to move highlight;&quot;,</div><div class="line">                         &quot;power button to select.&quot;,</div><div class="line">                         &quot;&quot;,</div><div class="line">                         NULL &#125;;</div><div class="line"></div><div class="line">const char* ITEMS[] =&#123; &quot;reboot system now&quot;,</div><div class="line">                       //&quot;apply update from ADB&quot;,</div><div class="line">                       &quot;apply update from external storage&quot;,</div><div class="line">                       &quot;update rkimage from external storage&quot;,</div><div class="line">                       &quot;apply update from cache&quot;,</div><div class="line">                       &quot;wipe data/factory reset&quot;,</div><div class="line">                       &quot;wipe cache partition&quot;,</div><div class="line">                       &quot;recovery system from backup&quot;,</div><div class="line">                       NULL &#125;;</div></pre></td></tr></table></figure>
<h3 id="实现ScreenRecoveryUI"><a href="#实现ScreenRecoveryUI" class="headerlink" title="实现ScreenRecoveryUI"></a>实现ScreenRecoveryUI</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">class DeviceUI : public ScreenRecoveryUI &#123;</div><div class="line">  public:</div><div class="line">	DeviceUI () :</div><div class="line">        consecutive_power_keys(0) &#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">	//实现自己的识别key类型的功能，可以为不同的输入设备适配recovery功能</div><div class="line">    virtual KeyAction CheckKey(int key) &#123;</div><div class="line">        if (IsKeyPressed(KEY_POWER) &amp;&amp; key == KEY_VOLUMEUP) &#123;</div><div class="line">            return TOGGLE;</div><div class="line">        &#125;</div><div class="line">        if (key == KEY_POWER) &#123;</div><div class="line">            ++consecutive_power_keys;</div><div class="line">            if (consecutive_power_keys &gt;= 7) &#123;</div><div class="line">                return REBOOT;</div><div class="line">            &#125;</div><div class="line">        &#125; else &#123;</div><div class="line">            consecutive_power_keys = 0;</div><div class="line">        &#125;</div><div class="line">        return ENQUEUE;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">  private:</div><div class="line">    int consecutive_power_keys;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h3 id="实现设备类"><a href="#实现设备类" class="headerlink" title="实现设备类"></a>实现设备类</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line">class MyDevice : public Device &#123;</div><div class="line">  public:</div><div class="line">	RkDevice() :</div><div class="line">        ui(new DeviceUI ) &#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    RecoveryUI* GetUI() &#123; return ui; &#125;</div><div class="line"></div><div class="line">    int HandleMenuKey(int key_code, int visible) &#123;</div><div class="line">        if (visible) &#123;</div><div class="line">            switch (key_code) &#123;</div><div class="line">              case KEY_DOWN:</div><div class="line">              case KEY_VOLUMEDOWN:</div><div class="line">                return kHighlightDown;</div><div class="line"></div><div class="line">              case KEY_UP:</div><div class="line">              case KEY_VOLUMEUP:</div><div class="line">                return kHighlightUp;</div><div class="line"></div><div class="line">              case KEY_ENTER:</div><div class="line">              case KEY_POWER:</div><div class="line">                return kInvokeItem;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        return kNoAction;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    BuiltinAction InvokeMenuItem(int menu_position) &#123;</div><div class="line">        switch (menu_position) &#123;</div><div class="line">          case 0: return REBOOT;</div><div class="line">          //case 1: return APPLY_ADB_SIDELOAD;</div><div class="line">          case 1: return APPLY_EXT;</div><div class="line">          case 2: return APPLY_INT_RKIMG;</div><div class="line">          case 3: return APPLY_CACHE;</div><div class="line">          case 4: return WIPE_DATA;</div><div class="line">          case 5: return WIPE_CACHE;</div><div class="line">          case 6: return RECOVER_SYSTEM;</div><div class="line">          default: return NO_ACTION;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    const char* const* GetMenuHeaders() &#123; return HEADERS; &#125;</div><div class="line">    const char* const* GetMenuItems() &#123; return ITEMS; &#125;</div><div class="line"></div><div class="line">  private:</div><div class="line">    RecoveryUI* ui;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">//创建自己实现的设备</div><div class="line">Device* make_device() &#123;</div><div class="line">    return new MyDevice ;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="添加编译实现"><a href="#添加编译实现" class="headerlink" title="添加编译实现"></a>添加编译实现</h3><p>主要是覆盖TARGET_RECOVERY_UI_LIB，输出到/out/…./recovery/root目录下：</p>
<p>Android.mk<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">LOCAL_PATH := $(call my-dir)</div><div class="line">include $(CLEAR_VARS)</div><div class="line"></div><div class="line">LOCAL_MODULE_TAGS := eng</div><div class="line">LOCAL_C_INCLUDES += bootable/recovery</div><div class="line">LOCAL_SRC_FILES := recovery_ui.cpp</div><div class="line"></div><div class="line"># should match TARGET_RECOVERY_UI_LIB set in BoardConfig.mk</div><div class="line">LOCAL_MODULE := librecovery_ui_$(TARGET_PRODUCT)</div><div class="line"></div><div class="line">include $(BUILD_STATIC_LIBRARY)</div></pre></td></tr></table></figure></p>

        </div>

        <blockquote class="post-copyright">
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2017-04-12T06:18:10.772Z" itemprop="dateUpdated">2017年4月12日 14:18</time>
</span><br>


        欢迎转载,但请申明原链接：<a href="/android/cj1eljn1i002ld8pxpyd89wr3/android/AndroidRecovery源码解析和界面定制/" target="_blank" rel="external">https://austinxishou.github.io/android/cj1eljn1i002ld8pxpyd89wr3/android/AndroidRecovery源码解析和界面定制/</a>
    </div>
    <footer>
        <a href="https://austinxishou.github.io">
            <img src="/img/avatar.jpg" alt="AustinXishou">
            AustinXishou
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Recovery/">Recovery</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/">android</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://austinxishou.github.io/android/cj1eljn1i002ld8pxpyd89wr3/android/AndroidRecovery源码解析和界面定制/&title=《Android Recovery 源码解析和界面定制》 — 爵士犀首&pic=https://austinxishou.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://austinxishou.github.io/android/cj1eljn1i002ld8pxpyd89wr3/android/AndroidRecovery源码解析和界面定制/&title=《Android Recovery 源码解析和界面定制》 — 爵士犀首&source=个人技术博客 android详解 网页设计 微信开发 软件定制 个人开发者" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://austinxishou.github.io/android/cj1eljn1i002ld8pxpyd89wr3/android/AndroidRecovery源码解析和界面定制/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Android Recovery 源码解析和界面定制》 — 爵士犀首&url=https://austinxishou.github.io/android/cj1eljn1i002ld8pxpyd89wr3/android/AndroidRecovery源码解析和界面定制/&via=https://austinxishou.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://austinxishou.github.io/android/cj1eljn1i002ld8pxpyd89wr3/android/AndroidRecovery源码解析和界面定制/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/android/cj1eljn1m002qd8px9225owuv/android/Android优化OTA包大小和开机启动时间/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">Android�Ż�OTA����С�Ϳ�������ʱ��</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/android/cj1eljn1h002fd8pxyjydma51/android/Android-OTA升级包生成机制分析/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Android OTA升级包制作和源码相关问题</h4>
      </a>
    </div>
  
</nav>



    

<div class="comments" id="comments">
    <div class="ds-thread" data-thread-key="android/AndroidRecovery源码解析和界面定制" data-title="Android Recovery 源码解析和界面定制" data-url="https://austinxishou.github.io/android/cj1eljn1i002ld8pxpyd89wr3/android/AndroidRecovery源码解析和界面定制/"></div>
</div>
<script>
lazyScripts.push('//cdn.bootcss.com/marked/0.3.6/marked.min.js');

var duoshuoQuery = {short_name:'ysblog', theme: 'none'};
lazyScripts.push('/js/embed.min.js?v=1.4.14');


</script>










</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        谢谢大爷,欢迎再来~
        <i class="icon icon-quote-right"></i>
    </h3>
    <ul class="reward-items">
        
        <li>
            <img src="/img/wechatpay.jpg" title="微信打赏二维码" alt="微信打赏二维码">
            <p>微信</p>
        </li>
        

        
        <li>
            <img src="/img/alipay.jpg" title="支付宝打赏二维码" alt="支付宝打赏二维码">
            <p>支付宝</p>
        </li>
        
    </ul>
</div>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            <span>博客内容遵循 <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">知识共享 署名 - 非商业性 - 相同方式共享 4.0协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p>
            <span>Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a></span>
            <span>爵士犀首 &copy; 2016 - 2017</span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://austinxishou.github.io/android/cj1eljn1i002ld8pxpyd89wr3/android/AndroidRecovery源码解析和界面定制/&title=《Android Recovery 源码解析和界面定制》 — 爵士犀首&pic=https://austinxishou.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://austinxishou.github.io/android/cj1eljn1i002ld8pxpyd89wr3/android/AndroidRecovery源码解析和界面定制/&title=《Android Recovery 源码解析和界面定制》 — 爵士犀首&source=个人技术博客 android详解 网页设计 微信开发 软件定制 个人开发者" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://austinxishou.github.io/android/cj1eljn1i002ld8pxpyd89wr3/android/AndroidRecovery源码解析和界面定制/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Android Recovery 源码解析和界面定制》 — 爵士犀首&url=https://austinxishou.github.io/android/cj1eljn1i002ld8pxpyd89wr3/android/AndroidRecovery源码解析和界面定制/&via=https://austinxishou.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://austinxishou.github.io/android/cj1eljn1i002ld8pxpyd89wr3/android/AndroidRecovery源码解析和界面定制/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQ4AAAEOCAAAAABd2qZ5AAAD7ElEQVR42u3cy26jQBAFUP//TyfbkRzDvVVtJyMdVhaBpjksSvVQHo/4+PrnuD7fXtne9Xz++Xhe//CBAwcOHDjiV71eOjnzvPLs9V7tM/lU12dunoUDBw4cOA5xXD9+Ftiuw+p1pEt2kl9TEOPAgQMHjo9ztMEsee02xLZncODAgQPH3+doN5cX7DasOHDgwIHj73Dk6dk+xCYFwU2x70O1Uhw4cODAke7zkQet/+X3W+Y7cODAgQNHnCydGkTLw2c7DJcMN9TvhQMHDhw41hx5+38GsUmWZtxJ6MWBAwcOHO/jyG9LwmcCmg+0Jdcn9MldtSIOHDhw4LjkaEcHNljRtoIguknkXj4FBw4cOHAc5cjH49rr89C7H3rI17+Z7MCBAwcOHAuONuydHUQ7u07+gW+Kgzhw4MCB41DbqW7/rwNn2zpKXj4pdOLAgQMHjndwJA2bNh1KfuehMX96/i7DthMOHDhw4IjXzBtC+e98Q2fH7K6fGF2JAwcOHDgWHLNi3CykzZpJs1G8WeDHgQMHDhyf4Ui20hb18mDZNr1mjbEi0OLAgQMHjnigYTaCMBtom7Wv8mbYMAnEgQMHDhxrjtn4Wh4OW/r8ldr0r/3kOHDgwIFjxpEnZhvv2Tdpm2Gz9X9oO+HAgQMHjqMcebq1j/Bto+tUungzJIcDBw4cONYc+dJJoTC/Jl+/bTLlowwvZwZx4MCBA8eII7m0berMUq+zK6z+igMHDhw4FhyzNn8b0toSZM4xC/xRcRAHDhw4cIw4ksckf90kXWdXTj5DlMLhwIEDB441x6bQ1iZLyTFL/Nqm2stAiwMHDhw4Fhz7gYAZRA46a3FtKHHgwIEDx4aj3UpepNuX89phiOtwG+0NBw4cOHCsOTaJ1ixNml3ZJmxtsMeBAwcOHHuOdtFZMGvTrdlAQ1v+++FZOHDgwIFjzZFspU3VZiu8L6zWqSMOHDhw4DhThRv+Q+e84dSW/GbDc8cGGnDgwIEDxyGO5LZ24KxduS1HnkojceDAgQPHnqNNvfKxtnxYbRPC2yLmzTU4cODAgeMQx+Zl8pA2axSdKh1G9+LAgQMHjjVHEtL2Cd6MaZ8Wtq0yHDhw4MCx55iV5PJN502jPCVr18nP48CBAweOPccm3cqTvVMBdZOe5evjwIEDB449Rzs6MEvA9qXGPMlcBVocOHDgwHGII3mxWSmwje2zQYdNFhb14nDgwIEDxxs49kldXjTMS4qbBBIHDhw4cPwuR/t6SRqWT15sCoX5HnDgwIEDxymOzVbaEmELt0nh6nENHDhw4MCx5mibSUkitxmta4fnZonlrKmGAwcOHDguOb4BGVAWqDFwPhEAAAAASUVORK5CYII=" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };



</script>

<script src="/js/main.min.js?v=1.4.14"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.min.js?v=1.4.14" async></script>






<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '死鬼去哪里了！';
            clearTimeout(titleTime);
        } else {
            document.title = '咦!又好了!';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
